<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 3.8.0"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png"><link rel="mask-icon" href="/images/logo.svg" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:new URL("https://mrh1s.top").hostname,root:"/",scheme:"Pisces",version:"7.7.0",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!1,show_result:!1,style:null},back2top:{enable:!0,sidebar:!1,scrollpercent:!1},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{appID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!1,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},path:"",motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}}}</script><meta name="description" content="Blog"><meta property="og:type" content="website"><meta property="og:title" content="mrh929&#39;s home"><meta property="og:url" content="https://mrh1s.top/page/4/index.html"><meta property="og:site_name" content="mrh929&#39;s home"><meta property="og:description" content="Blog"><meta property="og:locale" content="en"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="mrh929&#39;s home"><meta name="twitter:description" content="Blog"><link rel="canonical" href="https://mrh1s.top/page/4/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!0,isPost:!1}</script><title>mrh929's home</title><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-meta"><div><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">mrh929's home</span> <span class="logo-line-after"><i></i></span></a></div></div><div class="site-nav-toggle"><div class="toggle" aria-label="Toggle navigation bar"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-fw fa-home"></i>Home</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>About</a></li><li class="menu-item menu-item-archives"><a href="/_posts/" rel="section"><i class="fa fa-fw fa-archive"></i>Archives</a></li></ul></nav></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content"><div class="posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="en"><link itemprop="mainEntityOfPage" href="https://mrh1s.top/posts/d2cf12e4/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.gif"><meta itemprop="name" content="mrh929"><meta itemprop="description" content="Blog"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="mrh929's home"></span><header class="post-header"><h1 class="post-title" itemprop="name headline"><a href="/posts/d2cf12e4/" class="post-title-link" itemprop="url">补题：Strange_int</a></h1><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">Posted on</span> <time title="Created: 2019-05-13 23:06:14" itemprop="dateCreated datePublished" datetime="2019-05-13T23:06:14+08:00">2019-05-13</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i> </span><span class="post-meta-item-text">Edited on</span> <time title="Modified: 2019-05-21 15:54:20" itemprop="dateModified" datetime="2019-05-21T15:54:20+08:00">2019-05-21</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">In</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/write-up/" itemprop="url" rel="index"><span itemprop="name">write-up</span> </a></span>, <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/write-up/nationalCTF-20190421/" itemprop="url" rel="index"><span itemprop="name">nationalCTF_20190421</span></a></span></span></div></header><div class="post-body" itemprop="articleBody"><h1 id="strange-int"><a href="#strange-int" class="headerlink" title="strange int"></a>strange int</h1><p><a href="\uploads\strange_int.7z">strange_int</a></p><blockquote><p>打国赛的时候没做出来这道题，现在看了题解来补一补</p></blockquote><h2 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h2><h3 id="开始"><a href="#开始" class="headerlink" title="开始"></a>开始</h3><p>以前写过FAT16的模拟程序，看到这个文件第一想法是这是一个DBR</p><p>第一行的 jmp 就是 jump 到这个命令的下一个命令。。</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">seg000:0000                 jmp     far ptr 7C0h:5</span><br><span class="line">seg000:0005 ; ---------------------------------------------------------------------------</span><br><span class="line">seg000:0005                 mov     ax, cs</span><br><span class="line">seg000:0007                 mov     ds, ax</span><br><span class="line">seg000:0009                 mov     ss, ax</span><br><span class="line">seg000:000B                 mov     sp, 400h</span><br><span class="line">seg000:000E                 cld</span><br><span class="line">seg000:000F                 mov     ax, 3</span><br><span class="line">seg000:0012                 int     10h             ; - VIDEO - SET VIDEO MODE</span><br><span class="line">seg000:0012                                         ; AL = mode</span><br><span class="line">seg000:0014                 mov     dx, 0</span><br><span class="line">seg000:0017                 mov     cx, 2</span><br><span class="line">seg000:001A                 mov     ax, 1000h</span><br><span class="line">seg000:001D                 mov     es, ax</span><br><span class="line">seg000:001F                 assume es:nothing</span><br><span class="line">seg000:001F                 xor     bx, bx</span><br><span class="line">seg000:0021                 mov     ax, 228h</span><br><span class="line">seg000:0024                 int     13h             ; DISK - READ SECTORS INTO MEMORY</span><br><span class="line">seg000:0024                                         ; AL = number of sectors to read, CH = track, CL = sector</span><br><span class="line">seg000:0024                                         ; DH = head, DL = drive, ES:BX -&gt; buffer to fill</span><br><span class="line">seg000:0024                                         ; Return: CF set on error, AH = status, AL = number of sectors read</span><br><span class="line">seg000:0026                 jnb     short loc_2A</span><br><span class="line">seg000:0028</span><br><span class="line">seg000:0028 loc_28:                                 ; CODE XREF: seg000:loc_28↓j</span><br><span class="line">seg000:0028                 jmp     short loc_28</span><br><span class="line">seg000:002A ; ---------------------------------------------------------------------------</span><br><span class="line">seg000:002A</span><br><span class="line">seg000:002A loc_2A:                                 ; CODE XREF: seg000:0026↑j</span><br><span class="line">seg000:002A                 cli</span><br><span class="line">seg000:002B                 mov     ax, 1000h</span><br><span class="line">seg000:002E                 mov     ds, ax</span><br><span class="line">seg000:0030                 assume ds:nothing</span><br><span class="line">seg000:0030                 xor     ax, ax</span><br><span class="line">seg000:0032                 mov     es, ax</span><br><span class="line">seg000:0034                 assume es:nothing</span><br><span class="line">seg000:0034                 mov     cx, 2000h</span><br><span class="line">seg000:0037                 sub     si, si</span><br><span class="line">seg000:0039                 sub     di, di</span><br><span class="line">seg000:003B                 rep movsb</span><br><span class="line">seg000:003D                 mov     ax, 7C0h</span><br><span class="line">seg000:0040</span><br><span class="line">seg000:0040 loc_40:                                 ; DATA XREF: seg000:0012↑r</span><br><span class="line">seg000:0040                 mov     ds, ax</span><br><span class="line">seg000:0042                 assume ds:nothing</span><br><span class="line">seg000:0042                 lidt    fword ptr ds:6Fh</span><br><span class="line">seg000:0047                 lgdt    fword ptr ds:75h</span><br><span class="line">seg000:004C</span><br><span class="line">seg000:004C loc_4C:                                 ; DATA XREF: seg000:0024↑r</span><br><span class="line">seg000:004C                 mov     ax, 1</span><br><span class="line">seg000:004F                 lmsw    ax</span><br><span class="line">seg000:0052                 jmp     far ptr 8:0</span><br></pre></td></tr></table></figure><p>然后就跳转到一个神秘的鬼地方去了</p><p>程序大概是把ebx置0了，然后作为计数变量，一共循环了10h次</p><p>把一堆数送到了内存中，经高人指点，这堆数属于中断向量</p><p>（也就是VM里面的操作数，对应相应的操作）</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">seg000:000001FE ; ---------------------------------------------------------------------------</span><br><span class="line">seg000:000001FE                 push    ebp</span><br><span class="line">seg000:000001FF                 stosb</span><br><span class="line">seg000:00000200                 mov     eax, 10h</span><br><span class="line">seg000:00000205                 mov     ds, eax</span><br><span class="line">seg000:00000207                 assume ds:nothing</span><br><span class="line">seg000:00000207                 lss     esp, large ds:0B5Ch</span><br><span class="line">seg000:0000020E                 call    sub_28B</span><br><span class="line">seg000:00000213                 call    sub_283</span><br><span class="line">seg000:00000218                 mov     eax, 10h        ; DATA XREF: sub_28B+27↓r</span><br><span class="line">seg000:0000021D                 mov     ds, eax</span><br><span class="line">seg000:0000021F                 mov     es, eax</span><br><span class="line">seg000:00000221                 assume es:nothing</span><br><span class="line">seg000:00000221                 mov     fs, eax         ; DATA XREF: sub_283↓r</span><br><span class="line">seg000:00000223                 assume fs:nothing</span><br><span class="line">seg000:00000223                 mov     gs, eax</span><br><span class="line">seg000:00000225                 assume gs:nothing</span><br><span class="line">seg000:00000225</span><br><span class="line">seg000:00000225 loc_225:                                ; DATA XREF: sub_28B+11↓o</span><br><span class="line">seg000:00000225                 lss     esp, large ds:0B5Ch</span><br><span class="line">seg000:0000022C                 xor     ebx, ebx</span><br><span class="line">seg000:0000022E</span><br><span class="line">seg000:0000022E loc_22E:                                ; CODE XREF: seg000:0000025D↓j</span><br><span class="line">seg000:0000022E                 nop</span><br><span class="line">seg000:0000022F                 cmp     ebx, 10h</span><br><span class="line">seg000:00000232                 jge     short loc_25F</span><br><span class="line"></span><br><span class="line">seg000:00000234                 mov     eax, 80000h</span><br><span class="line">seg000:00000239                 lea     edx, ds:0D08h[ebx*4] ;这个内存里面全部存的0</span><br><span class="line">seg000:00000240                 mov     edx, [edx]</span><br><span class="line">seg000:00000242                 mov     ax, dx</span><br><span class="line">seg000:00000245                 mov     dx, 8E00h</span><br><span class="line">seg000:00000249                 mov     ecx, 21h ; &apos;!&apos; ;21h</span><br><span class="line">seg000:0000024E                 add     ecx, ebx    ;21h + ebx， </span><br><span class="line">													;也就是把21h开始的10h个数作为操作数</span><br><span class="line">seg000:00000250                 lea     esi, ds:128h[ecx*8]</span><br><span class="line">seg000:00000257                 mov     [esi], eax</span><br><span class="line">seg000:00000259                 mov     [esi+4], edx</span><br><span class="line">seg000:0000025C                 inc     ebx</span><br><span class="line">seg000:0000025D                 jmp     short loc_22E</span><br><span class="line">seg000:0000025F ; ---------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line"># 后面是多次中断进行操作</span><br><span class="line">seg000:0000025F</span><br><span class="line">seg000:0000025F loc_25F:                                ; CODE XREF: seg000:00000232↑j</span><br><span class="line">seg000:0000025F                                         ; seg000:00000266↓j</span><br><span class="line">seg000:0000025F                 call    sub_268</span><br><span class="line">seg000:00000264                 int     21h             ; DOS -</span><br><span class="line">seg000:00000266                 jmp     short loc_25F</span><br></pre></td></tr></table></figure><h3 id="switch跳转语句"><a href="#switch跳转语句" class="headerlink" title="switch跳转语句"></a>switch跳转语句</h3><p>中断之前call的sub_268汇编代码如下：</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">seg000:00000268 sub_268         proc near               ; CODE XREF: seg000:loc_25F↑p</span><br><span class="line">seg000:00000268                 mov     edi, large ds:0B78h</span><br><span class="line">seg000:0000026E                 lea     edi, ds:0D48h[edi*4]</span><br><span class="line">seg000:00000275                 mov     eax, [edi]</span><br><span class="line">seg000:00000277                 mov     large ds:65h, al</span><br><span class="line">seg000:0000027C                 mov     ecx, [edi+4]</span><br><span class="line">seg000:0000027F                 mov     eax, [edi+8]</span><br><span class="line">seg000:00000282                 retn</span><br><span class="line">seg000:00000282 sub_268         endp</span><br></pre></td></tr></table></figure><p>操作数1被送入内存了</p><p>ecx应该是操作数2</p><p>eax是操作数3</p><h3 id="各个case"><a href="#各个case" class="headerlink" title="各个case"></a>各个case</h3><h4 id="汇编"><a href="#汇编" class="headerlink" title="汇编"></a>汇编</h4><p>以下是每个操作数对应的操作， 因为所有的操作数是依次出现的 ，所以只需要挨着翻译就好了</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">seg000:00000D7C ; ---------------------------------------------------------------------------</span><br><span class="line">seg000:00000D7C                 lea     ecx, ds:0B64h[ecx*4]</span><br><span class="line">seg000:00000D83                 mov     [ecx], eax</span><br><span class="line">seg000:00000D85                 jmp     loc_EF8</span><br><span class="line">seg000:00000D8A ; ---------------------------------------------------------------------------</span><br><span class="line">seg000:00000D8A                 lea     eax, ds:0B64h[eax*4]</span><br><span class="line">seg000:00000D91                 mov     eax, [eax]</span><br><span class="line">seg000:00000D93                 lea     ecx, ds:0B64h[ecx*4]</span><br><span class="line">seg000:00000D9A                 mov     [ecx], eax</span><br><span class="line">seg000:00000D9C                 jmp     loc_EF8</span><br><span class="line">seg000:00000DA1 ; ---------------------------------------------------------------------------</span><br><span class="line">seg000:00000DA1                 lea     eax, ds:0B64h[eax*4]</span><br><span class="line">seg000:00000DA8                 mov     eax, [eax]</span><br><span class="line">seg000:00000DAA                 lea     ecx, ds:0B64h[ecx*4]</span><br><span class="line">seg000:00000DB1                 lea     eax, ds:0D48h[eax*4]</span><br><span class="line">seg000:00000DB8                 mov     eax, [eax]</span><br><span class="line">seg000:00000DBA                 mov     [ecx], eax</span><br><span class="line">seg000:00000DBC                 jmp     loc_EF8</span><br><span class="line">seg000:00000DC1 ; ---------------------------------------------------------------------------seg000:00000DC1                 lea     eax, ds:0B64h[eax*4]</span><br><span class="line">seg000:00000DC8                 mov     eax, [eax]</span><br><span class="line">seg000:00000DCA                 lea     ecx, ds:0B64h[ecx*4]</span><br><span class="line">seg000:00000DD1                 mov     ecx, [ecx]</span><br><span class="line">seg000:00000DD3                 lea     ecx, ds:0D48h[ecx*4]</span><br><span class="line">seg000:00000DDA                 mov     [ecx], eax</span><br><span class="line">seg000:00000DDC                 jmp     loc_EF8</span><br><span class="line">seg000:00000DE1 ; ---------------------------------------------------------------------------</span><br><span class="line">seg000:00000DE1                 lea     eax, ds:0B64h[eax*4]</span><br><span class="line">seg000:00000DE8                 mov     edx, [eax]</span><br><span class="line">seg000:00000DEA                 lea     ecx, ds:0B64h[ecx*4]</span><br><span class="line">seg000:00000DF1                 mov     eax, [ecx]</span><br><span class="line">seg000:00000DF3                 add     eax, edx</span><br><span class="line">seg000:00000DF5                 mov     [ecx], eax</span><br><span class="line">seg000:00000DF7                 jmp     loc_EF8</span><br><span class="line">seg000:00000DFC ; ---------------------------------------------------------------------------</span><br><span class="line">seg000:00000DFC                 lea     eax, ds:0B64h[eax*4]</span><br><span class="line">seg000:00000E03                 mov     edx, [eax]</span><br><span class="line">seg000:00000E05                 lea     ecx, ds:0B64h[ecx*4]</span><br><span class="line">seg000:00000E0C                 mov     eax, [ecx]</span><br><span class="line">seg000:00000E0E                 sub     eax, edx</span><br><span class="line">seg000:00000E10                 mov     [ecx], eax</span><br><span class="line">seg000:00000E12                 jmp     loc_EF8</span><br><span class="line">seg000:00000E17 ; ---------------------------------------------------------------------------</span><br><span class="line">seg000:00000E17                 lea     eax, ds:0B64h[eax*4]</span><br><span class="line">seg000:00000E1E                 mov     edx, [eax]</span><br><span class="line">seg000:00000E20                 lea     ecx, ds:0B64h[ecx*4]</span><br><span class="line">seg000:00000E27                 mov     eax, [ecx]</span><br><span class="line">seg000:00000E29                 xor     eax, edx</span><br><span class="line">seg000:00000E2B                 mov     [ecx], eax</span><br><span class="line">seg000:00000E2D                 jmp     loc_EF8</span><br><span class="line">seg000:00000E32 ; ---------------------------------------------------------------------------</span><br><span class="line">seg000:00000E32                 lea     eax, ds:0B64h[eax*4]</span><br><span class="line">seg000:00000E39                 mov     eax, [eax]</span><br><span class="line">seg000:00000E3B                 lea     edx, ds:0B64h[ecx*4]</span><br><span class="line">seg000:00000E42                 mov     cl, al</span><br><span class="line">seg000:00000E44                 mov     eax, [edx]</span><br><span class="line">seg000:00000E46                 shl     eax, cl</span><br><span class="line">seg000:00000E48                 mov     [edx], eax</span><br><span class="line">seg000:00000E4A                 jmp     loc_EF8</span><br><span class="line">seg000:00000E4F ; ---------------------------------------------------------------------------</span><br><span class="line">seg000:00000E4F                 lea     eax, ds:0B64h[eax*4]</span><br><span class="line">seg000:00000E56                 mov     eax, [eax]</span><br><span class="line">seg000:00000E58                 lea     edx, ds:0B64h[ecx*4]</span><br><span class="line">seg000:00000E5F                 mov     cl, al</span><br><span class="line">seg000:00000E61                 mov     eax, [edx]</span><br><span class="line">seg000:00000E63                 shr     eax, cl</span><br><span class="line">seg000:00000E65                 mov     [edx], eax</span><br><span class="line">seg000:00000E67                 jmp     loc_EF8</span><br><span class="line">seg000:00000E6C ; ---------------------------------------------------------------------------</span><br><span class="line">seg000:00000E6C                 lea     eax, ds:0B64h[eax*4]</span><br><span class="line">seg000:00000E73                 mov     eax, [eax]</span><br><span class="line">seg000:00000E75                 lea     ecx, ds:0B64h[ecx*4]</span><br><span class="line">seg000:00000E7C                 mov     edx, [ecx]</span><br><span class="line">seg000:00000E7E                 and     eax, edx</span><br><span class="line">seg000:00000E80                 mov     [ecx], eax</span><br><span class="line">seg000:00000E82                 jmp     short loc_EF8</span><br><span class="line">seg000:00000E84 ; ---------------------------------------------------------------------------</span><br><span class="line">seg000:00000E84                 lea     eax, ds:0B64h[ecx*4]</span><br><span class="line">seg000:00000E8B                 mov     eax, [eax]</span><br><span class="line">seg000:00000E8D                 lea     ecx, unk_B78</span><br><span class="line">seg000:00000E93                 mov     [ecx], eax</span><br><span class="line">seg000:00000E95                 iret</span><br><span class="line">seg000:00000E96 ; ---------------------------------------------------------------------------</span><br><span class="line">seg000:00000E96                 lea     eax, ds:0B64h[eax*4]</span><br><span class="line">seg000:00000E9D                 mov     eax, [eax]</span><br><span class="line">seg000:00000E9F                 test    eax, eax</span><br><span class="line">seg000:00000EA1                 jnz     short loc_EF8</span><br><span class="line">seg000:00000EA3                 lea     eax, ds:0B64h[ecx*4]</span><br><span class="line">seg000:00000EAA                 mov     eax, [eax]</span><br><span class="line">seg000:00000EAC                 lea     ecx, unk_B78</span><br><span class="line">seg000:00000EB2                 mov     [ecx], eax</span><br><span class="line">seg000:00000EB4                 iret</span><br><span class="line">seg000:00000EB5 ; ---------------------------------------------------------------------------</span><br><span class="line">seg000:00000EB5                 lea     eax, ds:0B64h[eax*4]</span><br><span class="line">seg000:00000EBC                 mov     eax, [eax]</span><br><span class="line">seg000:00000EBE                 test    eax, eax</span><br><span class="line">seg000:00000EC0                 jz      short loc_EF8</span><br><span class="line">seg000:00000EC2                 lea     eax, ds:0B64h[ecx*4]</span><br><span class="line">seg000:00000EC9                 mov     eax, [eax]</span><br><span class="line">seg000:00000ECB                 lea     ecx, unk_B78</span><br><span class="line">seg000:00000ED1                 mov     [ecx], eax</span><br><span class="line">seg000:00000ED3                 iret</span><br><span class="line">seg000:00000ED4 ; ---------------------------------------------------------------------------</span><br><span class="line">seg000:00000ED4                 lea     eax, unk_F94</span><br><span class="line">seg000:00000EDA                 call    sub_2EA</span><br><span class="line">seg000:00000EDF                 hlt</span><br><span class="line">seg000:00000EE0 ; ---------------------------------------------------------------------------</span><br><span class="line">seg000:00000EE0                 lea     eax, unk_FA0</span><br><span class="line">seg000:00000EE6                 call    sub_2EA</span><br><span class="line">seg000:00000EEB                 lea     eax, word_FAE</span><br><span class="line">seg000:00000EF1                 call    sub_2EA</span><br><span class="line">seg000:00000EF6                 hlt</span><br><span class="line">seg000:00000EF6 ; ---------------------------------------------------------------------------</span><br><span class="line">seg000:00000EF7                 db 0F4h</span><br><span class="line">seg000:00000EF8 ; ---------------------------------------------------------------------------</span><br><span class="line">seg000:00000EF8</span><br><span class="line">seg000:00000EF8 loc_EF8:                                ; CODE XREF: seg000:00000D85↑j</span><br><span class="line">seg000:00000EF8                                         ; seg000:00000D9C↑j ...</span><br><span class="line">seg000:00000EF8                 lea     ecx, unk_B78</span><br><span class="line">seg000:00000EFE                 mov     eax, [ecx]</span><br><span class="line">seg000:00000F00                 add     eax, 3</span><br><span class="line">seg000:00000F03                 mov     [ecx], eax</span><br><span class="line">seg000:00000F05                 iret</span><br><span class="line">seg000:00000F05 ; ---------------------------------------------------------------------------</span><br></pre></td></tr></table></figure><h4 id="翻译后"><a href="#翻译后" class="headerlink" title="翻译后"></a>翻译后</h4><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">buf[a] = b</span><br><span class="line">buf[a] = buf[b]</span><br><span class="line">buf[a] = (dword) opt[buf[b]]</span><br><span class="line">(dword) opt[buf[a]] = buf[b]</span><br><span class="line">buf[a] += buf[b]</span><br><span class="line">buf[a] -= buf[b]</span><br><span class="line">buf[a] ^= buf[b]</span><br><span class="line">buf[a] &lt;&lt;= buf[b]</span><br><span class="line">buf[a] &gt;&gt;= buf[b]</span><br><span class="line">buf[a] &amp;= buf[b]</span><br><span class="line">temp = buf[a]</span><br><span class="line"><span class="keyword">if</span>(buf[b] == <span class="number">0</span>)  temp = buf[a]</span><br><span class="line"><span class="keyword">if</span>(buf[b] != <span class="number">0</span>)  temp = buf[a]</span><br><span class="line"><span class="built_in">exit</span>(<span class="number">0</span>)</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"wrong"</span>)</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"right"</span>)</span><br></pre></td></tr></table></figure><h3 id="指令数组"><a href="#指令数组" class="headerlink" title="指令数组"></a>指令数组</h3><h4 id="内存"><a href="#内存" class="headerlink" title="内存"></a>内存</h4><p>数据区，存储操作数，这个是通过</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">seg000:0000026E                 lea     edi, ds:0D48h[edi*4]</span><br></pre></td></tr></table></figure><p>算出来的</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">seg000:00000F48                 db  21h ; !             ; data start</span><br><span class="line">seg000:00000F49                 db    0</span><br><span class="line">seg000:00000F4A                 db    0</span><br><span class="line">seg000:00000F4B                 db    0</span><br><span class="line">seg000:00000F4C                 db    0</span><br><span class="line">seg000:00000F4D                 db    0</span><br><span class="line">seg000:00000F4E                 db    0</span><br><span class="line">seg000:00000F4F                 db    0</span><br><span class="line">seg000:00000F50                 db  81h</span><br><span class="line">seg000:00000F51                 db    0</span><br><span class="line">seg000:00000F52                 db    0</span><br><span class="line">seg000:00000F53                 db    0</span><br><span class="line">seg000:00000F54                 db  27h ; &apos;</span><br><span class="line">seg000:00000F55                 db    0</span><br><span class="line">seg000:00000F56                 db    0</span><br><span class="line">seg000:00000F57                 db    0</span><br><span class="line">seg000:00000F58                 dd 2 dup(1), 24h, 2 dup(1), 23h, 2, 0</span><br><span class="line">seg000:00000F78                 db  22h ; &quot;</span><br><span class="line">seg000:00000F79                 align 4</span><br><span class="line">seg000:00000F7C                 db    3</span><br><span class="line">seg000:00000F7D                 align 10h</span><br><span class="line">seg000:00000F80                 db    2</span><br><span class="line">seg000:00000F81                 align 4</span><br><span class="line">seg000:00000F84                 dd offset dword_0+21h</span><br><span class="line">seg000:00000F88                 dd 4, 8, 28h</span><br><span class="line">seg000:00000F94 unk_F94         db    3                 ; DATA XREF: seg000:00000ED4↑o</span><br><span class="line">seg000:00000F95                 align 4</span><br><span class="line">seg000:00000F98                 dd 4, 27h</span><br><span class="line">seg000:00000FA0 unk_FA0         db    2                 ; DATA XREF: seg000:00000EE0↑o</span><br><span class="line">seg000:00000FA1                 align 4</span><br><span class="line">seg000:00000FA4                 db    3</span><br><span class="line">seg000:00000FA5                 align 4</span><br><span class="line">seg000:00000FA8                 dd offset dword_0+28h</span><br><span class="line">seg000:00000FAC                 db    3</span><br><span class="line">seg000:00000FAD                 align 2</span><br><span class="line">seg000:00000FAE word_FAE        dw 0                    ; DATA XREF: seg000:00000EEB↑o</span><br><span class="line">seg000:00000FB0                 dd 4, 27h, 2, 3, 28h, 3, 4, 27h, 2, 3, 27h, 2 dup(3), 23h</span><br><span class="line">seg000:00000FB0                 dd 4, 3, 24h, 3, 2, 27h, 2, 4, 24h, 0</span><br><span class="line">seg000:00001010                 db    2</span><br><span class="line">seg000:00001011                 align 4</span><br><span class="line">seg000:00001014                 dd offset dword_0+21h</span><br><span class="line">seg000:00001018                 dd 2 dup(1), 25h, 0</span><br><span class="line">seg000:00001028                 dd 1, 22h, 1, 0</span><br><span class="line">seg000:00001038                 dd offset dword_0+21h</span><br><span class="line">seg000:0000103C                 db    2</span><br><span class="line">seg000:0000103D                 align 10h</span><br><span class="line">seg000:00001040                 db  81h</span><br><span class="line">seg000:00001041                 align 4</span><br><span class="line">seg000:00001044                 dd offset dword_0+26h</span><br><span class="line">seg000:00001048                 dd 1, 2, 21h, 2, 9, 26h, 1, 2, 21h, 2, 9, 2Dh, 2, 1, 21h</span><br><span class="line">seg000:00001048                 dd 0</span><br><span class="line">seg000:00001088                 db  81h</span><br><span class="line">seg000:00001089                 align 4</span><br><span class="line">seg000:0000108C                 db  22h ; &quot;</span><br><span class="line">seg000:0000108D                 align 10h</span><br><span class="line">seg000:00001090                 dd 1, 0</span><br><span class="line">seg000:00001098                 dd offset dword_0+21h</span><br><span class="line">seg000:0000109C                 db    2</span><br><span class="line">seg000:0000109D                 align 10h</span><br><span class="line">seg000:000010A0                 dd 9, 25h, 1, 2, 23h, 3, 0</span><br><span class="line">seg000:000010BC                 db  23h ; #</span><br><span class="line">seg000:000010BD                 align 10h</span><br><span class="line">seg000:000010C0                 dd 4, 1, 26h, 3, 4, 21h, 4, 7Eh, 2Dh, 4, 3, 21h, 3, 1</span><br><span class="line">seg000:000010C0                 dd 25h, 0</span><br><span class="line">seg000:00001100                 db    3</span><br><span class="line">seg000:00001101                 align 4</span><br><span class="line">seg000:00001104                 db  25h ; %</span><br><span class="line">seg000:00001105                 align 4</span><br><span class="line">seg000:00001108                 dd 1, 3, 26h, 2, 3, 21h, 4, 5Ah, 2Dh, 4, 2, 2Fh, 2 dup(0)</span><br><span class="line">seg000:00001140                 dd offset dword_0+30h</span><br><span class="line">seg000:00001144                 dd 2 dup(0)</span><br><span class="line">seg000:0000114C                 db  38h ; 8</span><br><span class="line">seg000:0000114D                 db 62h, 64h, 61h</span><br></pre></td></tr></table></figure><h4 id="dump"><a href="#dump" class="headerlink" title="dump"></a>dump</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">addr = <span class="number">0x0F48</span></span><br><span class="line"><span class="keyword">print</span> <span class="string">"\nopt:"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span>(<span class="number">1</span>):</span><br><span class="line">    opt = Dword(addr)</span><br><span class="line">    a = Dword(addr + <span class="number">4</span>)</span><br><span class="line">    b = Dword(addr + <span class="number">8</span>)</span><br><span class="line">    <span class="keyword">print</span> opt,<span class="string">","</span>,a,<span class="string">","</span>,b,<span class="string">","</span>,</span><br><span class="line">    <span class="keyword">if</span>(opt &gt;= <span class="number">0x2E</span>):</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    addr += <span class="number">12</span></span><br></pre></td></tr></table></figure><h4 id="翻译"><a href="#翻译" class="headerlink" title="翻译"></a>翻译</h4><p>妈耶，好不容易把指令翻译成了C语言，结果发现这段代码里面还嵌套了类似汇编的指令，还有循环，需要翻译</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="number">0</span>       buf0 = <span class="number">129</span>    				<span class="comment">//buf0 = 129</span></span><br><span class="line"><span class="number">1</span>       buf1 ^= buf1   				<span class="comment">//buf1 = 0</span></span><br><span class="line"><span class="number">2</span>       (dword) data[buf1] = buf1   <span class="comment">//data[0] = 0</span></span><br><span class="line"><span class="number">3</span>       buf2 = (dword) data[buf0]   <span class="comment">//buf2 = data[129]</span></span><br><span class="line"><span class="number">4</span>       buf3 = buf2                 <span class="comment">//buf3 = data[129]</span></span><br><span class="line"><span class="number">5</span>       buf4 = <span class="number">8</span>				    <span class="comment">//buf4 = 8</span></span><br><span class="line"><span class="number">6</span>       buf3 &lt;&lt;= buf4               <span class="comment">//buf3 = data[129] &lt;&lt; 8</span></span><br><span class="line"><span class="number">7</span>       buf2 ^= buf3			    <span class="comment">//buf2 = data[129] ^ (data[129] &lt;&lt; 8)</span></span><br><span class="line"><span class="number">8</span>       buf3 &lt;&lt;= buf4		        <span class="comment">//buf3 = data[129] &lt;&lt; 16</span></span><br><span class="line"><span class="number">9</span>       buf2 ^= buf3 </span><br><span class="line"><span class="number">10</span>      buf3 &lt;&lt;= buf4</span><br><span class="line"><span class="number">11</span>      buf2 ^= buf3</span><br><span class="line"></span><br><span class="line"><span class="comment">//buf2 = data[129] ^ (data[129] &lt;&lt; 8) ^ (data[129] &lt;&lt; 16) ^ (data[129] &lt;&lt; 24) </span></span><br><span class="line"><span class="comment">//  = afterXor</span></span><br><span class="line"></span><br><span class="line"><span class="number">12</span>      buf3 ^= buf3			    <span class="comment">//buf3 = 0</span></span><br><span class="line"><span class="number">13</span>      buf4 = (dword) data[buf3]   <span class="comment">//buf4 = data[0]</span></span><br><span class="line"><span class="number">14</span>      (dword) data[buf3] = buf2   <span class="comment">//data[0] = afterXor</span></span><br><span class="line"><span class="number">15</span>      buf2 ^= buf4                <span class="comment">//buf2 = afterXor ^ data[0]</span></span><br><span class="line"><span class="number">16</span>      (dword) data[buf0] = buf2   <span class="comment">//data[129] = afterXor ^ data[0]</span></span><br><span class="line"><span class="number">17</span>      buf1 = <span class="number">1</span>					<span class="comment">//buf1 = 1</span></span><br><span class="line"><span class="number">18</span>      buf0 += buf1				<span class="comment">//buf0 = 130</span></span><br><span class="line"><span class="number">19</span>      buf1 = buf0					<span class="comment">//buf1 = 130</span></span><br><span class="line"><span class="number">20</span>      buf2 = <span class="number">129</span>					<span class="comment">//buf2 = 129</span></span><br><span class="line"><span class="number">21</span>      buf1 -= buf2				<span class="comment">//buf1 = 1</span></span><br><span class="line"><span class="number">22</span>      buf2 = <span class="number">9</span>					<span class="comment">//buf2 = 9</span></span><br><span class="line"><span class="number">23</span>      buf1 -= buf2				<span class="comment">//buf1 = -8</span></span><br><span class="line"><span class="number">24</span>      buf2 = <span class="number">9</span>					<span class="comment">//buf2 = 9</span></span><br><span class="line"></span><br><span class="line"><span class="number">25</span>      <span class="keyword">if</span>(buf1 != <span class="number">0</span>)  temp = buf2  <span class="comment">//经高人指点，这里是设置eip</span></span><br><span class="line">									<span class="comment">//jmp 3</span></span><br><span class="line">									</span><br><span class="line"><span class="number">26</span>      buf0 = <span class="number">129</span>					<span class="comment">//buf0 = 129</span></span><br><span class="line"><span class="number">27</span>      buf1 = buf0					<span class="comment">//buf1 = 129</span></span><br><span class="line"><span class="number">28</span>      buf2 = <span class="number">9</span>					<span class="comment">//buf2 = 9</span></span><br><span class="line"><span class="number">29</span>      buf1 += buf2				<span class="comment">//buf1 = 138</span></span><br><span class="line"><span class="number">30</span>      buf3 = (dword) data[buf0]	<span class="comment">//buf3 = data[129]</span></span><br><span class="line"><span class="number">31</span>      buf4 = (dword) data[buf1]	<span class="comment">//buf4 = data[138]</span></span><br><span class="line"><span class="number">32</span>      buf3 -= buf4				<span class="comment">//buf3 = data[129] - data[138]</span></span><br><span class="line"><span class="number">33</span>      buf4 = <span class="number">126</span>					<span class="comment">//buf4 = 126</span></span><br><span class="line"></span><br><span class="line"><span class="number">34</span>      <span class="keyword">if</span>(buf3 != <span class="number">0</span>)  temp = buf4	<span class="comment">//jmp 42</span></span><br><span class="line"></span><br><span class="line"><span class="number">35</span>      buf3 = <span class="number">1</span>					<span class="comment">//buf3 = 1</span></span><br><span class="line"><span class="number">36</span>      buf0 += buf3				<span class="comment">//buf0 = data[129] - data[138] + 129</span></span><br><span class="line"><span class="number">37</span>      buf1 += buf3				<span class="comment">//buf1 = 139</span></span><br><span class="line"><span class="number">38</span>      buf2 -= buf3				<span class="comment">//buf2 = 8</span></span><br><span class="line"><span class="number">39</span>      buf4 = <span class="number">90</span>					<span class="comment">//buf4 = 90</span></span><br><span class="line"><span class="number">40</span>      <span class="keyword">if</span>(buf2 != <span class="number">0</span>)  temp = buf4	</span><br><span class="line"><span class="number">41</span>      <span class="built_in">printf</span>(<span class="string">"wrong"</span>)</span><br><span class="line"><span class="number">42</span>      <span class="built_in">printf</span>(<span class="string">"right"</span>)</span><br></pre></td></tr></table></figure><h4 id="再翻译"><a href="#再翻译" class="headerlink" title="再翻译"></a>再翻译</h4><p>程序作了一个很奇怪的循环，并且异或了一大堆</p><p>这个程序要逆向实在太难了，考虑到本来这个数据也不大，就暴力枚举</p><p><strong>script from yypE:</strong></p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dec</span><span class="params">(arr)</span>:</span></span><br><span class="line">    <span class="keyword">assert</span>(len(arr)==<span class="number">9</span>)</span><br><span class="line">    last = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">9</span>):</span><br><span class="line">        var = <span class="number">0</span></span><br><span class="line">        arr[i] ^= last</span><br><span class="line">        last = arr[i]</span><br><span class="line">        var |= arr[i] &amp; <span class="number">0xff</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">4</span>):</span><br><span class="line">            var |= (byte(arr[i],j) ^ byte(arr[i],j<span class="number">-1</span>)) &lt;&lt;(<span class="number">8</span>*j)</span><br><span class="line">        arr[i] = var</span><br><span class="line">    <span class="keyword">return</span> arr</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">enc</span><span class="params">(arr)</span>:</span></span><br><span class="line">    <span class="keyword">assert</span>(len(arr)==<span class="number">9</span>)</span><br><span class="line">    last = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">9</span>):</span><br><span class="line">        var = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">4</span>):</span><br><span class="line">            var ^= (arr[i]&lt;&lt;(<span class="number">8</span>*j)) &amp; <span class="number">0xffffffff</span></span><br><span class="line">        arr[i] = var ^ last</span><br><span class="line">        last = var</span><br><span class="line">    <span class="keyword">return</span> arr</span><br></pre></td></tr></table></figure><p>获得flag：</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gen_flag</span><span class="params">()</span>:</span></span><br><span class="line">    ar = [<span class="number">1466127717</span>, <span class="number">106103809</span>, <span class="number">524896585</span>, <span class="number">1364657951</span>, <span class="number">1465860951</span>, <span class="number">1464032855</span>, <span class="number">1129775626</span>, <span class="number">1465779038</span>, <span class="number">257490944</span>]</span><br><span class="line">    flag = <span class="string">b''</span></span><br><span class="line">    <span class="keyword">for</span> each <span class="keyword">in</span> dec(ar):</span><br><span class="line">        flag+=each.to_bytes(<span class="number">4</span>,<span class="string">'little'</span>)</span><br><span class="line">    print(flag)</span><br></pre></td></tr></table></figure><p><strong>虚拟机+反汇编+循环+暴力搜索</strong></p><h2 id="难点"><a href="#难点" class="headerlink" title="难点"></a>难点</h2><ol><li>猜出来程序的入口点</li><li>猜出修改的temp变量原来是EIP</li><li>逆向带循环的程序</li><li>耐心</li></ol></div><footer class="post-footer"><div class="post-eof"></div></footer></article><article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="en"><link itemprop="mainEntityOfPage" href="https://mrh1s.top/posts/5f4cc17f/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.gif"><meta itemprop="name" content="mrh929"><meta itemprop="description" content="Blog"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="mrh929's home"></span><header class="post-header"><h1 class="post-title" itemprop="name headline"><a href="/posts/5f4cc17f/" class="post-title-link" itemprop="url">simple_machine</a></h1><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">Posted on</span> <time title="Created: 2019-05-11 20:45:32" itemprop="dateCreated datePublished" datetime="2019-05-11T20:45:32+08:00">2019-05-11</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i> </span><span class="post-meta-item-text">Edited on</span> <time title="Modified: 2019-05-21 15:53:38" itemprop="dateModified" datetime="2019-05-21T15:53:38+08:00">2019-05-21</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">In</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/write-up/" itemprop="url" rel="index"><span itemprop="name">write-up</span> </a></span>, <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/write-up/cgctf/" itemprop="url" rel="index"><span itemprop="name">cgctf</span></a></span></span></div></header><div class="post-body" itemprop="articleBody"><h1 id="simple-machine"><a href="#simple-machine" class="headerlink" title="simple-machine"></a>simple-machine</h1><p><a href="\uploads\simple-machine.7z">simple-machine</a></p><h2 id="思路整理"><a href="#思路整理" class="headerlink" title="思路整理"></a>思路整理</h2><h3 id="general"><a href="#general" class="headerlink" title="general"></a>general</h3><p>这道题说起来是vm，实际上和vm的挂钩并不大，就是用高级语言去实现了汇编，把变量都当做了寄存器来使用，其中还有各种压栈出栈过程，不过跟本题关系不大，也就不用过于细究了</p><h3 id="fun1"><a href="#fun1" class="headerlink" title="fun1"></a>fun1</h3><p>fun1主要是通过输入的字符串，与预置的feed进行异或，得到一串加密的字符串，存在内存中</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">int</span> __<span class="function">cdecl <span class="title">fun1</span><span class="params">(<span class="keyword">int</span> str, <span class="keyword">unsigned</span> <span class="keyword">int</span> a2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v2; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">int</span> v3; <span class="comment">// eax</span></span><br><span class="line"></span><br><span class="line">  push(base_addr_804B15C);</span><br><span class="line">  base_addr_804B15C = esp1;</span><br><span class="line">  push(temp);</span><br><span class="line">  push(temp2);</span><br><span class="line">  esp1 -= <span class="number">48</span>;</span><br><span class="line">  *(_DWORD *)(base_addr_804B15C - 29) = 'deef'; // 0x804B13F</span><br><span class="line">  *(_DWORD *)(base_addr_804B15C - 25) = 'daed';</span><br><span class="line">  *(_DWORD *)(base_addr_804B15C - 21) = 'feeb';</span><br><span class="line">  *(_DWORD *)(base_addr_804B15C - 17) = 'efac';</span><br><span class="line">  *(_BYTE *)(base_addr_804B15C - <span class="number">13</span>) = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> ( *(_DWORD *)(base_addr_804B15C - <span class="number">12</span>) = <span class="number">0</span>; ; ++*(_DWORD *)(base_addr_804B15C - <span class="number">12</span>) )<span class="comment">// i = base_addr_804B15C - 12</span></span><br><span class="line">  &#123;</span><br><span class="line">    eaxx = *(_DWORD *)(base_addr_804B15C - <span class="number">12</span>); <span class="comment">// i</span></span><br><span class="line">    <span class="keyword">if</span> ( eaxx &gt;= a2 )</span><br><span class="line">      <span class="keyword">break</span>;                                    <span class="comment">// 判断是否退出循环</span></span><br><span class="line">                                                <span class="comment">// </span></span><br><span class="line">                                                <span class="comment">// </span></span><br><span class="line">                                                <span class="comment">// </span></span><br><span class="line">    ebxx = *(_DWORD *)(base_addr_804B15C - <span class="number">12</span>); <span class="comment">// i</span></span><br><span class="line">    eaxx = str;                                 <span class="comment">// str</span></span><br><span class="line">    temp = ebxx + str;                          <span class="comment">// str + i</span></span><br><span class="line">    ebxx = *(_DWORD *)(base_addr_804B15C - <span class="number">12</span>); <span class="comment">// i</span></span><br><span class="line">    eaxx = ebxx + str;                          <span class="comment">// str + i</span></span><br><span class="line">    eaxx = *(<span class="keyword">unsigned</span> __int8 *)(ebxx + str);    <span class="comment">// 取当前字符串</span></span><br><span class="line">    temp1 = eaxx;</span><br><span class="line">    *(_BYTE *)(base_addr_804B15C - <span class="number">41</span>) = eaxx;  <span class="comment">// 把当前字符串保存到一个地址里面</span></span><br><span class="line">                                                <span class="comment">// </span></span><br><span class="line">                                                <span class="comment">// </span></span><br><span class="line">                                                <span class="comment">// </span></span><br><span class="line">    temp2 = *(_DWORD *)(base_addr_804B15C - <span class="number">12</span>);</span><br><span class="line">    esp1 -= <span class="number">12</span>;</span><br><span class="line">    eaxx = base_addr_804B15C - <span class="number">29</span>;              <span class="comment">// 取feed</span></span><br><span class="line">    push(base_addr_804B15C - <span class="number">29</span>);               <span class="comment">// push(feed)</span></span><br><span class="line">    v2 = <span class="built_in">strlen</span>(*(<span class="keyword">const</span> <span class="keyword">char</span> **)esp1);          <span class="comment">// v2 是 feed的长度</span></span><br><span class="line">    esp1 += <span class="number">16</span>;</span><br><span class="line">    len = v2;</span><br><span class="line">    eaxx = temp2;</span><br><span class="line">    ebxx = <span class="number">0</span>;</span><br><span class="line">    sub_80485AB(v2);                            <span class="comment">// j = i % v2  </span></span><br><span class="line">                                                <span class="comment">// i = i / v2</span></span><br><span class="line">    eaxx = ebxx;</span><br><span class="line">    eaxx = *(<span class="keyword">unsigned</span> __int8 *)(ebxx - <span class="number">29</span> + base_addr_804B15C);<span class="comment">// 算feed中的偏移</span></span><br><span class="line">    temp1 = eaxx;</span><br><span class="line">    temp1 = *(_BYTE *)(base_addr_804B15C - <span class="number">41</span>) ^ eaxx;<span class="comment">// c ^ feed[]</span></span><br><span class="line">    *(_BYTE *)temp = temp1;</span><br><span class="line">    v3 = eaxx;</span><br><span class="line">    LOBYTE(v3) = <span class="number">0</span>;</span><br><span class="line">    eaxx = v3 + (<span class="keyword">unsigned</span> __int8)temp1;</span><br><span class="line">  &#125;</span><br><span class="line">  sub_80485A5();</span><br><span class="line">  esp1 = base_addr_804B15C - <span class="number">8</span>;</span><br><span class="line">  pop(&amp;temp2);</span><br><span class="line">  pop(&amp;temp);</span><br><span class="line">  <span class="keyword">return</span> pop(&amp;base_addr_804B15C);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="fun2"><a href="#fun2" class="headerlink" title="fun2"></a>fun2</h3><p>fun2中有两个循环，看似很复杂实则简单</p><p>看到两个寄存器在之间移来移去，发现很多操作都是无效的</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">void</span> __<span class="function">cdecl <span class="title">fun2</span><span class="params">(<span class="keyword">int</span> a1, <span class="keyword">int</span> a2, <span class="keyword">int</span> a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  push(base_addr_804B15C);</span><br><span class="line">  base_addr_804B15C = esp1;</span><br><span class="line">  esp1 -= <span class="number">16</span>;</span><br><span class="line">  <span class="keyword">for</span> ( *(_DWORD *)(base_addr_804B15C - <span class="number">4</span>) = <span class="number">0</span>; <span class="comment">// 循环三次</span></span><br><span class="line">        *(_DWORD *)(base_addr_804B15C - <span class="number">4</span>) &lt;= <span class="number">2u</span>;</span><br><span class="line">        ++*(_DWORD *)(base_addr_804B15C - <span class="number">4</span>) )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">for</span> ( *(_DWORD *)(base_addr_804B15C - <span class="number">8</span>) = <span class="number">0</span>; ; ++*(_DWORD *)(base_addr_804B15C - <span class="number">8</span>) )</span><br><span class="line">    &#123;</span><br><span class="line">      len = a3;</span><br><span class="line">      ebxx = <span class="number">1431655766</span>;</span><br><span class="line">      eaxx = a3;</span><br><span class="line">      sub_80485DB(<span class="number">1431655766</span>);                  <span class="comment">// ebxx = (eaxx * 1431655766) &gt;&gt; 32</span></span><br><span class="line">      ebxx -= (<span class="keyword">unsigned</span> <span class="keyword">int</span>)len &gt;&gt; <span class="number">31</span>;</span><br><span class="line">      eaxx = ebxx;</span><br><span class="line">      <span class="keyword">if</span> ( *(_DWORD *)(base_addr_804B15C - <span class="number">8</span>) &gt;= (<span class="keyword">unsigned</span> <span class="keyword">int</span>)ebxx )</span><br><span class="line">        <span class="keyword">break</span>;                                  <span class="comment">// 前面一段是关于判断跳出条件的</span></span><br><span class="line">      len = a3;</span><br><span class="line">      ebxx = <span class="number">0x55555556</span>;</span><br><span class="line">      eaxx = a3;</span><br><span class="line">      sub_80485DB(<span class="number">0x55555556</span>);                  <span class="comment">// ebxx = (unsigned __int64)(a1 * (signed __int64)eaxx) &gt;&gt; 32;</span></span><br><span class="line">                                                <span class="comment">//   </span></span><br><span class="line">      ebxx -= (<span class="keyword">unsigned</span> <span class="keyword">int</span>)len &gt;&gt; <span class="number">31</span>;</span><br><span class="line">      eaxx = ebxx;                              <span class="comment">// repeated</span></span><br><span class="line">      eaxx = ebxx * *(_DWORD *)(base_addr_804B15C - <span class="number">4</span>);</span><br><span class="line">      ebxx = eaxx;</span><br><span class="line">      eaxx = *(_DWORD *)(base_addr_804B15C - <span class="number">8</span>);</span><br><span class="line">      eaxx += ebxx;</span><br><span class="line">      ebxx = eaxx;</span><br><span class="line">      eaxx = a2;</span><br><span class="line">      len = ebxx + a2;                          <span class="comment">// 算偏移地址 addr = 0x804B100 + (i * 18) + j</span></span><br><span class="line">      ebxx = *(_DWORD *)(base_addr_804B15C - <span class="number">8</span>);</span><br><span class="line">      eaxx = <span class="number">2</span> * ebxx;                          <span class="comment">// j * 2</span></span><br><span class="line">      ebxx *= <span class="number">3</span>;                                <span class="comment">// j * 3</span></span><br><span class="line">      eaxx = *(_DWORD *)(base_addr_804B15C - <span class="number">4</span>);<span class="comment">// i</span></span><br><span class="line">      eaxx += ebxx;                             <span class="comment">// i +  j * 3</span></span><br><span class="line">      ebxx = eaxx;                              <span class="comment">// i +  j * 3</span></span><br><span class="line">      eaxx += a1;</span><br><span class="line">      eaxx = *(<span class="keyword">unsigned</span> __int8 *)(a1 + ebxx);   <span class="comment">// *(input + i + j * 3)</span></span><br><span class="line">      temp1 = eaxx;</span><br><span class="line">      *(_BYTE *)len = eaxx;                     <span class="comment">// 修改上方的那个偏移地址</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  sub_80485A5();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>翻译过来是这样：</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= <span class="number">2</span>; i++)</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>;;j++)&#123;</span><br><span class="line">        addr[(i * <span class="number">18</span>) + j] = input + i + j * <span class="number">3</span></span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure><h3 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h3><p><del>比较fun1和fun2中生成的字符串是否相等</del></p><p>经高人指点，不是比较fun1和fun2的字符串，而是先经过fun1进行处理，然后再经过fun2处理，然后直接和内存中的一串字符串进行比较</p><h2 id="solve"><a href="#solve" class="headerlink" title="solve"></a>solve</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">feed = <span class="string">"feeddeadbeefcafe"</span></span><br><span class="line">enc = [<span class="number">0x00</span>,<span class="number">0x03</span>,<span class="number">0x09</span>,<span class="number">0x3A</span>,<span class="number">0x05</span>,<span class="number">0x0E</span>,<span class="number">0x02</span>,<span class="number">0x16</span>,<span class="number">0x0F</span>,<span class="number">0x1F</span>,<span class="number">0x12</span>,<span class="number">0x56</span>,<span class="number">0x3B</span>,<span class="number">0x0B</span>,<span class="number">0x51</span>,<span class="number">0x50</span>,<span class="number">0x39</span>,<span class="number">0x00</span>,<span class="number">0x09</span>,<span class="number">0x1F</span>,<span class="number">0x50</span>,<span class="number">0x04</span>,<span class="number">0x14</span>,<span class="number">0x57</span>,<span class="number">0x3B</span>,<span class="number">0x12</span>,<span class="number">0x07</span>,<span class="number">0x3C</span>,<span class="number">0x1C</span>,<span class="number">0x3A</span>,<span class="number">0x15</span>,<span class="number">0x05</span>,<span class="number">0x0B</span>,<span class="number">0x08</span>,<span class="number">0x06</span>,<span class="number">0x01</span>,<span class="number">0x04</span>,<span class="number">0x12</span>,<span class="number">0x16</span>,<span class="number">0x39</span>,<span class="number">0x05</span>,<span class="number">0x0B</span>,<span class="number">0x50</span>,<span class="number">0x57</span>,<span class="number">0x09</span>,<span class="number">0x12</span>,<span class="number">0x0A</span>,<span class="number">0x27</span>,<span class="number">0x13</span>,<span class="number">0x17</span>,<span class="number">0x0E</span>,<span class="number">0x02</span>,<span class="number">0x55</span>,<span class="number">0x18</span>]</span><br><span class="line">dec = [<span class="number">0x00</span>,<span class="number">0x03</span>,<span class="number">0x09</span>,<span class="number">0x3A</span>,<span class="number">0x05</span>,<span class="number">0x0E</span>,<span class="number">0x02</span>,<span class="number">0x16</span>,<span class="number">0x0F</span>,<span class="number">0x1F</span>,<span class="number">0x12</span>,<span class="number">0x56</span>,<span class="number">0x3B</span>,<span class="number">0x0B</span>,<span class="number">0x51</span>,<span class="number">0x50</span>,<span class="number">0x39</span>,<span class="number">0x00</span>,<span class="number">0x09</span>,<span class="number">0x1F</span>,<span class="number">0x50</span>,<span class="number">0x04</span>,<span class="number">0x14</span>,<span class="number">0x57</span>,<span class="number">0x3B</span>,<span class="number">0x12</span>,<span class="number">0x07</span>,<span class="number">0x3C</span>,<span class="number">0x1C</span>,<span class="number">0x3A</span>,<span class="number">0x15</span>,<span class="number">0x05</span>,<span class="number">0x0B</span>,<span class="number">0x08</span>,<span class="number">0x06</span>,<span class="number">0x01</span>,<span class="number">0x04</span>,<span class="number">0x12</span>,<span class="number">0x16</span>,<span class="number">0x39</span>,<span class="number">0x05</span>,<span class="number">0x0B</span>,<span class="number">0x50</span>,<span class="number">0x57</span>,<span class="number">0x09</span>,<span class="number">0x12</span>,<span class="number">0x0A</span>,<span class="number">0x27</span>,<span class="number">0x13</span>,<span class="number">0x17</span>,<span class="number">0x0E</span>,<span class="number">0x02</span>,<span class="number">0x55</span>,<span class="number">0x18</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">3</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">18</span>):</span><br><span class="line">        dec[i + j * <span class="number">3</span>] = enc[i * <span class="number">18</span> + j]</span><br><span class="line"></span><br><span class="line">ans = <span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">54</span>):</span><br><span class="line">    dec[i] ^= ord(feed[i % <span class="number">16</span>])</span><br><span class="line">    ans = ans + chr(dec[i])</span><br><span class="line"></span><br><span class="line">print(ans)</span><br></pre></td></tr></table></figure></div><footer class="post-footer"><div class="post-eof"></div></footer></article><article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="en"><link itemprop="mainEntityOfPage" href="https://mrh1s.top/posts/db7779bb/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.gif"><meta itemprop="name" content="mrh929"><meta itemprop="description" content="Blog"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="mrh929's home"></span><header class="post-header"><h1 class="post-title" itemprop="name headline"><a href="/posts/db7779bb/" class="post-title-link" itemprop="url">多并发编程尝试</a></h1><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">Posted on</span> <time title="Created: 2019-05-08 22:20:36" itemprop="dateCreated datePublished" datetime="2019-05-08T22:20:36+08:00">2019-05-08</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i> </span><span class="post-meta-item-text">Edited on</span> <time title="Modified: 2019-05-15 16:28:11" itemprop="dateModified" datetime="2019-05-15T16:28:11+08:00">2019-05-15</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">In</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/c-learn/" itemprop="url" rel="index"><span itemprop="name">c-learn</span></a></span></span></div></header><div class="post-body" itemprop="articleBody"><p>经查资料，多并发编程需要用到一个库</p><blockquote><p>#include &lt; thread&gt;</p><p>using namespace std;</p></blockquote><p>线程初始化：</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="built_in">std</span>::<span class="function">thread <span class="title">t</span><span class="params">(fun)</span></span>;<span class="comment">//fun为要多线程运行的函数</span></span><br></pre></td></tr></table></figure><p>等待线程终止：</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">t.join();<span class="comment">//等待名为t的函数终止运行</span></span><br></pre></td></tr></table></figure><p>如下实现了先启动输出first的线程，但由于多并发，second先输出</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"pch.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;windows.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">fun</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	Sleep(<span class="number">200</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"first task\n"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="function">thread <span class="title">t</span><span class="params">(fun)</span></span>;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"second task\n"</span>);</span><br><span class="line">	t.join();</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"third task\n"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><footer class="post-footer"><div class="post-eof"></div></footer></article><article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="en"><link itemprop="mainEntityOfPage" href="https://mrh1s.top/posts/f22525af/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.gif"><meta itemprop="name" content="mrh929"><meta itemprop="description" content="Blog"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="mrh929's home"></span><header class="post-header"><h1 class="post-title" itemprop="name headline"><a href="/posts/f22525af/" class="post-title-link" itemprop="url">homuraVM</a></h1><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">Posted on</span> <time title="Created: 2019-05-07 23:22:42 / Modified: 23:57:03" itemprop="dateCreated datePublished" datetime="2019-05-07T23:22:42+08:00">2019-05-07</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">In</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/write-up/" itemprop="url" rel="index"><span itemprop="name">write-up</span> </a></span>, <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/write-up/cgctf/" itemprop="url" rel="index"><span itemprop="name">cgctf</span></a></span></span></div></header><div class="post-body" itemprop="articleBody"><h1 id="HomuraVM"><a href="#HomuraVM" class="headerlink" title="HomuraVM"></a>HomuraVM</h1><blockquote><p>太丢脸了，这么简单一个vm还是做了三个多小时</p></blockquote><p><a href="\uploads\homuraVM.7z">homuraVM</a></p><h2 id="概况"><a href="#概况" class="headerlink" title="概况"></a>概况</h2><p>这道题是WxyVM的一个加强版，即使把vm的指令翻译出来了，也会发现得到的是一串鸟语，俗称类brainf**k语言</p><p>程序的大概思路是这样的，读入一串数据，然后把这段数据载入内存，随后执行保存在程序里面的一段虚拟机代码，虚拟机的各种函数已经给出，最终生成的加密结果也能找到，逆向程序。</p><h2 id="过程"><a href="#过程" class="headerlink" title="过程"></a>过程</h2><h3 id="对vm的代码进行读取"><a href="#对vm的代码进行读取" class="headerlink" title="对vm的代码进行读取"></a>对vm的代码进行读取</h3><p>自己写的IDA中的注释：</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    result = *(<span class="keyword">unsigned</span> __int8 *)(COUNTER + a1);</span><br><span class="line">    <span class="keyword">if</span> ( !(_BYTE)result )                       <span class="comment">// 没有指令了 就退出</span></span><br><span class="line">      <span class="keyword">return</span> result;</span><br><span class="line">    v2 = *(<span class="keyword">char</span> *)(COUNTER + a1);</span><br><span class="line">    <span class="keyword">switch</span> ( (<span class="keyword">unsigned</span> <span class="keyword">int</span>)off_1048 )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">0x43</span>u:                               <span class="comment">// *j -= 2 * (*i &amp; *a)    C</span></span><br><span class="line">        *(_DWORD *)global_j -= <span class="number">2</span> * (*(_DWORD *)global_i &amp; *(_DWORD *)array_input);</span><br><span class="line">        ++COUNTER;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">0x47</span>u:                               <span class="comment">// (*j)--              G</span></span><br><span class="line">        --*(_DWORD *)global_j;</span><br><span class="line">        ++COUNTER;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">0x4D</span>u:                               <span class="comment">// *j = *i + a[0]                  M</span></span><br><span class="line">        *(_DWORD *)global_j = *(_DWORD *)global_i + *(_DWORD *)array_input;</span><br><span class="line">        ++COUNTER;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">0x54</span>u:                               <span class="comment">// (*j)++            T</span></span><br><span class="line">        ++*(_DWORD *)global_j;</span><br><span class="line">        ++COUNTER;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">0x5B</span>u:                               <span class="comment">// 如果a[0]!=0 就循环，否则直接跳出    [</span></span><br><span class="line">        <span class="keyword">if</span> ( *(_DWORD *)array_input )</span><br><span class="line">        &#123;</span><br><span class="line">          ++COUNTER;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">do</span></span><br><span class="line">            v3 = COUNTER++;</span><br><span class="line">          <span class="keyword">while</span> ( *(_BYTE *)(v3 + a1) != <span class="number">93</span> );</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">0x5D</span>u:                               <span class="comment">// 如果a[0]!=0 就返回[继续循环           ]</span></span><br><span class="line">        <span class="keyword">if</span> ( *(_DWORD *)array_input )</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">do</span></span><br><span class="line">            --COUNTER;</span><br><span class="line">          <span class="keyword">while</span> ( *(_BYTE *)(COUNTER + a1) != <span class="number">91</span> );</span><br><span class="line">          ++COUNTER;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">          ++COUNTER;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">0x61</span>u:                               <span class="comment">// (*i)--          a</span></span><br><span class="line">        --*(_DWORD *)global_i;</span><br><span class="line">        ++COUNTER;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">0x68</span>u:                               <span class="comment">// a[0] += 4       h</span></span><br><span class="line">        array_input = (<span class="keyword">char</span> *)array_input + <span class="number">4</span>;</span><br><span class="line">        ++COUNTER;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">0x6D</span>u:                               <span class="comment">// a[0]自加         m</span></span><br><span class="line">        ++*(_DWORD *)array_input;</span><br><span class="line">        ++COUNTER;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">0x6F</span>u:                               <span class="comment">// a[0] -= 4          o</span></span><br><span class="line">        array_input = (<span class="keyword">char</span> *)array_input - <span class="number">4</span>;</span><br><span class="line">        ++COUNTER;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">0x72</span>u:                               <span class="comment">// (*i)++        r</span></span><br><span class="line">        ++*(_DWORD *)global_i;</span><br><span class="line">        ++COUNTER;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">0x75</span>u:                               <span class="comment">// a[0]--         u</span></span><br><span class="line">        --*(_DWORD *)array_input;</span><br><span class="line">        ++COUNTER;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">0x76</span>u:                               <span class="comment">// j = i             v</span></span><br><span class="line">        *(_DWORD *)global_j = *(_DWORD *)global_i;</span><br><span class="line">        ++COUNTER;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">0x7B</span>u:</span><br><span class="line">        <span class="keyword">if</span> ( *(_DWORD *)global_j )              <span class="comment">// *j !=0 就进入循环，否则直接跳出</span></span><br><span class="line">        &#123;</span><br><span class="line">          ++COUNTER;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">do</span></span><br><span class="line">            v4 = COUNTER++;</span><br><span class="line">          <span class="keyword">while</span> ( *(_BYTE *)(v4 + a1) != <span class="number">125</span> );</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">0x7D</span>u:</span><br><span class="line">        <span class="keyword">if</span> ( *(_DWORD *)global_j )              <span class="comment">// 如果*j不为0就返回&#123;处</span></span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">do</span></span><br><span class="line">            --COUNTER;</span><br><span class="line">          <span class="keyword">while</span> ( *(_BYTE *)(COUNTER + a1) != <span class="number">123</span> );</span><br><span class="line">          ++COUNTER;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">          ++COUNTER;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h3 id="清除无用虚拟机指令"><a href="#清除无用虚拟机指令" class="headerlink" title="清除无用虚拟机指令"></a>清除无用虚拟机指令</h3><p>首先我尝试着把无效命令先清除掉:</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">str = <span class="string">"""h[ur]ovMCh&#123;mG&#125;hv&#123;aG&#125;[ur]ovaaaMCh&#123;mG&#125;hv&#123;aG&#125;[ur]</span></span><br><span class="line"><span class="string">ovrrMCh&#123;mG&#125;hv&#123;aG&#125;[ur]ovrararaMCh&#123;mG&#125;hv&#123;aG&#125;[ur]ovrarar</span></span><br><span class="line"><span class="string">rrMCh&#123;mG&#125;hv&#123;aG&#125;[ur]ovararaaMCh&#123;mG&#125;hv&#123;aG&#125;[ur]ovrararra</span></span><br><span class="line"><span class="string">raMCh&#123;mG&#125;hv&#123;aG&#125;[ur]ovrrrarrrMCh&#123;mG&#125;hv&#123;aG&#125;[ur]ovaarrar</span></span><br><span class="line"><span class="string">rMCh&#123;mG&#125;hv&#123;aG&#125;[ur]ovaaarrarMCh&#123;mG&#125;hv&#123;aG&#125;[ur]ovrrrarrM</span></span><br><span class="line"><span class="string">Ch&#123;mG&#125;hv&#123;aG&#125;[ur]ovaarrraaMCh&#123;mG&#125;hv&#123;aG&#125;[ur]ovarraarMCh</span></span><br><span class="line"><span class="string">&#123;mG&#125;hv&#123;aG&#125;[ur]ovrrraaarrMCh&#123;mG&#125;hv&#123;aG&#125;[ur]ovaaarrrrarr</span></span><br><span class="line"><span class="string">MCh&#123;mG&#125;hv&#123;aG&#125;[ur]ovrrrraarrarrMCh&#123;mG&#125;hv&#123;aG&#125;[ur]ovrrar</span></span><br><span class="line"><span class="string">raMCh&#123;mG&#125;hv&#123;aG&#125;[ur]ovaaraarMCh&#123;mG&#125;hv&#123;aG&#125;[ur]ovrrarraM</span></span><br><span class="line"><span class="string">Ch&#123;mG&#125;hv&#123;aG&#125;[ur]ovaarrrarMCh&#123;mG&#125;hv&#123;aG&#125;[ur]ovrraarraMC</span></span><br><span class="line"><span class="string">h&#123;mG&#125;hv&#123;aG&#125;[ur]ovrrarMCh&#123;mG&#125;hv&#123;aG&#125;[ur]ovaarrarMCh&#123;mG&#125;</span></span><br><span class="line"><span class="string">hv&#123;aG&#125;[ur]ovrrraarMCh&#123;mG&#125;hv&#123;aG&#125;[ur]ovrrrraaMCh&#123;mG&#125;hv&#123;</span></span><br><span class="line"><span class="string">aG&#125;[ur]ovrrarraMCh&#123;mG&#125;hv&#123;aG&#125;[ur]ovrrrrrrMCh&#123;mG&#125;hv&#123;aG&#125;</span></span><br><span class="line"><span class="string">[ur]ovaaaarMCh&#123;mG&#125;hv&#123;aG&#125;[ur]ovrraaaMCh&#123;mG&#125;hv&#123;aG&#125;[ur]o</span></span><br><span class="line"><span class="string">vaarraMCh&#123;mG&#125;hv&#123;aG&#125;[ur]ovrrarMCh&#123;mG&#125;hv&#123;aG&#125;[ur]ovaarra</span></span><br><span class="line"><span class="string">aMCh&#123;mG&#125;hv&#123;aG&#125;[ur]ovaarraraMCh&#123;mG&#125;hv&#123;aG&#125;[ur]ovaarrara</span></span><br><span class="line"><span class="string">rMCh&#123;mG&#125;"""</span></span><br><span class="line"></span><br><span class="line">str = str.replace(<span class="string">"\n"</span>, <span class="string">""</span>)</span><br><span class="line">old = <span class="string">""</span></span><br><span class="line"><span class="keyword">while</span>(old != str):</span><br><span class="line">    old = str</span><br><span class="line">    str = str.replace(<span class="string">"ra"</span>, <span class="string">""</span>)</span><br><span class="line">    str = str.replace(<span class="string">"ar"</span>, <span class="string">""</span>)</span><br><span class="line">    str = str.replace(<span class="string">"oh"</span>, <span class="string">""</span>)</span><br><span class="line">    str = str.replace(<span class="string">"ho"</span>, <span class="string">""</span>)</span><br><span class="line">    str = str.replace(<span class="string">"um"</span>, <span class="string">""</span>)</span><br><span class="line">    str = str.replace(<span class="string">"mu"</span>, <span class="string">""</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">print(<span class="string">"\n\n\n"</span>)</span><br><span class="line">h_cnt = <span class="number">0</span></span><br><span class="line">o_cnt = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> c <span class="keyword">in</span> str:</span><br><span class="line">    <span class="keyword">if</span>(c == <span class="string">'h'</span>):</span><br><span class="line">        h_cnt += <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span>(h_cnt == <span class="number">3</span>):</span><br><span class="line">            h_cnt = <span class="number">1</span></span><br><span class="line">            o_cnt = <span class="number">0</span></span><br><span class="line">            print(<span class="string">" "</span>)</span><br><span class="line">    <span class="keyword">elif</span>(c == <span class="string">'o'</span>):</span><br><span class="line">        o_cnt += <span class="number">1</span></span><br><span class="line">    print(c, end=<span class="string">""</span>)</span><br></pre></td></tr></table></figure><p>可得以下字符串（VScode显示有点问题，打印到文件中就行）</p><blockquote><p>h[ur]ovMCh{mG}<br>hv{aG}[ur]ovaaaMCh{mG}<br>hv{aG}[ur]ovrrMCh{mG}<br>hv{aG}[ur]ovMCh{mG}<br>hv{aG}[ur]ovrrrMCh{mG}<br>hv{aG}[ur]ovaaMCh{mG}<br>hv{aG}[ur]ovrMCh{mG}<br>hv{aG}[ur]ovrrrrrMCh{mG}<br>hv{aG}[ur]ovrMCh{mG}<br>hv{aG}[ur]ovaMCh{mG}<br>hv{aG}[ur]ovrrrrMCh{mG}<br>hv{aG}[ur]ovaMCh{mG}<br>hv{aG}[ur]ovMCh{mG}<br>hv{aG}[ur]ovrrMCh{mG}<br>hv{aG}[ur]ovrrMCh{mG}<br>hv{aG}[ur]ovrrrrrMCh{mG}<br>hv{aG}[ur]ovrrMCh{mG}<br>hv{aG}[ur]ovaaMCh{mG}<br>hv{aG}[ur]ovrrMCh{mG}<br>hv{aG}[ur]ovrMCh{mG}<br>hv{aG}[ur]ovrMCh{mG}<br>hv{aG}[ur]ovrrMCh{mG}<br>hv{aG}[ur]ovMCh{mG}<br>hv{aG}[ur]ovrrMCh{mG}<br>hv{aG}[ur]ovrrMCh{mG}<br>hv{aG}[ur]ovrrMCh{mG}<br>hv{aG}[ur]ovrrrrrrMCh{mG}<br>hv{aG}[ur]ovaaaMCh{mG}<br>hv{aG}[ur]ovaMCh{mG}<br>hv{aG}[ur]ovaMCh{mG}<br>hv{aG}[ur]ovrrMCh{mG}<br>hv{aG}[ur]ovaaMCh{mG}<br>hv{aG}[ur]ovaMCh{mG}<br>hv{aG}[ur]ovMCh{mG}</p></blockquote><h3 id="得到正向算法（递推公式）"><a href="#得到正向算法（递推公式）" class="headerlink" title="得到正向算法（递推公式）"></a>得到正向算法（递推公式）</h3><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">//MCh&#123;mG&#125;hv&#123;aG&#125;[ur]ov</span></span><br><span class="line">*j = *i + *a - <span class="number">2</span> * (*i &amp; *a)</span><br><span class="line">    </span><br><span class="line"><span class="comment">//&#123;mG&#125;:   *a += j  j清空</span></span><br><span class="line"><span class="keyword">while</span>(*j):</span><br><span class="line">    *a++</span><br><span class="line">    *j--</span><br><span class="line">        </span><br><span class="line"><span class="comment">//&#123;aG&#125;:    i -= j  j清空 </span></span><br><span class="line"><span class="keyword">while</span>(*j):</span><br><span class="line">    *i--</span><br><span class="line">    *j--</span><br><span class="line">        </span><br><span class="line"><span class="comment">//[ur]:	   i = *a   a清空</span></span><br><span class="line"><span class="keyword">while</span>(*a)  </span><br><span class="line">    *a--</span><br><span class="line">    *i++</span><br><span class="line">    </span><br><span class="line"><span class="comment">//r:</span></span><br><span class="line">    *i++</span><br><span class="line"><span class="comment">//a:</span></span><br><span class="line">    *i--</span><br><span class="line"><span class="comment">//v:</span></span><br><span class="line">    j = i</span><br></pre></td></tr></table></figure><p>经过研究</p><blockquote><p>“v{ag}” 没有起到任何作用，</p><p>“v” 将i的值取到了j中</p><p>然后i和j一同被清空了</p></blockquote><blockquote><p>“ov”中的“v”也没有起到作用，因为在后面j的值会被刷新</p></blockquote><p>再次精简：（去掉v{aG} ）</p><blockquote><p>h[ur]oMCh{mG}<br>h[ur]oaaaMCh{mG}<br>h[ur]orrMCh{mG}<br>h[ur]oMCh{mG}<br>h[ur]orrrMCh{mG}<br>h[ur]oaaMCh{mG}<br>h[ur]orMCh{mG}<br>h[ur]orrrrrMCh{mG}<br>h[ur]orMCh{mG}<br>h[ur]oaMCh{mG}<br>h[ur]orrrrMCh{mG}<br>h[ur]oaMCh{mG}<br>h[ur]oMCh{mG}<br>h[ur]orrMCh{mG}<br>h[ur]orrMCh{mG}<br>h[ur]orrrrrMCh{mG}<br>h[ur]orrMCh{mG}<br>h[ur]oaaMCh{mG}<br>h[ur]orrMCh{mG}<br>h[ur]orMCh{mG}<br>h[ur]orMCh{mG}<br>h[ur]orrMCh{mG}<br>h[ur]oMCh{mG}<br>h[ur]orrMCh{mG}<br>h[ur]orrMCh{mG}<br>h[ur]orrMCh{mG}<br>h[ur]orrrrrrMCh{mG}<br>h[ur]oaaaMCh{mG}<br>h[ur]oaMCh{mG}<br>h[ur]oaMCh{mG}<br>h[ur]orrMCh{mG}<br>h[ur]oaaMCh{mG}<br>h[ur]oaMCh{mG}<br>h[ur]oMCh{mG}</p></blockquote><blockquote><p>即</p><p>h 指针加一</p><p>[ur] 将*(a+1)全部转移到 i 中</p><p>o 指针减一</p><p>ar index改变 i = *(a+1) + index</p><p>M j = *(a+1) + index + *a</p><p>C j -= ((*(a+1) + index) &amp; *a) * 2</p><p>MC: j = *(a+1) + index + *a - (( *(a+1) + index) &amp; *a) * 2</p><p>h 指针加一</p><p>{mG} 把j的内容放到*(a+1)</p></blockquote><p><strong>递推公式：new(*(a+1)) = *(a+1) + index + *a - (( *( a+1) + index) &amp; *a) * 2</strong></p><p>(index为 一大堆rraa 最后得到的值)</p><h3 id="解密"><a href="#解密" class="headerlink" title="解密"></a>解密</h3><p>知道了*(a+1) 后面的新值，知道了 *(a+1) ，要求原来的 *(a+1)的值，只能通过枚举</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">enc = [<span class="number">27</span>, <span class="number">114</span>, <span class="number">17</span>, <span class="number">118</span>, <span class="number">8</span>, <span class="number">74</span>, <span class="number">126</span>, <span class="number">5</span>, <span class="number">55</span>, <span class="number">124</span>, <span class="number">31</span>, <span class="number">88</span>, <span class="number">104</span>, <span class="number">7</span>,</span><br><span class="line"><span class="number">112</span>, <span class="number">7</span>, <span class="number">49</span>, <span class="number">108</span>, <span class="number">4</span>, <span class="number">47</span>, <span class="number">4</span>, <span class="number">105</span>, <span class="number">54</span>, <span class="number">77</span>, <span class="number">127</span>, <span class="number">8</span>, <span class="number">80</span>, <span class="number">12</span>, <span class="number">109</span>, <span class="number">28</span>, <span class="number">127</span>, <span class="number">80</span>, <span class="number">29</span>, <span class="number">96</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">index = []</span><br><span class="line">f = open(<span class="string">"index.txt"</span>, <span class="string">"r"</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">34</span>):</span><br><span class="line">    cnt = <span class="number">0</span></span><br><span class="line">    s = f.readline()</span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> s:</span><br><span class="line">        <span class="keyword">if</span>(c == <span class="string">'r'</span>):</span><br><span class="line">            cnt += <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span>(c == <span class="string">'a'</span>):</span><br><span class="line">            cnt -= <span class="number">1</span></span><br><span class="line">    index.append(cnt)</span><br><span class="line"></span><br><span class="line">ans = <span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">33</span>, <span class="number">0</span>, <span class="number">-1</span>):</span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> range(<span class="number">128</span>):</span><br><span class="line">        <span class="keyword">if</span>(enc[i] == c + index[i] + enc[i<span class="number">-1</span>] - <span class="number">2</span> * ((c + index[i]) &amp; enc[i<span class="number">-1</span>])):</span><br><span class="line">            ans = chr(c) + ans</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">print(ans)</span><br></pre></td></tr></table></figure><p>输出：lag{D3v1L_H0mur4_f**k_y0uR_bra1N}</p><p>由于如下代码（IDA dump出来的）</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">__isoc99_scanf(<span class="string">"%s"</span>, s);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; ; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    v3 = i;</span><br><span class="line">    <span class="keyword">if</span> ( v3 &gt;= <span class="built_in">strlen</span>(s) )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    *((_DWORD *)array_input + i + <span class="number">1L</span>L) = s[i];</span><br><span class="line">  &#125;</span><br><span class="line">  *(_DWORD *)array_input = s[<span class="built_in">strlen</span>(s) - <span class="number">1</span>];    <span class="comment">// 读取方式有点奇怪，最后一个字符放在开头的</span></span><br></pre></td></tr></table></figure><p>输入的字符串并没有按照顺序存储，而是将输入的最后一个字符放到了内存开头，说明之后的操作全部都是从第二位开始的</p><p>通过最后一位和第一位的值同样可以逆推出原值，直接根据格式猜也行，flag嘛缺个”f”hhhh</p><p>flag{D3v1L_H0mur4_f**k_y0uR_bra1N}</p><p>​ <strong>本题用到了程序语言的化简，还有寻找规律的相关方法，遇到这样的题最好是先自己模拟一个循环节，找到规律再尝试写脚本解。因为并不是所有的虚拟机都是每步操作都可逆的23333</strong></p></div><footer class="post-footer"><div class="post-eof"></div></footer></article><article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="en"><link itemprop="mainEntityOfPage" href="https://mrh1s.top/posts/a4a48694/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.gif"><meta itemprop="name" content="mrh929"><meta itemprop="description" content="Blog"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="mrh929's home"></span><header class="post-header"><h1 class="post-title" itemprop="name headline"><a href="/posts/a4a48694/" class="post-title-link" itemprop="url">学生信息管理系统</a></h1><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">Posted on</span> <time title="Created: 2019-05-06 19:05:19 / Modified: 19:12:45" itemprop="dateCreated datePublished" datetime="2019-05-06T19:05:19+08:00">2019-05-06</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">In</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/project/" itemprop="url" rel="index"><span itemprop="name">project</span></a></span></span></div></header><div class="post-body" itemprop="articleBody"><p><a href="\uploads\store-grades.docx">store-grades.docx</a></p><blockquote><p>丢人现眼的大一下数据结构项目（我脸皮厚还是放网站上来存个档吧</p></blockquote><p>用链表实现了对学生信息的读取，存储，排序的功能。</p><p>主要数据结构：链表，算法：冒泡排序</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Student</span>&#123;</span></span><br><span class="line">	<span class="keyword">char</span> sno[<span class="number">12</span>];</span><br><span class="line">    <span class="keyword">char</span> sname[<span class="number">10</span>];</span><br><span class="line">    <span class="keyword">char</span> sex[<span class="number">4</span>];</span><br><span class="line">    <span class="keyword">char</span> major[<span class="number">20</span>];</span><br><span class="line">    Student *next; <span class="comment">//指向后继数据结点</span></span><br><span class="line">&#125;*StudentList;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Course</span>&#123;</span></span><br><span class="line">	<span class="keyword">char</span> cno[<span class="number">10</span>];</span><br><span class="line">	<span class="keyword">char</span> cname[<span class="number">20</span>];</span><br><span class="line">	<span class="keyword">int</span> classHours;</span><br><span class="line">	Course *next;</span><br><span class="line">&#125;*CourseList;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Grade</span>&#123;</span></span><br><span class="line">	<span class="keyword">char</span> sno[<span class="number">12</span>];</span><br><span class="line">    <span class="keyword">char</span> cno[<span class="number">10</span>];</span><br><span class="line">    <span class="keyword">int</span> score ;</span><br><span class="line">    Grade *next;</span><br><span class="line">&#125;*GradeList;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">struct allinfo&#123;</span></span><br><span class="line"><span class="comment">	</span></span><br><span class="line"><span class="comment">	</span></span><br><span class="line"><span class="comment">	</span></span><br><span class="line"><span class="comment">&#125;;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function">FILE *<span class="title">Open_File</span><span class="params">(<span class="keyword">int</span> who, <span class="keyword">int</span> rw)</span></span>&#123;<span class="comment">//打开哪个文件，打开方式如何 </span></span><br><span class="line">	FILE *p;</span><br><span class="line">	<span class="keyword">switch</span>(who)&#123;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">1</span>:&#123;</span><br><span class="line">			<span class="keyword">if</span>(rw) p = fopen(<span class="string">"student.dat"</span>,<span class="string">"w"</span>);</span><br><span class="line">			<span class="keyword">else</span> p = fopen(<span class="string">"student.dat"</span>,<span class="string">"r"</span>);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">2</span>:&#123;</span><br><span class="line">			<span class="keyword">if</span>(rw) p = fopen(<span class="string">"course.dat"</span>,<span class="string">"w"</span>);</span><br><span class="line">			<span class="keyword">else</span> p = fopen(<span class="string">"course.dat"</span>,<span class="string">"r"</span>);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">3</span>:&#123;</span><br><span class="line">			<span class="keyword">if</span>(rw) p = fopen(<span class="string">"courseGrade.dat"</span>,<span class="string">"w"</span>);</span><br><span class="line">			<span class="keyword">else</span> p = fopen(<span class="string">"courseGrade.dat"</span>,<span class="string">"r"</span>);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> p;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	 以下是关于学生的代码 </span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="function">Student* <span class="title">Read_Student</span><span class="params">()</span></span>&#123;</span><br><span class="line">	FILE *StuFile = Open_File(<span class="number">1</span>, <span class="number">0</span>);<span class="comment">//read</span></span><br><span class="line">	Student *head = (Student *) <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(Student));</span><br><span class="line">	Student *pre = head;</span><br><span class="line">	<span class="keyword">while</span>(!feof(StuFile))&#123;</span><br><span class="line">		Student *p = (Student *) <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(Student));</span><br><span class="line">		<span class="built_in">fscanf</span>(StuFile, <span class="string">"%s%s%s%s"</span>, p-&gt;sno, p-&gt;sname, p-&gt;sex, p-&gt;major);</span><br><span class="line">		pre-&gt;next = p;</span><br><span class="line">		pre = p;</span><br><span class="line">	&#125;</span><br><span class="line">	pre-&gt;next = <span class="literal">NULL</span>;</span><br><span class="line">	</span><br><span class="line">	fclose(StuFile);</span><br><span class="line">	<span class="keyword">return</span> head;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">BubbleSort_Student</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">10</span>; i++)&#123;</span><br><span class="line">		Student *p = StudentList-&gt;next;</span><br><span class="line">		Student *pre = StudentList;</span><br><span class="line">		<span class="keyword">while</span>(p != <span class="literal">NULL</span> &amp;&amp; p-&gt;next != <span class="literal">NULL</span> )&#123;<span class="comment">//存在两个可以比较的结点 </span></span><br><span class="line">			Student *pnext = p-&gt;next;</span><br><span class="line">			<span class="keyword">if</span>(<span class="built_in">strcmp</span>(p-&gt;sno, pnext-&gt;sno) &gt; <span class="number">0</span>)&#123;</span><br><span class="line">				pre-&gt;next = pnext;</span><br><span class="line">				p-&gt;next = pnext-&gt;next;</span><br><span class="line">				pnext-&gt;next = p;	</span><br><span class="line">			&#125;</span><br><span class="line">			pre = p;</span><br><span class="line">			p = p-&gt;next;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Print_Student</span><span class="params">()</span></span>&#123;</span><br><span class="line">	Student *p = StudentList-&gt;next;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"\nStudentList"</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"\n---------------------\n"</span>);</span><br><span class="line">	<span class="keyword">while</span>(p != <span class="literal">NULL</span>)&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"%s %s %s %s"</span>, p-&gt;sno, p-&gt;sname, p-&gt;sex, p-&gt;major);</span><br><span class="line">		p = p-&gt;next;</span><br><span class="line">		<span class="keyword">if</span>(p != <span class="literal">NULL</span>) <span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"\n---------------------\n\n"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Write_Student</span><span class="params">()</span></span>&#123;</span><br><span class="line">	FILE *StuFile = Open_File(<span class="number">1</span>, <span class="number">1</span>);<span class="comment">//write</span></span><br><span class="line">	Student *p = (Student *) <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(Student));</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">10</span>; i++)&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"No.%2d:"</span>, i);</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">"%s%s%s%s"</span>, p-&gt;sno, p-&gt;sname, p-&gt;sex, p-&gt;major);</span><br><span class="line">		<span class="built_in">fprintf</span>(StuFile, <span class="string">"%s %s %s %s"</span>, p-&gt;sno, p-&gt;sname, p-&gt;sex, p-&gt;major);</span><br><span class="line">		<span class="keyword">if</span>(i != <span class="number">10</span>) <span class="built_in">fprintf</span>(StuFile, <span class="string">"\n"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">free</span>(p);</span><br><span class="line">	fclose(StuFile);</span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	 以下是关于课程的代码 </span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="function">Course* <span class="title">Read_Course</span><span class="params">()</span></span>&#123;</span><br><span class="line">	FILE *CourseFile = Open_File(<span class="number">2</span>, <span class="number">0</span>);<span class="comment">//read</span></span><br><span class="line">	Course *head = (Course *) <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(Course));</span><br><span class="line">	Course *pre = head;</span><br><span class="line">	<span class="keyword">while</span>(!feof(CourseFile))&#123;</span><br><span class="line">		Course *p = (Course *) <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(Course));</span><br><span class="line">		<span class="built_in">fscanf</span>(CourseFile, <span class="string">"%s%s%d"</span>, p-&gt;cno, p-&gt;cname, &amp;p-&gt;classHours);</span><br><span class="line">		pre-&gt;next = p;</span><br><span class="line">		pre = p;</span><br><span class="line">	&#125;</span><br><span class="line">	pre-&gt;next = <span class="literal">NULL</span>;</span><br><span class="line">	</span><br><span class="line">	fclose(CourseFile);</span><br><span class="line">	<span class="keyword">return</span> head;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">BubbleSort_Course</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">10</span>; i++)&#123;</span><br><span class="line">		Course *p = CourseList-&gt;next;</span><br><span class="line">		Course *pre = CourseList;</span><br><span class="line">		<span class="keyword">while</span>(p != <span class="literal">NULL</span> &amp;&amp; p-&gt;next != <span class="literal">NULL</span> )&#123;<span class="comment">//存在两个可以比较的结点 </span></span><br><span class="line">			Course *pnext = p-&gt;next;</span><br><span class="line">			<span class="keyword">if</span>(<span class="built_in">strcmp</span>(p-&gt;cno, pnext-&gt;cno) &gt; <span class="number">0</span>)&#123;</span><br><span class="line">				pre-&gt;next = pnext;</span><br><span class="line">				p-&gt;next = pnext-&gt;next;</span><br><span class="line">				pnext-&gt;next = p;	</span><br><span class="line">			&#125;</span><br><span class="line">			pre = p;</span><br><span class="line">			p = p-&gt;next;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Print_Course</span><span class="params">()</span></span>&#123;</span><br><span class="line">	Course *p = CourseList-&gt;next;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"\nCourseList"</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"\n---------------------\n"</span>);</span><br><span class="line">	<span class="keyword">while</span>(p != <span class="literal">NULL</span>)&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"%s %s %d"</span>, p-&gt;cno, p-&gt;cname, p-&gt;classHours);</span><br><span class="line">		p = p-&gt;next;</span><br><span class="line">		<span class="keyword">if</span>(p != <span class="literal">NULL</span>) <span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"\n---------------------\n\n"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Write_Course</span><span class="params">()</span></span>&#123;</span><br><span class="line">	FILE *CourseFile = Open_File(<span class="number">2</span>, <span class="number">1</span>);<span class="comment">//write</span></span><br><span class="line">	Course *p = (Course *) <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(Course));</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">3</span>; i++)&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"No.%2d:"</span>, i);</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">"%s%s%d"</span>, p-&gt;cno, p-&gt;cname, &amp;p-&gt;classHours);</span><br><span class="line">		<span class="built_in">fprintf</span>(CourseFile, <span class="string">"%s %s %d"</span>, p-&gt;cno, p-&gt;cname, p-&gt;classHours);</span><br><span class="line">		<span class="keyword">if</span>(i != <span class="number">3</span>) <span class="built_in">fprintf</span>(CourseFile, <span class="string">"\n"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">free</span>(p);</span><br><span class="line">	fclose(CourseFile);</span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	 以下是关于成绩的代码 </span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="function">Grade* <span class="title">Read_Grade</span><span class="params">()</span></span>&#123;</span><br><span class="line">	FILE *GradeFile = Open_File(<span class="number">3</span>, <span class="number">0</span>);<span class="comment">//read</span></span><br><span class="line">	Grade *head = (Grade *) <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(Grade));</span><br><span class="line">	Grade *pre = head;</span><br><span class="line">	<span class="keyword">while</span>(!feof(GradeFile))&#123;</span><br><span class="line">		Grade *p = (Grade *) <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(Grade));</span><br><span class="line">		<span class="built_in">fscanf</span>(GradeFile, <span class="string">"%s%s%d"</span>, p-&gt;sno, p-&gt;cno, &amp;p-&gt;score);</span><br><span class="line">		pre-&gt;next = p;</span><br><span class="line">		pre = p;</span><br><span class="line">	&#125;</span><br><span class="line">	pre-&gt;next = <span class="literal">NULL</span>;</span><br><span class="line">	</span><br><span class="line">	fclose(GradeFile);</span><br><span class="line">	<span class="keyword">return</span> head;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">BubbleSort_Grade</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">10</span>; i++)&#123;</span><br><span class="line">		Grade *p = GradeList-&gt;next;</span><br><span class="line">		Grade *pre = GradeList;</span><br><span class="line">		<span class="keyword">while</span>(p != <span class="literal">NULL</span> &amp;&amp; p-&gt;next != <span class="literal">NULL</span> )&#123;<span class="comment">//存在两个可以比较的结点 </span></span><br><span class="line">			Grade *pnext = p-&gt;next;</span><br><span class="line">			<span class="keyword">if</span>(<span class="built_in">strcmp</span>(p-&gt;sno, pnext-&gt;sno) &gt; <span class="number">0</span> || (<span class="built_in">strcmp</span>(p-&gt;sno, pnext-&gt;sno) == <span class="number">0</span> &amp;&amp; <span class="built_in">strcmp</span>(p-&gt;cno, pnext-&gt;cno) &gt; <span class="number">0</span>) )&#123;</span><br><span class="line">				pre-&gt;next = pnext;</span><br><span class="line">				p-&gt;next = pnext-&gt;next;</span><br><span class="line">				pnext-&gt;next = p;	</span><br><span class="line">			&#125;</span><br><span class="line">			pre = p;</span><br><span class="line">			p = p-&gt;next;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Print_Grade</span><span class="params">()</span></span>&#123;</span><br><span class="line">	Grade *p = GradeList-&gt;next;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"\nGradeList"</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"\n---------------------\n"</span>);</span><br><span class="line">	<span class="keyword">while</span>(p != <span class="literal">NULL</span>)&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"%s %s %d"</span>, p-&gt;sno, p-&gt;cno, p-&gt;score);</span><br><span class="line">		p = p-&gt;next;</span><br><span class="line">		<span class="keyword">if</span>(p != <span class="literal">NULL</span>) <span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"\n---------------------\n\n"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Write_Grade</span><span class="params">()</span></span>&#123;</span><br><span class="line">	FILE *GradeFile = Open_File(<span class="number">3</span>, <span class="number">1</span>);<span class="comment">//write</span></span><br><span class="line">	Grade *p = (Grade *) <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(Grade));</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">10</span>; i++)&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"No.%2d:"</span>, i);</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">"%s%s%d"</span>, p-&gt;sno, p-&gt;cno, &amp;p-&gt;score);</span><br><span class="line">		<span class="built_in">fprintf</span>(GradeFile, <span class="string">"%s %s %d"</span>, p-&gt;sno, p-&gt;cno, p-&gt;score);</span><br><span class="line">		<span class="keyword">if</span>(i != <span class="number">10</span>) <span class="built_in">fprintf</span>(GradeFile, <span class="string">"\n"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">free</span>(p);</span><br><span class="line">	fclose(GradeFile);</span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">BubbleSort_StudentsGrade</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">10</span>; i++)&#123;</span><br><span class="line">		Grade *p = GradeList-&gt;next;</span><br><span class="line">		Grade *pre = GradeList;</span><br><span class="line">		<span class="keyword">while</span>(p != <span class="literal">NULL</span> &amp;&amp; p-&gt;next != <span class="literal">NULL</span> )&#123;<span class="comment">//存在两个可以比较的结点 </span></span><br><span class="line">			Grade *pnext = p-&gt;next;</span><br><span class="line">			<span class="keyword">if</span>(p-&gt;score &lt; pnext-&gt;score)&#123;</span><br><span class="line">				pre-&gt;next = pnext;</span><br><span class="line">				p-&gt;next = pnext-&gt;next;</span><br><span class="line">				pnext-&gt;next = p;	</span><br><span class="line">			&#125;</span><br><span class="line">			pre = p;</span><br><span class="line">			p = p-&gt;next;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">Student *<span class="title">Find_Student</span><span class="params">(<span class="keyword">char</span> *num)</span></span>&#123;</span><br><span class="line">	Student *p = StudentList-&gt;next;</span><br><span class="line">	<span class="keyword">do</span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(<span class="built_in">strcmp</span>(p-&gt;sno, num) == <span class="number">0</span>) <span class="keyword">return</span> p;</span><br><span class="line">		p = p-&gt;next;</span><br><span class="line">	&#125;<span class="keyword">while</span>(p != <span class="literal">NULL</span>);</span><br><span class="line">	</span><br><span class="line">	p = (Student*) <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(Student));</span><br><span class="line">	<span class="keyword">char</span> temp[<span class="number">3</span>] = <span class="string">"-1"</span>;</span><br><span class="line">	<span class="built_in">strcpy</span>(p-&gt;major, temp);</span><br><span class="line">	<span class="built_in">strcpy</span>(p-&gt;sex, temp);</span><br><span class="line">	<span class="built_in">strcpy</span>(p-&gt;sname, temp);</span><br><span class="line">	<span class="built_in">strcpy</span>(p-&gt;sno, temp);</span><br><span class="line">	p-&gt;next = <span class="literal">NULL</span>;</span><br><span class="line">	<span class="keyword">return</span> p;<span class="comment">//返回错误 </span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">Course *<span class="title">Find_Course</span><span class="params">(<span class="keyword">char</span> *num)</span></span>&#123;</span><br><span class="line">	Course *p = CourseList-&gt;next;</span><br><span class="line">	<span class="keyword">do</span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(<span class="built_in">strcmp</span>(p-&gt;cno, num) == <span class="number">0</span>) <span class="keyword">return</span> p;</span><br><span class="line">		p = p-&gt;next;</span><br><span class="line">	&#125;<span class="keyword">while</span>(p != <span class="literal">NULL</span>);</span><br><span class="line">	</span><br><span class="line">	p = (Course*) <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(Course));</span><br><span class="line">	<span class="keyword">char</span> temp[<span class="number">3</span>] = <span class="string">"-1"</span>;</span><br><span class="line">	<span class="built_in">strcpy</span>(p-&gt;cname, temp);</span><br><span class="line">	<span class="built_in">strcpy</span>(p-&gt;cno, temp);</span><br><span class="line">	p-&gt;classHours = <span class="number">-1</span>;</span><br><span class="line">	p-&gt;next = <span class="literal">NULL</span>;</span><br><span class="line">	<span class="keyword">return</span> p;<span class="comment">//返回错误 </span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Print_All</span><span class="params">(Grade *p)</span></span>&#123;</span><br><span class="line">	Student *s = Find_Student(p-&gt;sno);</span><br><span class="line">	Course *c = Find_Course(p-&gt;cno);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"%6s %6s %6s %6s %3d"</span>, s-&gt;sno, s-&gt;sname, s-&gt;major, c-&gt;cname, p-&gt;score);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Print_Seven</span><span class="params">()</span></span>&#123;<span class="comment">//Task7 </span></span><br><span class="line">	Grade *p = GradeList-&gt;next;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"\nGradeList"</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"\nnumber   name  major  course  grade"</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"\n---------------------------------------\n"</span>);</span><br><span class="line">	<span class="keyword">while</span>(p != <span class="literal">NULL</span>)&#123;</span><br><span class="line">		Print_All(p);</span><br><span class="line">		p = p-&gt;next;</span><br><span class="line">		<span class="keyword">if</span>(p != <span class="literal">NULL</span>) <span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"\n---------------------------------------\n\n"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Print_Eight</span><span class="params">(<span class="keyword">char</span>* num)</span></span>&#123;<span class="comment">//Task8 指定课程号 </span></span><br><span class="line">	Grade *p = GradeList-&gt;next;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"\nGradeList"</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"\nnumber   name  major  course  grade"</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"\n---------------------------------------\n"</span>);</span><br><span class="line">	<span class="keyword">while</span>(p != <span class="literal">NULL</span>)&#123;</span><br><span class="line">		<span class="keyword">if</span>(<span class="built_in">strcmp</span>(p-&gt;cno, num) == <span class="number">0</span>) Print_All(p);</span><br><span class="line">		p = p-&gt;next;</span><br><span class="line">		<span class="keyword">if</span>(p != <span class="literal">NULL</span>) <span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"\n---------------------------------------\n\n"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Print_Nine</span><span class="params">()</span></span>&#123;<span class="comment">//Task9 </span></span><br><span class="line">	Grade *p = GradeList-&gt;next;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"\nGradeList"</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"\nnumber   name  major  course  grade"</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"\n---------------------------------------\n"</span>);</span><br><span class="line">	<span class="keyword">while</span>(p != <span class="literal">NULL</span>)&#123;</span><br><span class="line">		<span class="keyword">if</span>(p-&gt;score &lt; <span class="number">60</span>) Print_All(p);</span><br><span class="line">		p = p-&gt;next;</span><br><span class="line">		<span class="keyword">if</span>(p != <span class="literal">NULL</span>) <span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"\n---------------------------------------\n\n"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ReverseStudent</span><span class="params">()</span></span>&#123;</span><br><span class="line">	Student *head = (Student*) <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(Student));</span><br><span class="line">	Student *p = StudentList-&gt;next;</span><br><span class="line">	head-&gt;next = <span class="literal">NULL</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">while</span>(p != <span class="literal">NULL</span>)&#123;</span><br><span class="line">		Student *t = p-&gt;next;<span class="comment">//暂时保存p的下一个结点 </span></span><br><span class="line">		p-&gt;next = head-&gt;next;</span><br><span class="line">		head-&gt;next = p;</span><br><span class="line">		p = t;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	StudentList = head;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Queue_Push</span><span class="params">(Grade *p, Grade *&amp;top, Grade *&amp;rear)</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(top-&gt;next == <span class="literal">NULL</span>)&#123;</span><br><span class="line">		top-&gt;next = p;</span><br><span class="line">		rear-&gt;next = p;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span>&#123;</span><br><span class="line">		p-&gt;next = top;</span><br><span class="line">		top = p;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">Grade* <span class="title">Queue_Pop</span><span class="params">(Grade *&amp;top, Grade *&amp;rear)</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(top-&gt;next == rear-&gt;next)&#123;</span><br><span class="line">		top-&gt;next = rear-&gt;next = <span class="literal">NULL</span>;</span><br><span class="line">		<span class="keyword">return</span> top-&gt;next;</span><br><span class="line">	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">		rear-&gt;next = top-&gt;next;</span><br><span class="line">		<span class="keyword">return</span> rear-&gt;next;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Print_Eleven</span><span class="params">(Grade *top, Grade *rear)</span></span>&#123;</span><br><span class="line">	Grade *p = Queue_Pop(top, rear);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"\nGradeList"</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"\nnumber   name  major  course  grade"</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"\n---------------------------------------\n"</span>);</span><br><span class="line">	<span class="keyword">while</span>(p != <span class="literal">NULL</span>)&#123;</span><br><span class="line">		Print_All(p);</span><br><span class="line">		p = p-&gt;next;</span><br><span class="line">		<span class="keyword">if</span>(p != <span class="literal">NULL</span>) <span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"\n---------------------------------------\n\n"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> opt;</span><br><span class="line">	Student *HEAD = <span class="literal">NULL</span>;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"Welcome to Students' score system!\n"</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"1.Input students.\n"</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"2.Input courses.\n"</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"3.Input grades.\n"</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"4.Output students.\n"</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"5.Output courses.\n"</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"6.Output grades.\n"</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"7.Output all.\n"</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"8.Output all of a course.\n"</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"9.Output all below 60.\n"</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"10.Reverse students.\n"</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"11.Output all.\n"</span>);</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">while</span>(<span class="number">1</span>)&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"\nPlease input an option:"</span>);	</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;opt);</span><br><span class="line">		<span class="keyword">if</span>(opt == <span class="number">-1</span>) <span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">switch</span>(opt)&#123;</span><br><span class="line">			<span class="keyword">case</span> <span class="number">1</span>:&#123;</span><br><span class="line">				Write_Student();</span><br><span class="line">				<span class="built_in">printf</span>(<span class="string">"done.\n"</span>);</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			<span class="keyword">case</span> <span class="number">2</span>:&#123;</span><br><span class="line">				Write_Course();</span><br><span class="line">				<span class="built_in">printf</span>(<span class="string">"done.\n"</span>);</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			<span class="keyword">case</span> <span class="number">3</span>:&#123;</span><br><span class="line">				Write_Grade();</span><br><span class="line">				<span class="built_in">printf</span>(<span class="string">"done.\n"</span>);</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			<span class="keyword">case</span> <span class="number">4</span>:&#123;</span><br><span class="line">				StudentList = Read_Student();</span><br><span class="line">				BubbleSort_Student();</span><br><span class="line">				Print_Student();</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			<span class="keyword">case</span> <span class="number">5</span>:&#123;</span><br><span class="line">				CourseList = Read_Course();</span><br><span class="line">				BubbleSort_Course();</span><br><span class="line">				Print_Course();</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			<span class="keyword">case</span> <span class="number">6</span>:&#123;</span><br><span class="line">				GradeList = Read_Grade();</span><br><span class="line">				BubbleSort_Grade();</span><br><span class="line">				Print_Grade();</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			<span class="keyword">case</span> <span class="number">7</span>:&#123;</span><br><span class="line">				StudentList = Read_Student();</span><br><span class="line">				CourseList = Read_Course();</span><br><span class="line">				GradeList = Read_Grade();</span><br><span class="line">				BubbleSort_StudentsGrade();<span class="comment">//按照成绩排序 </span></span><br><span class="line">				Print_Seven();</span><br><span class="line">				</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			<span class="keyword">case</span> <span class="number">8</span>:&#123;</span><br><span class="line">				StudentList = Read_Student();</span><br><span class="line">				CourseList = Read_Course();</span><br><span class="line">				GradeList = Read_Grade();</span><br><span class="line">				BubbleSort_StudentsGrade();<span class="comment">//按照成绩排序 </span></span><br><span class="line">				<span class="keyword">char</span> str[<span class="number">10</span>];</span><br><span class="line">				<span class="built_in">printf</span>(<span class="string">"input course name:"</span>);</span><br><span class="line">				<span class="built_in">scanf</span>(<span class="string">"%s"</span>, str);</span><br><span class="line">				Print_Eight(str);</span><br><span class="line">				</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			<span class="keyword">case</span> <span class="number">9</span>:&#123;</span><br><span class="line">				StudentList = Read_Student();</span><br><span class="line">				CourseList = Read_Course();</span><br><span class="line">				GradeList = Read_Grade();</span><br><span class="line">				BubbleSort_StudentsGrade();<span class="comment">//按照成绩排序 </span></span><br><span class="line">				Print_Nine();</span><br><span class="line">				</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			<span class="keyword">case</span> <span class="number">10</span>:&#123;</span><br><span class="line">				StudentList = Read_Student();</span><br><span class="line">				ReverseStudent();<span class="comment">//逆序生成新的链表 </span></span><br><span class="line">				Print_Student();<span class="comment">//输出该链表 </span></span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			<span class="keyword">case</span> <span class="number">11</span>:&#123;</span><br><span class="line">				StudentList = Read_Student();</span><br><span class="line">				CourseList = Read_Course();</span><br><span class="line">				GradeList = Read_Grade();</span><br><span class="line">				BubbleSort_StudentsGrade();<span class="comment">//按照成绩排序 </span></span><br><span class="line">				Print_Seven();</span><br><span class="line">				</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><footer class="post-footer"><div class="post-eof"></div></footer></article><article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="en"><link itemprop="mainEntityOfPage" href="https://mrh1s.top/posts/25290751/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.gif"><meta itemprop="name" content="mrh929"><meta itemprop="description" content="Blog"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="mrh929's home"></span><header class="post-header"><h1 class="post-title" itemprop="name headline"><a href="/posts/25290751/" class="post-title-link" itemprop="url">To Be Alone</a></h1><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">Posted on</span> <time title="Created: 2019-05-04 19:11:00 / Modified: 23:39:44" itemprop="dateCreated datePublished" datetime="2019-05-04T19:11:00+08:00">2019-05-04</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">In</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/牢骚/" itemprop="url" rel="index"><span itemprop="name">牢骚</span></a></span></span></div></header><div class="post-body" itemprop="articleBody"><p>你的生活难道是过给别人看的？</p><blockquote><p>一个人成熟的标志之一就是：明白每天发生在自己身上的99%的事情对于别人而言根本毫无意义。</p></blockquote><p>——Mark Bauerlein</p><p>有的人爱热闹，爱交流，爱群居生活。</p><p>但独处、安静和不动声色同样被一些人需要着。</p><p>合群有合群的好，独处也有独处的好。无论哪种生活方式，自己觉得舒适不就行了 ？生活充实有效率不就行了？</p><p>都大学生了，已经是一个完全独立对自己负责的成年人了。</p><p>每个人都有着自己的目标，都怀着自己的心事，都走在自己的轨迹上，都忙着自己的故事。</p><p>每个人都是一条河流，每条河流都有自己的方向。</p><p>没有交集是正常的，独处乃至孤独都是常态，哪有什么丢不丢人的？</p><p>与其关心这些，你不如关心</p><p>大学生挂科丢不丢人？大学生四六级没过丢不丢人？大学生GPA/加权垫底丢不丢人？大学生没拿过奖学金丢不丢人？</p><p>生活该有的样子是什么？</p><p>一言以蔽之：<strong>阅己，悦己，越己。</strong></p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://i.loli.net/2019/05/04/5ccd739ca75f5.jpg" alt="v2-3d23d3d9934db2b4379f6894ffe3ed26_hd.jpg"></p><p>链接：<a href="https://www.zhihu.com/question/307092372/answer/621757215" target="_blank" rel="noopener">https://www.zhihu.com/question/307092372/answer/621757215</a></p><p>来源：知乎</p></div><footer class="post-footer"><div class="post-eof"></div></footer></article><article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="en"><link itemprop="mainEntityOfPage" href="https://mrh1s.top/posts/ebedb07/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.gif"><meta itemprop="name" content="mrh929"><meta itemprop="description" content="Blog"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="mrh929's home"></span><header class="post-header"><h1 class="post-title" itemprop="name headline"><a href="/posts/ebedb07/" class="post-title-link" itemprop="url">Migration_Success!</a></h1><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">Posted on</span> <time title="Created: 2019-05-03 19:24:16" itemprop="dateCreated datePublished" datetime="2019-05-03T19:24:16+08:00">2019-05-03</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i> </span><span class="post-meta-item-text">Edited on</span> <time title="Modified: 2019-05-05 13:51:59" itemprop="dateModified" datetime="2019-05-05T13:51:59+08:00">2019-05-05</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">In</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/牢骚/" itemprop="url" rel="index"><span itemprop="name">牢骚</span></a></span></span></div></header><div class="post-body" itemprop="articleBody"><p>把<strong>wordpress</strong>里面的所有内容迁移到了<strong>github page</strong></p><blockquote><p>中途花了不少功夫</p><p>wordpress网页转md各种格式错误，文件引用错误，需要手动改</p></blockquote><p>以后就用这个静态网站啦！</p><p>排版比wordpress舒服多了，而且不用租服务器</p><p>回头我再去研究研究hexo的主题配置（咕 （划去，<strong>主题已经配置好</strong></p><p>并且把之前所有的非markdown文章的格式改了一下，使其更好看</p><blockquote><p>可恶的强迫症</p></blockquote></div><footer class="post-footer"><div class="post-eof"></div></footer></article><article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="en"><link itemprop="mainEntityOfPage" href="https://mrh1s.top/posts/ea74c872/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.gif"><meta itemprop="name" content="mrh929"><meta itemprop="description" content="Blog"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="mrh929's home"></span><header class="post-header"><h1 class="post-title" itemprop="name headline"><a href="/posts/ea74c872/" class="post-title-link" itemprop="url">bbvvmm</a></h1><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">Posted on</span> <time title="Created: 2019-04-28 12:56:40" itemprop="dateCreated datePublished" datetime="2019-04-28T12:56:40+08:00">2019-04-28</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i> </span><span class="post-meta-item-text">Edited on</span> <time title="Modified: 2019-09-14 11:13:03" itemprop="dateModified" datetime="2019-09-14T11:13:03+08:00">2019-09-14</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">In</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/write-up/" itemprop="url" rel="index"><span itemprop="name">write up</span> </a></span>, <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/write-up/nationalCTF-20190421/" itemprop="url" rel="index"><span itemprop="name">nationalCTF_20190421</span></a></span></span></div></header><div class="post-body" itemprop="articleBody"><h3 id="bbvvmm"><a href="#bbvvmm" class="headerlink" title="bbvvmm"></a>bbvvmm</h3><p>用ida打开 可以发现程序读入了用户名和密码，然后对用户名和密码进行了加密，如果用户名和密码校验正确，那么就cat flag</p><p>首先是用户名，用户名先进行一层加密，后进行sm4加密，最后进行变表base64转换为了一串密文</p><p>首先解决base64：</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line">tab2 = <span class="string">"IJLMNOPKABDEFGHCQRTUVWXSYZbcdefa45789+/6ghjklmnioprstuvqwxz0123y="</span></span><br><span class="line">tab1 = <span class="string">"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="</span></span><br><span class="line"></span><br><span class="line">s2 = <span class="string">"RVYtG85NQ9OPHU4uQ8AuFM+MHVVrFMJMR8FuF8WJQ8Y="</span></span><br><span class="line">s1 = <span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> c <span class="keyword">in</span> s2:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(tab2)):</span><br><span class="line">        <span class="keyword">if</span>(tab2[i] == c):</span><br><span class="line">            s1 += tab1[i]</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">print(base64.b64decode(s1))</span><br></pre></td></tr></table></figure><p>得到“EF468DBAF985B2509C9E200CF3525AB6”</p><p>然后是sm4加密算法，直接在网上找轮子<br>解密得到“36 32 36 31 36 34 37 32 36 35 37 32 33 31 33 32”</p><p>最后<br>两次转化成ascii<br>第一次62 61 54 72 65 72 31 32<br>第二次b a d r e r 1 2</p><p>然后就得到了用户名</p><p>对于密码，并不清楚这个密码使用了什么加密算法，只清楚这是一个虚拟机，有几百个操作数，好像是对密码进行了某种运算，最后将运算结果保存到内存的某个地方，如果这个内存数据为0，那么密码便正确</p><p>直接开ida动态远程调试：<br>能找到一个类似于栈的结构（一直+4 -4），在内存中找到这个栈对应的位置<br><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://i.imgur.com/JBq8VUh.png" alt></p><p>通过不断地循环fastcall，看到栈中出现了我刚刚输入的字符串，并且旁边是一堆奇特字符串，而且长度也是六位，于是尝试交上去，成功</p><p>getshell的时候：输入密码之后不能直接按回车键，这样会多输入一个 \n，而应该ctrl+d，输入文本中断符，然后拿到flag</p></div><footer class="post-footer"><div class="post-eof"></div></footer></article></div><nav class="pagination"><a class="extend prev" rel="prev" href="/page/3/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><span class="space">&hellip;</span><a class="page-number" href="/page/10/">10</a><a class="extend next" rel="next" href="/page/5/"><i class="fa fa-angle-right" aria-label="Next page"></i></a></nav></div><script>window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc">Table of Contents</li><li class="sidebar-nav-overview">Overview</li></ul><div class="post-toc-wrap sidebar-panel"></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><p class="site-author-name" itemprop="name">mrh929</p><div class="site-description" itemprop="description">Blog</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"><a href="/_posts/"><span class="site-state-item-count">79</span> <span class="site-state-item-name">posts</span></a></div><div class="site-state-item site-state-categories"><span class="site-state-item-count">20</span> <span class="site-state-item-name">categories</span></div><div class="site-state-item site-state-tags"><span class="site-state-item-count">16</span> <span class="site-state-item-name">tags</span></div></nav></div><div class="cc-license motion-element" itemprop="license"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/en" class="cc-opacity" rel="noopener" target="_blank"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright">&copy; <span itemprop="copyrightYear">2020</span> <span class="with-love"><i class="fa fa-user"></i> </span><span class="author" itemprop="copyrightHolder">mrh929</span></div><div class="powered-by">Powered by <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> v3.8.0</div><span class="post-meta-divider">|</span><div class="theme-info">Theme – <a href="https://pisces.theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> v7.7.0</div></div></footer></div><script src="/lib/anime.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script>!function(e){var r=Array.prototype.slice.call(document.querySelectorAll("img[data-original]"));function t(){for(var c=0;c<r.length;c++)t=r[c],void 0,0<=(n=t.getBoundingClientRect()).top&&0<=n.left&&n.top<=(e.innerHeight||document.documentElement.clientHeight)&&function(){var t,n,e,i,o=r[c];t=o,n=function(){r=r.filter(function(t){return o!==t})},e=new Image,i=t.getAttribute("data-original"),e.onload=function(){t.src=i,n&&n()},e.src=i}();var t,n}t(),e.addEventListener("scroll",function(){!function(t,n){clearTimeout(t.tId),t.tId=setTimeout(function(){t.call(n)},500)}(t,e)})}(this);</script></body></html>